{"job":{"components":{"2956869":{"id":2956869,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-214,"y":1,"width":32,"height":32,"inputConnectorIDs":[2956866],"outputSuccessConnectorIDs":[2956865],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Initialize Vars"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\n\nl_s3_file_path = '{0}/{1}'.format(current_year, int(current_month))\ncontext.updateVariable(\"s3_file_path\", l_s3_file_path)\n\n#print(l_s3_file_path)\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2956872":{"id":2956872,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-320,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2956866],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2956873":{"id":2956873,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":472,"y":-7,"width":32,"height":32,"inputConnectorIDs":[2956868],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Process file data"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"delete from rdl.raw_galileo_account_card_data\nwhere file_date = '${current_year}-${current_month}-${current_day}'\n;\n\ninsert into rdl.raw_galileo_account_card_data(\"file_date\", \"record_type\", \"unique_program_id\", \"group_id\", \"product_id\", \"galileo_account_id\", \"prn\", \"expiration_date\", \"status\", \"card_id\", \"card_number\", \"type_of_card\")\nselect '${current_year}-${current_month}-${current_day}', \"record_type\", \"unique_program_id\", \"group_id\", \"product_id\", \"galileo_account_id\", \"prn\", \"expiration_date\", \"status\", \"card_id\", \"card_number\", \"type_of_card\"\nfrom etl.galileo_account_card_file_detail_staging\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2956874":{"id":2956874,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":373,"y":1,"width":32,"height":32,"inputConnectorIDs":[2956870],"outputSuccessConnectorIDs":[2956868],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Load file sections"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"copy ${staging_schema}.galileo_account_card_file_header_staging(\"HEADER\", \"PROCESSOR_NAME\", \"REPORT_DATA_FEED_NAME\", \"FILE_TRANSMIT_DATE\", \"WORK_OF_DATE\")\nfrom '${file_staging_path}/galileo_account_card_file_header.txt'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'HEADER:6,PROCESSOR_NAME:50,REPORT_DATA_FEED_NAME:50,FILE_TRANSMIT_DATE:8,WORK_OF_DATE:8'\nTRIMBLANKS\nEMPTYASNULL\nBLANKSASNULL\nCOMPUPDATE OFF\nSTATUPDATE OFF\nACCEPTINVCHARS AS '?'\n;\n\ncopy ${staging_schema}.galileo_account_card_file_detail_staging(\"UNIQUE_PROGRAM_ID\", \"GROUP_ID\", \"PRODUCT_ID\", \"GALILEO_ACCOUNT_ID\", \"PRN\", \"EXPIRATION_DATE\", \"STATUS\", \"CARD_ID\", \"CARD_NUMBER\", \"TYPE_OF_CARD\")\nfrom '${file_staging_path}/galileo_account_card_file_detail.txt'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'UNIQUE_PROGRAM_ID:15,GROUP_ID:15,PRODUCT_ID:15,GALILEO_ACCOUNT_ID:30,PRN:12,EXPIRATION_DATE:8,STATUS:5,CARD_ID:30,CARD_NUMBER:16,TYPE_OF_CARD:10'\nTRIMBLANKS\nEMPTYASNULL\nBLANKSASNULL\nCOMPUPDATE OFF\nSTATUPDATE OFF\nACCEPTINVCHARS AS '?'\n;\n\ncopy ${staging_schema}.galileo_account_card_file_trailer_staging(\"TRAILER\", \"COUNT\")\nfrom '${file_staging_path}/galileo_account_card_file_trailer.txt'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'TRAILER:7,COUNT:9'\nTRIMBLANKS\nEMPTYASNULL\nBLANKSASNULL\nCOMPUPDATE OFF\nSTATUPDATE OFF\nACCEPTINVCHARS AS '?'\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2956875":{"id":2956875,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":248,"y":-2,"width":32,"height":32,"inputConnectorIDs":[2956864],"outputSuccessConnectorIDs":[2956870],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Unload file sections"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"unload ('select record_data from ${staging_schema}.${file_staging_table_name} where record_type = ''H''')\nto '${file_staging_path}/galileo_account_card_file_header.txt'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nparallel off\nallowoverwrite\n;\n\nunload ('select record_data from ${staging_schema}.${file_staging_table_name} where record_type = ''D''')\nto '${file_staging_path}/galileo_account_card_file_detail.txt'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nparallel off\nallowoverwrite\n;\n\nunload ('select record_data from ${staging_schema}.${file_staging_table_name} where record_type = ''T''')\nto '${file_staging_path}/galileo_account_card_file_trailer.txt'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nparallel off\nallowoverwrite\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2956876":{"id":2956876,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-97,"y":-1,"width":32,"height":32,"inputConnectorIDs":[2956865],"outputSuccessConnectorIDs":[2956867],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Initialize Vars - test"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Udating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\nimport datetime\n\nl_current_year = datetime.date.today().strftime('%Y')\nl_current_month = datetime.date.today().strftime('%m')\nl_current_day = datetime.date.today().strftime('%d')\n\nl_s3_file_path = '{0}/{1}'.format(l_current_year, l_current_month)\nl_s3_filename = 'interest_accrual_{0}{1}{2}.csv'.format(l_current_year, l_current_month, l_current_day)\n\ncontext.updateVariable(\"s3_file_path\", l_s3_file_path)\ncontext.updateVariable(\"s3_filename\", l_s3_filename)\n\n#print(l_s3_file_path)\n#print(l_s3_filename)\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2956878":{"id":2956878,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":773867971,"x":121,"y":-5,"width":32,"height":32,"inputConnectorIDs":[2956871],"outputSuccessConnectorIDs":[2956864],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Load file to staging table"}}}},"visible":true},"4":{"slot":4,"name":"S3 Object Prefix","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"accountcard_${current_year}${current_month}${current_day}.txt"}}}},"visible":true},"7":{"slot":7,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"8":{"slot":8,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"galileo_account_card_file_staging"}}}},"visible":true},"9":{"slot":9,"name":"Load Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"record_type"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"record_data"}}}},"visible":true},"23":{"slot":23,"name":"Date Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":true},"24":{"slot":24,"name":"Time Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":true},"26":{"slot":26,"name":"","elements":{},"visible":false},"27":{"slot":27,"name":"Escape","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2956879":{"id":2956879,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":237373210,"x":0,"y":-2,"width":32,"height":32,"inputConnectorIDs":[2956867],"outputSuccessConnectorIDs":[2956871],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Truncate Table"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2956864":{"id":2956864,"sourceID":2956878,"targetID":2956875},"2956865":{"id":2956865,"sourceID":2956869,"targetID":2956876},"2956867":{"id":2956867,"sourceID":2956876,"targetID":2956879},"2956868":{"id":2956868,"sourceID":2956874,"targetID":2956873},"2956870":{"id":2956870,"sourceID":2956875,"targetID":2956874},"2956871":{"id":2956871,"sourceID":2956879,"targetID":2956878}},"failureConnectors":{},"unconditionalConnectors":{"2956866":{"id":2956866,"sourceID":2956872,"targetID":2956869}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{"current_day":{"definition":{"name":"current_day","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"01"},"current_month":{"definition":{"name":"current_month","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"10"},"current_year":{"definition":{"name":"current_year","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"2018"},"file_staging_path":{"definition":{"name":"file_staging_path","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"s3://aspiration-etl-staging/file_processing/galileo_account_card"},"file_staging_table_name":{"definition":{"name":"file_staging_table_name","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"galileo_account_card_file_staging"},"s3_file_path":{"definition":{"name":"s3_file_path","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"2018/11"},"s3_filename":{"definition":{"name":"s3_filename","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"test_20181112.csv"}},"grids":{"file_dates":{"definition":{"name":"file_dates","scope":"BRANCH","definitions":[{"name":"file_date_year","type":"TEXT"},{"name":"file_date_month","type":"TEXT"},{"name":"file_date_day","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[]},"table_list":{"definition":{"name":"table_list","scope":"BRANCH","definitions":[{"name":"table_name","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[{"values":["galileo_account_card_file_staging"]},{"values":["galileo_account_card_file_header_staging"]},{"values":["galileo_account_card_file_detail_staging"]},{"values":["galileo_account_card_file_trailer_staging"]}]}}},"info":{"name":"galileo_account_card_file_parser_day_backup_20191211","description":"","type":"ORCHESTRATION","tag":"b825460b-17fa-420a-95eb-295902e47585"}}