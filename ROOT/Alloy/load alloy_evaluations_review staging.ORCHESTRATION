{"job":{"components":{"2961640":{"id":2961640,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-464,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2961636],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"start"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2961642":{"id":2961642,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-304,"y":0,"width":32,"height":32,"inputConnectorIDs":[2961636],"outputSuccessConnectorIDs":[2961637],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"create review staging table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"drop table if exists etl.alloy_evaluation_reviews_parsed_staging;\n\ncreate table etl.alloy_evaluation_reviews_parsed_staging\n(\n    evaluation_review_id varchar(65535),\n    service_id           varchar(65535),\n    service_name         varchar(65535),\n    field_name           varchar(65535),\n    field_display_name   varchar(65535),\n    extracted            varchar(65535),\n    field_description    varchar(65535),\n    data_source          varchar(65535),\n    data_type            varchar(65535),\n    provenance           varchar(65535)\n);"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2961643":{"id":2961643,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":716056355,"x":-128,"y":0,"width":32,"height":32,"inputConnectorIDs":[2961637],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Move delta data"}}}},"visible":true},"2":{"slot":2,"name":"","elements":{},"visible":false},"3":{"slot":3,"name":"Database Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"postgresql"}}}},"visible":true},"4":{"slot":4,"name":"RDS Endpoint","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"prod-web-db-analytics.ctawxryivyva.us-west-2.rds.amazonaws.com:5432"}}}},"visible":true},"5":{"slot":5,"name":"Database Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"account_opening_alloy"}}}},"visible":true},"6":{"slot":6,"name":"Username","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"data_readonly"}}}},"visible":true},"7":{"slot":7,"name":"Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":"data_readonly"}}}},"visible":true},"8":{"slot":8,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"with attributes (service_name, internal_name, source_type,\tstage,\tdata_type,\tdescription,\tname,\tdisplay_name,\tselector,\tdata_source)\n   as ( VALUES\n('Alloy Summary','Alloy Summary','asp','response','string','Alloy Summary','review_token','review_token','review_token','raw'),\n('Alloy Summary','Alloy Summary','asp','response','string','Alloy Summary','outcome','outcome','outcome','raw'),\n('Alloy Summary','Alloy Summary','asp','response','string','Alloy Summary','reason','reason','reason','raw'),\n('Alloy Summary','Alloy Summary','asp','response','string','Alloy Summary','application_name','application_name','application_name','raw'),\n('Alloy Summary','Alloy Summary','asp','response','string','Alloy Summary','timestamp','timestamp','timestamp','raw'),\n('Alloy Summary','Alloy Summary','asp','response','string','Alloy Summary','reviewer','reviewer','reviewer','raw')\n)\n --select * from attributes\n\n    , eval_services AS (\n    SELECT ev.id as evaluation_id,\n           a.service_name AS service_name,\n           a.service_name as service_id,\n           alloy_review as alloy_review\n    FROM evaluation_reviews ev \n        cross join (select distinct service_name\n                    from attributes) a\n    where 1=1\n--       and updated_at::date >= now()::date - 1\n--       and ev.alloy_evaluation_id = 58493\n    ) \n--    select * from eval_services;\n    \n\n    , service_selector AS (\n    SELECT a.service_name,\n           a.selector,\n           replace(replace(replace(a.selector, '.', ', '), '[', ', '), ']', '') AS selector_path,\n           a.data_type,\n           a.display_name AS field_display_name,\n           a.name AS field_name,\n           a.description AS field_description,\n           a.data_source,\n           a.source_type\n    FROM attributes a\n    WHERE a.display_name NOT LIKE '%Reason Codes%'\n    )\n\n--select * from service_selector;\n    \n    , asp AS (\n    SELECT es.evaluation_id,\n           es.service_id,\n           es.service_name,\n           ss.field_name,\n           ss.field_display_name,\n           --es.alloy_review #>> format('{%s}' :: text, ss.selector_path) :: text [] AS extracted,\n           coalesce(es.alloy_review #>> format('{%s}' :: text, ss.selector_path) :: text [],\n             es.alloy_review #>> format('{%s}' :: text, ss.selector_path || 's') :: text []) AS extracted,\n           ss.field_description,\n           ss.data_source,\n           ss.data_type,\n           'asp_atttrs' :: text AS provenance\n    FROM eval_services es\n           JOIN service_selector ss USING (service_name)\n    WHERE ss.source_type = 'asp'\n    )\n\nSELECT evaluation_id as evaluation_review_id,\n       service_id,\n       service_name,\n       field_name,\n       field_display_name,\n       case when field_name = 'reason' then replace(replace(replace(extracted,'[',''),']',''),'\"','')\n          else extracted end as extracted,\n       field_description,\n       data_source,\n       data_type,\n       provenance\nFROM asp\n       JOIN evaluation_reviews ev ON asp.evaluation_id = ev.id\nwhere 1=1\n  and extracted is not null\n;"}}}},"visible":true},"9":{"slot":9,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"11":{"slot":11,"name":"JDBC Options","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ssl"},"2":{"slot":2,"type":"STRING","value":"true"}}}},"visible":true},"12":{"slot":12,"name":"Concurrency","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"2"}}}},"visible":true},"13":{"slot":13,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ETL"}}}},"visible":true},"14":{"slot":14,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"alloy_evaluation_reviews_parsed_staging"}}}},"visible":true},"15":{"slot":15,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"16":{"slot":16,"name":"S3 Staging Area","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"aspiration-etl-staging"}}}},"visible":true},"17":{"slot":17,"name":"Primary Keys","elements":{},"visible":true},"20":{"slot":20,"name":"Data Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"101":{"slot":101,"name":"Basic/Advanced Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Advanced"}}}},"visible":true},"102":{"slot":102,"name":"Data Source","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"103":{"slot":103,"name":"Data Selection","elements":{},"visible":false},"104":{"slot":104,"name":"Data Source Filter","elements":{},"visible":false},"105":{"slot":105,"name":"Combine Filters","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":false},"106":{"slot":106,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"100"}}}},"visible":false},"1001":{"slot":1001,"name":"","elements":{},"visible":false},"1992":{"slot":1992,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"1994":{"slot":1994,"name":"Stage","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"1995":{"slot":1995,"name":"Stage Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"1996":{"slot":1996,"name":"Stage Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"1997":{"slot":1997,"name":"New Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"1998":{"slot":1998,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"1999":{"slot":1999,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"2000":{"slot":2000,"name":"Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Standard"}}}},"visible":true},"40000":{"slot":40000,"name":"Encryption","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SSE KMS"}}}},"visible":true},"40001":{"slot":40001,"name":"KMS Key ID","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${kms_s3_key}"}}}},"visible":false},"40501":{"slot":40501,"name":"","elements":{},"visible":false},"40502":{"slot":40502,"name":"Load Options","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"On"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"Off"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"On"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"On"}}}},"visible":true},"63320":{"slot":63320,"name":"Storage Account","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"63321":{"slot":63321,"name":"Blob Container","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"84533":{"slot":84533,"name":"Integration","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"88340":{"slot":88340,"name":"","elements":{},"visible":false},"88341":{"slot":88341,"name":"Staging","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Existing Amazon S3 Location"}}}},"visible":true},"98776":{"slot":98776,"name":"GCS Staging Area","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2961637":{"id":2961637,"sourceID":2961642,"targetID":2961643}},"failureConnectors":{},"unconditionalConnectors":{"2961636":{"id":2961636,"sourceID":2961640,"targetID":2961642}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{"db_name":{"definition":{"name":"db_name","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"web_db"},"pk_cols":{"definition":{"name":"pk_cols","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"(id)"},"rds_endpoint":{"definition":{"name":"rds_endpoint","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"prod-web-db-analytics.ctawxryivyva.us-west-2.rds.amazonaws.com:5432"},"source_schema":{"definition":{"name":"source_schema","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"public"},"table_name":{"definition":{"name":"table_name","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"account"},"table_schema":{"definition":{"name":"table_schema","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"web_db"},"update_column_name":{"definition":{"name":"update_column_name","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"last_updated"}},"grids":{}},"info":{"name":"load alloy_evaluations_review staging","description":"","type":"ORCHESTRATION","tag":"6fa68e51-4812-47ff-b697-6f01dd6cc363"}}