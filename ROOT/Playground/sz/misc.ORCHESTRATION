{"job":{"components":{"2958160":{"id":2958160,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-384,"y":-16,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2958245,2958248,2958250],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2958162":{"id":2958162,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-144,"y":96,"width":32,"height":32,"inputConnectorIDs":[2958245],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Copy of update file name variable"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\ndef func(id):\n  cursor = context.cursor()\n  query = \"SELECT MAX(attachments) FROM edw.etl_mail WHERE id = '\" + str(id) + \"'\"\n  cursor.execute(query)\n  result = cursor.fetchone()\n  if result == (u';',):\t\n   \treturn\n\n  file_name = result[0].split(';')[2].replace(' ', '_')\n  #context.updateVariable(\"pdf_file_name_old\", file_name)\n  #print(pdf_file_name_old)\n  print('old name: ' + file_name)\n  file_name = file_name.lower()\n  print('lower name: ' + file_name)\n\n\nfor i in range(1, 11):\n\tfunc(i)\n    \n\n    "}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2958163":{"id":2958163,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-112,"y":-48,"width":32,"height":32,"inputConnectorIDs":[2958250],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SQL Script 0"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\ncreate table rdl.young_turks\n(\n    email  varchar(50)\n)\n;\n\ncopy rdl.young_turks\nfrom 's3://aspiration-datateam/dump/szhang/TYT Sweepstakes Registration.csv'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\ncsv\nIGNOREHEADER 1\n;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2958249":{"id":2958249,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-192,"y":208,"width":32,"height":32,"inputConnectorIDs":[2958248],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Copy of update file name variable (1)"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"def func(id):\n  cursor = context.cursor()\n  query = \"SELECT MAX(attachments) FROM edw.etl_mail WHERE id = '\" + str(id) + \"'\"\n  cursor.execute(query)\n  result = cursor.fetchone()\n  if result == (u';',):\t\n   \treturn context.updateVariable(\"attachment\", \"0\")\n\n  file_name = result[0].split(';')[2].replace(' ', '_')\n  context.updateVariable(\"pdf_file_name_old\", file_name)\n  print(pdf_file_name_old)\n  file_name = file_name.lower()\n\n  if (file_name.find(\"expense\") != -1 and file_name.endswith(\".pdf\")):\n    file_name = \"coastal_exp_reimb_\" + file_name.split('.')[0] + \"_\" + str(id) + \".pdf\"\n    context.updateVariable(\"parsing_job\", \"pnl_etl_coastal_exp_reimb_txt_to_table\")\n  elif (file_name.find(\"quarter\") != -1 and file_name.find(\"fee\") != -1 and file_name.endswith(\".pdf\")):\n    file_name = \"coastal_quart_fee_\" + file_name.split('.')[0] + \"_\" + str(id) + \".pdf\"\n    context.updateVariable(\"parsing_job\", \"pnl_etl_coastal_quarterly_fee\")\n  elif (file_name.find(\"zendes\") != -1 and file_name.endswith(\".pdf\")):\n    file_name = \"call_center_zen_\" + file_name.split('.')[0] + \"_\" + str(id) + \".pdf\"\n    context.updateVariable(\"parsing_job\", \"pnl_etl_zendesk_txt_to_table\")\n  elif (file_name.find(\"talkdes\") != -1 and file_name.endswith(\".pdf\")):\n    file_name = \"call_center_talk_\" + file_name.split('.')[0] + \"_\" + str(id) + \".pdf\"\n    context.updateVariable(\"parsing_job\", \"pnl_etl_talkdesk_txt_to_table\")\n  elif (file_name.find(\"return\") != -1 and file_name.endswith(\".pdf\")):\n    file_name = \"return_fees_\" + file_name.split('.')[0] + \"_\" + str(id) + \".pdf\"\n    context.updateVariable(\"parsing_job\", \"pnl_etl_return_fee_txt_to_table\")\n  elif (file_name.find(\"process\") != -1 and file_name.endswith(\".pdf\")):\n    file_name = \"galileo_processing_fees_\" + file_name.split('.')[0] + \"_\" + str(id) + \".pdf\"\n    context.updateVariable(\"parsing_job\", \"pnl_etl_galileo_processing_fee_txt_to_table\")\n  elif ((file_name.find(\"360\") != -1 or file_name.find(\"363\") != -1\n         or file_name.find(\"flagship\") != -1 or file_name.find(\"redwood\") != -1)\n        and file_name.endswith(\".pdf\")):\n    file_name = \"nottingham_\" + file_name.split('.')[0] + \"_\" + str(id) + \".pdf\"\n    context.updateVariable(\"parsing_job\", \"pnl_etl_nottingham_txt_to_table\")\n \n  context.updateVariable(\"pdf_file_name_new\", file_name)\n  context.updateVariable(\"pdf_archived_file_name\", 'pdf_archive/' + file_name + '.bak')\n  print(pdf_file_name_new)\n  context.updateVariable(\"TXT_Name\", \"txt/\"+file_name[:-4]+\".txt\")\n  context.updateVariable(\"txt_archived_file_name\", \"txt_archive/\"+file_name[:-4]+\".txt\")\n  print(TXT_Name)\n  \nfor i in range(1, 11):\n\tfunc(i)\n    "}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{},"failureConnectors":{},"unconditionalConnectors":{"2958245":{"id":2958245,"sourceID":2958160,"targetID":2958162},"2958248":{"id":2958248,"sourceID":2958160,"targetID":2958249},"2958250":{"id":2958250,"sourceID":2958160,"targetID":2958163}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{"EC2_folder":{"definition":{"name":"EC2_folder","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"/tmp/aspiration-pnl-project"},"S3_Bucket":{"definition":{"name":"S3_Bucket","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"s3://aspiration-pnl-project-staging"},"TXT_Name":{"definition":{"name":"TXT_Name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"txt/call_center_talk_talkdesk_invoice_3.txt"},"attachment":{"definition":{"name":"attachment","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"1"},"mail_id":{"definition":{"name":"mail_id","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"1"},"parsing_job":{"definition":{"name":"parsing_job","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"pdf_archived_file_name":{"definition":{"name":"pdf_archived_file_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"pdf_archive/call_center_talk_talkdesk_invoice_3.pdf.bak"},"pdf_file_name_new":{"definition":{"name":"pdf_file_name_new","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"call_center_talk_talkdesk_invoice_3.pdf"},"pdf_file_name_old":{"definition":{"name":"pdf_file_name_old","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"txt_archived_file_name":{"definition":{"name":"txt_archived_file_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"txt_archive/call_center_talk_talkdesk_invoice_3.txt"}},"grids":{}},"info":{"name":"misc","description":null,"type":"ORCHESTRATION","tag":"86cf59df-3047-4681-ac36-1de3de21e8a8"}}