{"job":{"components":{"2957240":{"id":2957240,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":237373210,"x":-1856,"y":-32,"width":32,"height":32,"inputConnectorIDs":[2957239],"outputSuccessConnectorIDs":[2957243],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Copy of Truncate ACH tables (4)"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957241":{"id":2957241,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":773867971,"x":-1568,"y":-32,"width":32,"height":32,"inputConnectorIDs":[2957243],"outputSuccessConnectorIDs":[2957242],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Copy of S3 Load ACH file"}}}},"visible":true},"4":{"slot":4,"name":"S3 Object Prefix","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${file_name}"}}}},"visible":true},"7":{"slot":7,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"8":{"slot":8,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ach_file_staging"}}}},"visible":true},"9":{"slot":9,"name":"Load Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"row_index_number"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"record_type"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"ach_data"}}}},"visible":true},"23":{"slot":23,"name":"Date Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":true},"24":{"slot":24,"name":"Time Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":true},"26":{"slot":26,"name":"","elements":{},"visible":false},"27":{"slot":27,"name":"Escape","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957244":{"id":2957244,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-1264,"y":-32,"width":32,"height":32,"inputConnectorIDs":[2957242],"outputSuccessConnectorIDs":[2957237],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Unload file sections"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"unload ('select ach_data from ${staging_schema}.${file_staging_table_name} where record_type = ''1''')\nto '${file_staging_path}/ach_file_header_${file_name}'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nparallel off\nallowoverwrite\n;\n\nunload ('select row_index_number,ach_data from ${staging_schema}.${file_staging_table_name} where record_type = ''5''')\nto '${file_staging_path}/ach_batch_header_${file_name}'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'row_index_number:6,ach_data:93'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nparallel off\nallowoverwrite\n;\n\nunload ('select row_index_number,ach_data from ${staging_schema}.${file_staging_table_name} where record_type = ''6''')\nto '${file_staging_path}/ach_entry_detail_${file_name}'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'row_index_number:6,ach_data:93'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nparallel off\nallowoverwrite\n;\n\nunload ('select row_index_number,ach_data from ${staging_schema}.${file_staging_table_name} where record_type = ''7''')\nto '${file_staging_path}/ach_addenda_record_${file_name}'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'row_index_number:6,ach_data:93'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nparallel off\nallowoverwrite\n;\n\n\nunload ('select ach_data from ${staging_schema}.${file_staging_table_name} where record_type = ''8''')\nto '${file_staging_path}/ach_batch_control_${file_name}'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nparallel off\nallowoverwrite\n;\n\nunload ('select ach_data from ${staging_schema}.${file_staging_table_name} where record_type = ''9'' and ach_data != replicate(''9'', 93)')\nto '${file_staging_path}/ach_file_control_${file_name}'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nparallel off\nallowoverwrite\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957245":{"id":2957245,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-2112,"y":-32,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2957239],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957246":{"id":2957246,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-944,"y":-32,"width":32,"height":32,"inputConnectorIDs":[2957236],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Update RAW ACH table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"delete from rdl.ach_batch_header\nwhere file_name = '${file_name}'\n;\n\ninsert into rdl.ach_batch_header(file_name, file_date, row_index_number, service_class_code, company_name, company_discretionary_data, company_identification, standard_entry_class_code, company_entry_description, company_descriptive_date, effective_entry_date, settlement_date_julian, originator_status_code, originating_dfi_identification, batch_number)\nselect '${file_name}','${current_year}-${current_month}-${current_day}',row_index_number, service_class_code, company_name, company_discretionary_data, company_identification, standard_entry_class_code, company_entry_description, company_descriptive_date, effective_entry_date, settlement_date_julian, originator_status_code, originating_dfi_identification, batch_number\nfrom etl.ach_batch_header_staging\n;\n\n\ndelete from rdl.raw_ach_data\nwhere file_name = '${file_name}';\n\ninsert into rdl.raw_ach_data(file_name, file_date,row_index_number,\n                             transaction_code, receiving_dfi_identification,\n                             check_digit, dfi_account_number, amount,\n                             individual_identification_number__identification_number__check_serial_number,\n                             individual_name__receiving_company_name, discretionary_data__payment_type_code__card_transaction_type_code,\n                             addenda_record_indicator, trace_number, return_reason_code, return_date)\nselect '${file_name}', '${current_year}-${current_month}-${current_day}', aeds.row_index_number::bigint, transaction_code::bigint, receiving_dfi_identification, check_digit::int,\ndfi_account_number, (amount/100.00)::numeric(14,2), individual_identification_number__identification_number__check_serial_number, individual_name__receiving_company_name,\ndiscretionary_data__payment_type_code__card_transaction_type_code,\naddenda_record_indicator::int, trace_number::bigint, regexp_substr(aars.payment_related_information, '^R\\\\d\\\\d') as return_reason_code,\nnvl2(return_reason_code,'${current_year}-${current_month}-${current_day}'::date, NULL) as return_date\nfrom etl.ach_entry_detail_staging aeds\nleft join (select payment_related_information, addenda_type_code, entry_detail_sequence_number\n                  from\n  etl.ach_addenda_record_staging \n  where addenda_type_code = '99') aars on right(aeds.trace_number,7) = aars.entry_detail_sequence_number;\n\ndelete from rdl.ach_addenda_record\nwhere file_name = '${file_name}'\n;\n\ninsert into rdl.ach_addenda_record(raw_ach_data_id\n,etl_load_date\n,file_name\n,file_date\n,row_index_number\n,addenda_type_code\n,payment_related_information\n,addenda_sequence_number\n,entry_detail_sequence_number)\nselect rad.raw_ach_data_id,aars.etl_load_date, '${file_names}','${current_year}-${current_month}-${current_day}',aars.row_index_number::bigint,\n       addenda_type_code::int,aars.payment_related_information,addenda_sequence_number,entry_detail_sequence_number::bigint\nfrom etl.ach_addenda_record_staging aars\nleft join rdl.raw_ach_data rad on right(rad.trace_number,7) = aars.entry_detail_sequence_number\nwhere file_name = '${file_name}';\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957247":{"id":2957247,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-1088,"y":-32,"width":32,"height":32,"inputConnectorIDs":[2957237],"outputSuccessConnectorIDs":[2957236],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Load file sections"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"copy ${staging_schema}.ach_file_header_staging(priority_code, immediate_destination, immediate_origin, file_creation_date, file_creation_time, file_id_modifier, record_size, blocking_factor, format_code, immediate_destination_name, immediate_origin_name, reference_code)\nfrom '${file_staging_path}/ach_file_header_${file_name}'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'priority_code:2,immediate_destination:10,immediate_origin:10,file_creation_date:6,file_creation_time:4,file_id_modifier:1,record_size:3,blocking_factor:2,format_code:1,immediate_destination_name:23,immediate_origin_name:23,reference_code:8'\n;\n\ncopy ${staging_schema}.ach_batch_header_staging(row_index_number, service_class_code, company_name, company_discretionary_data, company_identification, standard_entry_class_code, company_entry_description, company_descriptive_date, effective_entry_date, settlement_date_julian, originator_status_code, originating_dfi_identification, batch_number)\nfrom '${file_staging_path}/ach_batch_header_${file_name}'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'row_index_number:6, service_class_code:3,company_name:16,company_discretionary_data:20,company_identification:10,standard_entry_class_code:3,company_entry_description:10,company_descriptive_date:6,effective_entry_date:6,settlement_date_julian:3,originator_status_code:1,originating_dfi_identification:8,batch_number:7'\n;\n\ncopy ${staging_schema}.ach_entry_detail_staging(row_index_number, transaction_code, receiving_dfi_identification, check_digit, dfi_account_number, amount, individual_identification_number__identification_number__check_serial_number, individual_name__receiving_company_name, discretionary_data__payment_type_code__card_transaction_type_code, addenda_record_indicator, trace_number)\nfrom '${file_staging_path}/ach_entry_detail_${file_name}'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'row_index_number:6, transaction_code:2,receiving_dfi_identification:8,check_digit:1,dfi_account_number:17,amount:10,individual_identification_number__identification_number__check_serial_number:15,individual_name__receiving_company_name:22,discretionary_data__payment_type_code__card_transaction_type_code:2,addenda_record_indicator:1,trace_number:15'\n;\n\ncopy ${staging_schema}.ach_addenda_record_staging(row_index_number, addenda_type_code,payment_related_information,addenda_sequence_number,entry_detail_sequence_number)\nfrom '${file_staging_path}/ach_addenda_record_${file_name}'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'row_index_number:6, addenda_type_code:2,payment_related_information:80,addenda_sequence_number:4,entry_detail_sequence_number:7,'\n;\n\ncopy ${staging_schema}.ach_batch_control_staging(service_class_code, entry__addenda_count, entry_hash, total_debit_entry_dollar_amount_in_batch, total_credit_entry_dollar_amount_in_batch, company_identification, message_authentication_code, reserved, originating_dfi_identification, batch_number)\nfrom '${file_staging_path}/ach_batch_control_${file_name}'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'service_class_code:3,entry__addenda_count:6,entry_hash:10,total_debit_entry_dollar_amount_in_batch:12,total_credit_entry_dollar_amount_in_batch:12,company_identification:10,message_authentication_code:19,reserved:6,originating_dfi_identification:8,batch_number:7'\n;\n\ncopy ${staging_schema}.ach_file_control_staging(batch_count, block_count, entry__addenda_count, entry_hash, total_debit_entry_dollar_amount_in_file, total_credit_entry_dollar_amount_in_file, reserved)\nfrom '${file_staging_path}/ach_file_control_${file_name}'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'batch_count:6,block_count:6,entry__addenda_count:8,entry_hash:10,total_debit_entry_dollar_amount_in_file:12,total_credit_entry_dollar_amount_in_file:12,reserved:39'\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2957236":{"id":2957236,"sourceID":2957247,"targetID":2957246},"2957237":{"id":2957237,"sourceID":2957244,"targetID":2957247},"2957242":{"id":2957242,"sourceID":2957241,"targetID":2957244},"2957243":{"id":2957243,"sourceID":2957240,"targetID":2957241}},"failureConnectors":{},"unconditionalConnectors":{"2957239":{"id":2957239,"sourceID":2957245,"targetID":2957240}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{"current_day":{"definition":{"name":"current_day","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"07"},"current_month":{"definition":{"name":"current_month","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"11"},"current_year":{"definition":{"name":"current_year","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"2019"},"file_name":{"definition":{"name":"file_name","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"ACHACHP125108997PD20191107T140517.ACHACHP125108997PD20191107T140517"},"file_staging_path":{"definition":{"name":"file_staging_path","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"s3://aspiration-etl-staging/file_processing/ach/staging_files"},"file_staging_table_name":{"definition":{"name":"file_staging_table_name","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"ach_file_staging"},"parsed_file_path":{"definition":{"name":"parsed_file_path","type":"TEXT","scope":"BRANCH","description":"Where python will download the decrypted file and upload the split lined file\n","visibility":"PUBLIC"},"value":"s3://aspiration-etl-staging/file_processing/ach/coastal_file_drop"},"s3_file_path":{"definition":{"name":"s3_file_path","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"2018/11"},"s3_filename":{"definition":{"name":"s3_filename","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"test_20181112.csv"}},"grids":{"ach_table_list":{"definition":{"name":"ach_table_list","scope":"BRANCH","definitions":[{"name":"table_name","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[{"values":["ach_file_staging"]},{"values":["ach_file_header_staging"]},{"values":["ach_batch_header_staging"]},{"values":["ach_entry_detail_staging"]},{"values":["ach_batch_control_staging"]},{"values":["ach_file_control_staging"]},{"values":["ach_addenda_record_staging"]}]},"file_name_list":{"definition":{"name":"file_name_list","scope":"BRANCH","definitions":[{"name":"file_names","type":"TEXT"}],"description":"list of file names","visibility":"PUBLIC"},"values":[]}}},"info":{"name":"load_ach_file_parser_day","description":"","type":"ORCHESTRATION","tag":"21f24090-b286-49d4-9b8a-49925ed35c10"}}