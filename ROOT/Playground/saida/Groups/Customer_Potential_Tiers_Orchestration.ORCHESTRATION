{"job":{"components":{"2960450":{"id":2960450,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-496,"y":-16,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2960484],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Start","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2960488":{"id":2960488,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":91,"y":153,"width":32,"height":32,"inputConnectorIDs":[2960486],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Send Alert to Pager Duty - CPT2"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"us-west-2"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"data-alerts-pagerduty-prod"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AWS Notification Message"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"Customer Potential Tier\" job failed"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2960489":{"id":2960489,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":-112,"y":160,"width":32,"height":32,"inputConnectorIDs":[2960487],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Send Alert to Pager Duty - CPT1"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"us-west-2"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"data-alerts-pagerduty-prod"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AWS Notification Message"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"Customer Potential Tier\" job failed"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2960492":{"id":2960492,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-320,"y":-16,"width":32,"height":32,"inputConnectorIDs":[2960484],"outputSuccessConnectorIDs":[2960485],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Create_CUSTOMER_POTENTIAL_TIERS_stg1"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"--create stage1 table \ncreate or replace table ADW.PUBLIC.CUSTOMER_POTENTIAL_TIERS_STG1\n(\n\tUNIQUE_ACCOUNT_ID VARCHAR(16777216),\n\tUSER_ID NUMBER(38,0),\n\tINCEPTION_DATE TIMESTAMP_NTZ(9),\n\tINITIAL_TRANSFER_POSTED_DATE TIMESTAMP_TZ(9),\n\tINITIAL_TRANSFER_POSTED_AMOUNT NUMBER(38,20),\n\tFUNDING_AMOUNT NUMBER(38,4),\n\tIS_CHARGED_OFF BOOLEAN,\n\tTERMINATION_DATE TIMESTAMP_TZ(9),\n\tLEAD_ARRIVAL_DATE TIMESTAMP_TZ(9),\n\tPWIF_AMOUNT NUMBER(38,12),\n\tUTM_SOURCE VARCHAR(16777216),\n\tADJUST_MEDIA_SOURCE VARCHAR(16777216),\n\tINSTALL_TIME TIMESTAMP_NTZ(0),\n\tINVITING_USER_ID NUMBER(38,0),\n\tTYPE VARCHAR(16777216),\n\tLEAD_TO_FUND NUMBER(9,0),\n\tLEAD_TO_INCEPT NUMBER(9,0),\n\tTIER NUMBER(38,0),\n\tOLD_TIER VARCHAR(16777216),\n\tTOP_UTM_SOURCE VARCHAR(13),\n\tMEDIA_SOURCE VARCHAR(16777216),\n\tPLAT_FORM VARCHAR(5),\n\tACTIVE_FLAG BOOLEAN,\n\tAPOLOGY_FLAG BOOLEAN,\n\tUTM_GROUP VARCHAR(16),\n\tMONTHS_ACTIVE_FIRST_YEAR NUMBER(18,0),\n\tUSER_EMAIL VARCHAR(16777216),\n\tEXTERNAL_USER_ID VARCHAR(255),\n\tMOST_RECENT_CHARGED_OFF_DATE VARCHAR(100),\n\tDAYS_SINCE_FUNDING NUMBER(9,0),\n\tTOTAL_REVENUE_FIRST_30_DAYS FLOAT,\n\tTOTAL_REVENUE_FIRST_90_DAYS FLOAT,\n\tTOTAL_REVENUE_FIRST_365_DAYS FLOAT,\n\tPWIF_REVENUE_FIRST_90_DAYS NUMBER(38,20),\n\tAPLUS_REVENUE_FIRST_90_DAYS NUMBER(38,20),\n\tIDEAL_GROUP BOOLEAN,\n\tINCEPT_3 VARCHAR(16777216),\n\tMULTIPLER_365 FLOAT,\n\tFUNDED_365_TO_3INC_RATIO NUMBER(24,6),\n\tINCEPTED_365_TO_INCEPT_3_RATIO NUMBER(24,6),\n\tAVG_90_DAY_PROJECTION FLOAT,\n\tPROJECTED_365_REVENUE FLOAT\n);\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2960493":{"id":2960493,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":304,"y":-16,"width":32,"height":32,"inputConnectorIDs":[2960490],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Customer_Potential_Tiers_Incr_looker"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"--capture diffrence with out email column\ninsert into adw.rdl.CUSTOMER_POTENTIAL_TIERS_INCR_FULL\nselect UNIQUE_ACCOUNT_ID, user_id, external_user_id, tier, \nconvert_timezone('UTC','America/Los_Angeles',current_timestamp::timestamp) as etl_load_date\nfrom adw.public.CUSTOMER_POTENTIAL_TIERS_STG1\nminus\nselect UNIQUE_ACCOUNT_ID, user_id, external_user_id, tier,\nconvert_timezone('UTC','America/Los_Angeles',current_timestamp::timestamp) as etl_load_date\nfrom adw.public.CUSTOMER_POTENTIAL_TIERS_STG2;\n\n--Load latest incremental records for looker\ntruncate table adw.rdl.CUSTOMER_POTENTIAL_TIERS_INCR;\n\ninsert into adw.rdl.CUSTOMER_POTENTIAL_TIERS_INCR\nselect incr.*, dsa.AVG_90_DAY_PROJECTION, dsa.PROJECTED_365_REVENUE from adw.rdl.CUSTOMER_POTENTIAL_TIERS_INCR_FULL incr\njoin adw.public.CUSTOMER_POTENTIAL_TIERS_STG1 dsa on dsa.UNIQUE_ACCOUNT_ID = incr.UNIQUE_ACCOUNT_ID and dsa.USER_ID = incr.USER_ID and dsa.EXTERNAL_USER_ID = incr.EXTERNAL_USER_ID\nwhere incr.etl_load_date = (select max(etl_load_date) from adw.rdl.CUSTOMER_POTENTIAL_TIERS_INCR_FULL)\nand incr.UNIQUE_ACCOUNT_ID not in (select UNIQUE_ACCOUNT_ID from (select UNIQUE_ACCOUNT_ID, count(UNIQUE_ACCOUNT_ID) cnt \n                                     from adw.rdl.CUSTOMER_POTENTIAL_TIERS_INCR_FULL group by UNIQUE_ACCOUNT_ID  having count(UNIQUE_ACCOUNT_ID)>1));\n\n--drop stage2\ndrop table adw.public.CUSTOMER_POTENTIAL_TIERS_STG2;\n\n--rename stage1 as stage2\nalter table adw.public.CUSTOMER_POTENTIAL_TIERS_STG1 rename to adw.public.CUSTOMER_POTENTIAL_TIERS_STG2;\n\n\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2960494":{"id":2960494,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":92,"y":-11,"width":32,"height":32,"inputConnectorIDs":[2960491],"outputSuccessConnectorIDs":[2960490],"outputFailureConnectorIDs":[2960486],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Customer Potential Tiers 2"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Customer Potential Tiers 2"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2960495":{"id":2960495,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":-112,"y":-16,"width":32,"height":32,"inputConnectorIDs":[2960485],"outputSuccessConnectorIDs":[2960491],"outputFailureConnectorIDs":[2960487],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Customer Potential Tiers 1"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Customer Potential Tiers 1"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2960485":{"id":2960485,"sourceID":2960492,"targetID":2960495},"2960490":{"id":2960490,"sourceID":2960494,"targetID":2960493},"2960491":{"id":2960491,"sourceID":2960495,"targetID":2960494}},"failureConnectors":{"2960486":{"id":2960486,"sourceID":2960494,"targetID":2960488},"2960487":{"id":2960487,"sourceID":2960495,"targetID":2960489}},"unconditionalConnectors":{"2960484":{"id":2960484,"sourceID":2960450,"targetID":2960492}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{},"grids":{}},"info":{"name":"Customer_Potential_Tiers_Orchestration","description":"DSA_878\nhttps://aspirationpartners.atlassian.net/browse/DSA-878","type":"ORCHESTRATION","tag":"930db7d2-331c-4042-9104-e4ea44b42b6c"}}