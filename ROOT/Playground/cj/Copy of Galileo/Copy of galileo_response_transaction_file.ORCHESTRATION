{"job":{"components":{"2957568":{"id":2957568,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":0,"y":0,"width":32,"height":32,"inputConnectorIDs":[2957598],"outputSuccessConnectorIDs":[2957594],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Cleanup"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DROP TABLE IF EXISTS ${staging_schema}.${staging_table};"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957569":{"id":2957569,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-480,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2957588],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957570":{"id":2957570,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-400,"y":0,"width":32,"height":32,"inputConnectorIDs":[2957588],"outputSuccessConnectorIDs":[2957593],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Variables"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Udating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\nimport datetime\n\n#add run_history_id to create a unique temp table for parrallel processing\ncontext.updateVariable(\"staging_table\", staging_table + str(run_history_id) + '_${file_number}')\n\n#add YYYYMMDD to batch_filename varible \n#add value in batch_filename_sequence variable\n#Note: date calc rolls to next day when processed after 5pm MT or 4pm PT (Galileo is no longer processing at this time)\n#context.updateVariable(\"batch_filename\", batch_filename + datetime.date.today().strftime('%Y') + datetime.date.today().strftime('%m') + datetime.date.today().strftime('%d') + str(run_history_id) + '.txt')"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957571":{"id":2957571,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-160,"y":0,"width":32,"height":32,"inputConnectorIDs":[2957592],"outputSuccessConnectorIDs":[2957595],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Store"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INSERT INTO rdl.galileo_batch_response \n\t(ETL_RUN_HISTORY_ID\n    ,ETL_TIMESTAMP\n    ,ETL_FILENAME\n    ,H_RECORD_TYPE\n    ,H_HEADER\n    ,H_CLIENT_ID\n    ,H_PROGRAM_ID\n    ,H_FILE_NAME\n    ,H_FILE_TRANSMIT_DATE\n    ,D_RECORD_TYPE\n    ,D_RECORD_NUMBER\n    ,D_ACCOUNT_ID_TYPE\n    ,D_ACCOUNT_IDENTIFIER\n    ,D_TRANSACTION_IDENTIFIER\n    ,D_RESPONSE_CODE\n    ,T_RECORD_TYPE\n    ,T_TRAILER\n    ,T_COUNT)\nWITH\n\traw_row_data AS (\n      SELECT row_number() over(order by rownum asc)-1 AS rownum\n         , first_value(raw_row_data) over(order by rownum asc rows between unbounded preceding and unbounded following) AS raw_header_row\n         , raw_row_data AS raw_detail_row\n         , last_value(raw_row_data) over(order by rownum asc rows between unbounded preceding and unbounded following) AS raw_trailer_row\n      FROM ${staging_schema}.${staging_table}\n      GROUP BY rownum, raw_row_data\n      ORDER BY rownum ASC\n      )\nSELECT '${run_history_id}' \t\tAS ETL_RUN_HISTORY_ID\n\t , sysdate\t\t\t\t\tAS ETL_TIMESTAMP\n\t , '${input_filename}'\t\tAS ETL_FILENAME\n     \n\t , substring(raw_header_row,1,1)\t--H_RECORD_TYPE\n\t , substring(raw_header_row,2,6)\t--H_HEADER\n\t , substring(raw_header_row,8,10)\t--H_CLIENT_ID\n\t , substring(raw_header_row,18,10)\t--H_PROGRAM_ID\n\t , substring(raw_header_row,28,50)\t--H_FILE_NAME\n\t , substring(raw_header_row,78,8)\t--H_FILE_TRANSMIT_DATE\n     \n\t , substring(raw_detail_row,1,1)\t--D_RECORD_TYPE\n\t , substring(raw_detail_row,2,6)\t--D_RECORD_NUMBER\n\t , substring(raw_detail_row,8,1)\t--D_ACCOUNT_ID_TYPE\n\t , substring(raw_detail_row,9,50)\t--D_ACCOUNT_IDENTIFIER\n\t , substring(raw_detail_row,59,20)\t--D_TRANSACTION_IDENTIFIER\n\t , substring(raw_detail_row,79,4)\t--D_RESPONSE_CODE\n     \n\t , substring(raw_trailer_row,1,1)\t--T_RECORD_TYPE\n\t , substring(raw_trailer_row,2,7)\t--T_TRAILER\n\t , substring(raw_trailer_row,9,6)\t--T_COUNT\nFROM raw_row_data\nWHERE raw_header_row <> raw_detail_row\n  AND raw_trailer_row <> raw_detail_row;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957574":{"id":2957574,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":773867971,"x":-240,"y":0,"width":32,"height":32,"inputConnectorIDs":[2957589],"outputSuccessConnectorIDs":[2957592],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Load"}}}},"visible":true},"4":{"slot":4,"name":"S3 Object Prefix","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${input_filename}"}}}},"visible":true},"7":{"slot":7,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${staging_schema}"}}}},"visible":true},"8":{"slot":8,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${staging_table}"}}}},"visible":true},"9":{"slot":9,"name":"Load Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_row_data"}}}},"visible":true},"23":{"slot":23,"name":"Date Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":true},"24":{"slot":24,"name":"Time Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":true},"26":{"slot":26,"name":"","elements":{},"visible":false},"27":{"slot":27,"name":"Escape","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957596":{"id":2957596,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-320,"y":0,"width":32,"height":32,"inputConnectorIDs":[2957593],"outputSuccessConnectorIDs":[2957589],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Stage"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DROP TABLE IF EXISTS ${staging_schema}.${staging_table};\nCREATE TABLE ${staging_schema}.${staging_table} (\n\trownum \t\t\t\t\tBIGINT IDENTITY(0,1),\n\traw_row_data\t \t\tVARCHAR(65535)\n\t);\nALTER TABLE ${staging_schema}.${staging_table}\n   OWNER TO svc_etl;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957597":{"id":2957597,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":80,"y":0,"width":32,"height":32,"inputConnectorIDs":[2957594],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957599":{"id":2957599,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-80,"y":0,"width":32,"height":32,"inputConnectorIDs":[2957595],"outputSuccessConnectorIDs":[2957598],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Transit"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DELETE\nFROM rdl.galileo_batch_transit\nWHERE replace('${input_filename}','.out','') = etl_filename"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2957589":{"id":2957589,"sourceID":2957596,"targetID":2957574},"2957592":{"id":2957592,"sourceID":2957574,"targetID":2957571},"2957593":{"id":2957593,"sourceID":2957570,"targetID":2957596},"2957594":{"id":2957594,"sourceID":2957568,"targetID":2957597},"2957595":{"id":2957595,"sourceID":2957571,"targetID":2957599},"2957598":{"id":2957598,"sourceID":2957599,"targetID":2957568}},"failureConnectors":{},"unconditionalConnectors":{"2957588":{"id":2957588,"sourceID":2957569,"targetID":2957570}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{"file_number":{"definition":{"name":"file_number","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""},"input_bucket":{"definition":{"name":"input_bucket","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"s3://aspiration-etl-staging/file_processing/galileo_batch_transactions/response_files"},"input_filename":{"definition":{"name":"input_filename","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"passed_variable"},"staging_table":{"definition":{"name":"staging_table","type":"TEXT","scope":"BRANCH","description":"","visibility":"PRIVATE"},"value":"tmp_response"}},"grids":{}},"info":{"name":"Copy of galileo_response_transaction_file","description":"","type":"ORCHESTRATION","tag":"51054dd0-0386-44c9-88a6-05cc3c9491be"}}