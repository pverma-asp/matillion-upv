{"job":{"components":{"2957656":{"id":2957656,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-160,"y":0,"width":32,"height":32,"inputConnectorIDs":[2957653],"outputSuccessConnectorIDs":[2957658],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Output"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"UNLOAD ('\n  SELECT redemption_id\n       , BatchDate\n       , DistributionAmount\n       , OrderID\n       , aspiration_transaction_id\n       , status\n  FROM etl.${staging_table}\n  ORDER BY etl_rownum ASC\n        ')\nTO '${output_bucket}/${output_filename}'\nIAM_ROLE 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nDELIMITER AS ','\nPARALLEL OFF ENCRYPTED\nALLOWOVERWRITE;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957657":{"id":2957657,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-240,"y":0,"width":32,"height":32,"inputConnectorIDs":[2957659],"outputSuccessConnectorIDs":[2957653],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Temp"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE etl.${staging_table} AS\n   (SELECT 0 \t\t\t\t\t\t\t\t\t  AS etl_rownum\n\t\t, 'redemption_id'\t\t\t\t::VARCHAR AS redemption_id\n\t\t, 'BatchDate'\t\t\t\t\t::VARCHAR AS BatchDate\n\t\t, 'DistributionAmount'\t\t\t::VARCHAR AS DistributionAmount\n\t\t, 'OrderID'\t\t\t\t\t\t::VARCHAR AS OrderID\n\t\t, 'aspiration_transaction_id'\t::VARCHAR AS aspiration_transaction_id\n\t\t, 'status'\t\t\t\t\t\t::VARCHAR AS status\n   UNION ALL\n   SELECT red.etl_rownum \t\t\t\t\t\t  AS etl_rownum\n\t\t, red.redemption_code\t\t\t::VARCHAR AS redemption_id\n\t\t, red.batch_date \t\t\t\t::VARCHAR AS BatchDate\n\t\t, red.distribution_amount\t\t::VARCHAR AS DistributionAmount\n\t\t, red.order_id\t\t\t\t\t::VARCHAR AS OrderID\n\t\t, red.transaction_identifier\t::VARCHAR AS aspiration_transaction_id\n\t\t, res.response_code\t\t\t\t::VARCHAR AS status\n   FROM rdl.swagbucks_response res\n   JOIN rdl.swagbucks_redemption red ON red.transaction_identifier = res.transaction_identifier\n   WHERE res.etl_filename = '${output_filename}')\n   ORDER BY etl_rownum ASC"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957660":{"id":2957660,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-320,"y":0,"width":32,"height":32,"inputConnectorIDs":[2957655],"outputSuccessConnectorIDs":[2957659],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Store"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INSERT INTO rdl.swagbucks_response \n\t( etl_run_history_id\n\t, etl_timestamp\n\t, etl_filename\n\t, file_transmit_date\n\t, transaction_identifier\n\t, response_code)\nSELECT '${run_history_id}' \t\tAS ETL_RUN_HISTORY_ID\n\t , sysdate\t\t\t\t\tAS ETL_TIMESTAMP\n\t , '${output_filename}' \tAS ETL_FILENAME\n     , t.paid_file_transmit_date\n     , t.transaction_identifier\n     , t.aspiration_response_code\nFROM rdl.swagbucks_redemption_status_v t\nWHERE t.etl_filename = '${input_filename}';"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957661":{"id":2957661,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-80,"y":0,"width":32,"height":32,"inputConnectorIDs":[2957658],"outputSuccessConnectorIDs":[2957652],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Cleanup"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DROP TABLE IF EXISTS ${staging_schema}.${staging_table};"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957662":{"id":2957662,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":0,"y":0,"width":32,"height":32,"inputConnectorIDs":[2957652],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957663":{"id":2957663,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-400,"y":0,"width":32,"height":32,"inputConnectorIDs":[2957654],"outputSuccessConnectorIDs":[2957655],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Variables"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Udating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\nimport re\n\n#add run_history_id to create a unique temp table for parrallel processing\ncontext.updateVariable(\"staging_table\", staging_table + str(run_history_id))\n\nre_pattern = r'^([^.]+)(([.]+[^.]+)*)$'\nre_replace = r'\\1_payouts\\2'\nre_string = '${input_filename}'\nre_output = re.sub(re_pattern,re_replace,re_string)\n\ncontext.updateVariable(\"output_filename\", re_output)\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957682":{"id":2957682,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-480,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2957654],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2957652":{"id":2957652,"sourceID":2957661,"targetID":2957662},"2957653":{"id":2957653,"sourceID":2957657,"targetID":2957656},"2957655":{"id":2957655,"sourceID":2957663,"targetID":2957660},"2957658":{"id":2957658,"sourceID":2957656,"targetID":2957661},"2957659":{"id":2957659,"sourceID":2957660,"targetID":2957657}},"failureConnectors":{},"unconditionalConnectors":{"2957654":{"id":2957654,"sourceID":2957682,"targetID":2957663}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{"file_number":{"definition":{"name":"file_number","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""},"input_filename":{"definition":{"name":"input_filename","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"passed_variable.out.txt"},"output_bucket":{"definition":{"name":"output_bucket","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"s3://aspiration-datateam/dump/cjohnson/swagbucks"},"output_filename":{"definition":{"name":"output_filename","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"staging_table":{"definition":{"name":"staging_table","type":"TEXT","scope":"BRANCH","description":"","visibility":"PRIVATE"},"value":"tmp_response"}},"grids":{}},"info":{"name":"Copy of swagbucks_response_transaction_file","description":"","type":"ORCHESTRATION","tag":"5408c670-b214-4c9f-97b5-395d3d3907d2"}}