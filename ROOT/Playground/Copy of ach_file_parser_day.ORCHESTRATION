{"job":{"components":{"2957151":{"id":2957151,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":237373210,"x":-1328,"y":176,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Truncate ACH tables"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957170":{"id":2957170,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":773867971,"x":-592,"y":112,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"S3 Load ACH file"}}}},"visible":true},"4":{"slot":4,"name":"S3 Object Prefix","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${file_name}"}}}},"visible":true},"7":{"slot":7,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"8":{"slot":8,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${file_staging_table_name}"}}}},"visible":true},"9":{"slot":9,"name":"Load Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"record_type"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"ach_data"}}}},"visible":true},"23":{"slot":23,"name":"Date Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":true},"24":{"slot":24,"name":"Time Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":true},"26":{"slot":26,"name":"","elements":{},"visible":false},"27":{"slot":27,"name":"Escape","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957171":{"id":2957171,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-1664,"y":-48,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2957216],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957220":{"id":2957220,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-1888,"y":96,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2957217],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Copy of Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957221":{"id":2957221,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":-1728,"y":96,"width":32,"height":32,"inputConnectorIDs":[2957217],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Copy of Send Alert to Pager Duty 2"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"us-west-2"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"data-alerts-pagerduty-prod"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AWS Notification Message"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"DT tables generation\" job failed"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957224":{"id":2957224,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"ITERATE","implementationID":-424773870,"x":-896,"y":-64,"width":32,"height":16,"inputConnectorIDs":[2957222],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Grid Iterator 0"}}}},"visible":true},"3":{"slot":3,"name":"Grid Variable","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"file_name_list"}}}},"visible":true},"4":{"slot":4,"name":"Grid Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"file_names_to_load"},"2":{"slot":2,"type":"STRING","value":"file_name"}}}},"visible":true},"5":{"slot":5,"name":"Break on Failure","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"6":{"slot":6,"name":"Concurrency","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Sequential"}}}},"visible":true},"999":{"slot":999,"name":"Record Values In Task History","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[2957219],"inputIterationConnectorIDs":[]},"2957225":{"id":2957225,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-896,"y":-32,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"load_ach_file_parser_day_ln 0"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"load_ach_file_parser_day"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"file_name"},"2":{"slot":2,"type":"STRING","value":"${file_name}"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[2957219]},"2957226":{"id":2957226,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":374945314,"x":-1095,"y":28,"width":32,"height":32,"inputConnectorIDs":[2957223],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"S3 Unload 0"}}}},"visible":true},"4":{"slot":4,"name":"S3 Object Prefix","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"s3://<bucket>/<path>"}}}},"visible":true},"5":{"slot":5,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"6":{"slot":6,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"7":{"slot":7,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"8":{"slot":8,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"10":{"slot":10,"name":"Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Custom]"}}}},"visible":true},"11":{"slot":11,"name":"File Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CSV"}}}},"visible":true},"12":{"slot":12,"name":"Compression","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AUTO"}}}},"visible":true},"20":{"slot":20,"name":"Record Delimiter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"CHAR","value":""}}}},"visible":true},"21":{"slot":21,"name":"Field Delimiter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"CHAR","value":""}}}},"visible":true},"23":{"slot":23,"name":"Date Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"24":{"slot":24,"name":"Time Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"25":{"slot":25,"name":"Timestamp Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"26":{"slot":26,"name":"","elements":{},"visible":false},"27":{"slot":27,"name":"Escape","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"CHAR","value":""}}}},"visible":true},"28":{"slot":28,"name":"Escape Unenclosed Field","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"CHAR","value":""}}}},"visible":true},"30":{"slot":30,"name":"Field Optionally Enclosed","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"CHAR","value":""}}}},"visible":true},"31":{"slot":31,"name":"Null If","elements":{},"visible":true},"45":{"slot":45,"name":"Nest Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"65":{"slot":65,"name":"Snappy Compression","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"True"}}}},"visible":false},"120":{"slot":120,"name":"Overwrite","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":true},"121":{"slot":121,"name":"Single File","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":true},"122":{"slot":122,"name":"Max File Size","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"123":{"slot":123,"name":"Include Headers","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":true},"140":{"slot":140,"name":"Encryption","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"None"}}}},"visible":true},"141":{"slot":141,"name":"Master Key","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"142":{"slot":142,"name":"KMS Key Id","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"200":{"slot":200,"name":"Stage","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Custom]"}}}},"visible":true},"201":{"slot":201,"name":"File Prefix","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"data"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957227":{"id":2957227,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-1177,"y":79,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[2957223],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SQL Script 0"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957228":{"id":2957228,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-400,"y":96,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Load file sections"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"copy ${staging_schema}.ach_file_header_staging(priority_code, immediate_destination, immediate_origin, file_creation_date, file_creation_time, file_id_modifier, record_size, blocking_factor, format_code, immediate_destination_name, immediate_origin_name, reference_code)\nfrom '${file_staging_path}/ach_file_header.ach'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'priority_code:2,immediate_destination:10,immediate_origin:10,file_creation_date:6,file_creation_time:4,file_id_modifier:1,record_size:3,blocking_factor:2,format_code:1,immediate_destination_name:23,immediate_origin_name:23,reference_code:8'\n;\n\ncopy ${staging_schema}.ach_batch_header_staging(service_class_code, company_name, company_discretionary_data, company_identification, standard_entry_class_code, company_entry_description, company_descriptive_date, effective_entry_date, settlement_date_julian, originator_status_code, originating_dfi_identification, batch_number)\nfrom '${file_staging_path}/ach_batch_header.ach'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'service_class_code:3,company_name:16,company_discretionary_data:20,company_identification:10,standard_entry_class_code:3,company_entry_description:10,company_descriptive_date:6,effective_entry_date:6,settlement_date_julian:3,originator_status_code:1,originating_dfi_identification:8,batch_number:7'\n;\n\ncopy ${staging_schema}.ach_entry_detail_staging(transaction_code, receiving_dfi_identification, check_digit, dfi_account_number, amount, individual_identification_number__identification_number__check_serial_number, individual_name__receiving_company_name, discretionary_data__payment_type_code__card_transaction_type_code, addenda_record_indicator, trace_number)\nfrom '${file_staging_path}/ach_entry_detail.ach'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'transaction_code:2,receiving_dfi_identification:8,check_digit:1,dfi_account_number:17,amount:10,individual_identification_number__identification_number__check_serial_number:15,individual_name__receiving_company_name:22,discretionary_data__payment_type_code__card_transaction_type_code:2,addenda_record_indicator:1,trace_number:15'\n;\n\ncopy ${staging_schema}.ach_addenda_record_staging(addenda_type_code,payment_related_information,addenda_sequence_number,entry_detail_sequence_number)\nfrom '${file_staging_path}/ach_addenda_record.ach'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'addenda_type_code:2,payment_related_information:80,addenda_sequence_number:4,entry_detail_sequence_number:7,'\n;\n\ncopy ${staging_schema}.ach_batch_control_staging(service_class_code, entry__addenda_count, entry_hash, total_debit_entry_dollar_amount_in_batch, total_credit_entry_dollar_amount_in_batch, company_identification, message_authentication_code, reserved, originating_dfi_identification, batch_number)\nfrom '${file_staging_path}/ach_batch_control.ach'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'service_class_code:3,entry__addenda_count:6,entry_hash:10,total_debit_entry_dollar_amount_in_batch:12,total_credit_entry_dollar_amount_in_batch:12,company_identification:10,message_authentication_code:19,reserved:6,originating_dfi_identification:8,batch_number:7'\n;\n\ncopy ${staging_schema}.ach_file_control_staging(batch_count, block_count, entry__addenda_count, entry_hash, total_debit_entry_dollar_amount_in_file, total_credit_entry_dollar_amount_in_file, reserved)\nfrom '${file_staging_path}/ach_file_control.ach'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'batch_count:6,block_count:6,entry__addenda_count:8,entry_hash:10,total_debit_entry_dollar_amount_in_file:12,total_credit_entry_dollar_amount_in_file:12,reserved:39'\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957229":{"id":2957229,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-496,"y":96,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Unload file sections"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"unload ('select ach_data from ${staging_schema}.${file_staging_table_name} where record_type = ''1''')\nto '${file_staging_path}/ach_file_header.ach'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nparallel off\nallowoverwrite\n;\n\nunload ('select ach_data from ${staging_schema}.${file_staging_table_name} where record_type = ''5''')\nto '${file_staging_path}/ach_batch_header.ach'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nparallel off\nallowoverwrite\n;\n\nunload ('select ach_data from ${staging_schema}.${file_staging_table_name} where record_type = ''6''')\nto '${file_staging_path}/ach_entry_detail.ach'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nparallel off\nallowoverwrite\n;\n\nunload ('select ach_data from ${staging_schema}.${file_staging_table_name} where record_type = ''7''')\nto '${file_staging_path}/ach_addenda_record.ach'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nparallel off\nallowoverwrite\n;\n\nunload ('select ach_data from ${staging_schema}.${file_staging_table_name} where record_type = ''8''')\nto '${file_staging_path}/ach_batch_control.ach'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nparallel off\nallowoverwrite\n;\n\nunload ('select ach_data from ${staging_schema}.${file_staging_table_name} where record_type = ''9'' and ach_data != replicate(''9'', 93)')\nto '${file_staging_path}/ach_file_control.ach'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nparallel off\nallowoverwrite\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957230":{"id":2957230,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-1312,"y":-48,"width":32,"height":32,"inputConnectorIDs":[2957216],"outputSuccessConnectorIDs":[2957222],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Copy of Python Script 0"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import boto3\nimport re\nimport tempfile\nimport datetime\nimport os\nfrom urllib.parse import urlparse\n\ndef replace_new_lines(file_path):\n\twith open(file_path, 'r', encoding='latin1') as infile:\n\t\tfile_data = infile.read()\n\t\tif file_data.endswith('\\n'):\n\t\t\tfile_data = file_data.replace('\\n', '')\n\t\t\twith open(file_path, 'w') as outfile:\n\t\t\t\toutfile.write(file_data)\n\t\telse:\n\t\t\treturn 'No new lines found'\n\n\ndef addNewLine(filePath, every, delimiter):\n\t#Make sure to add the escape if you are using a special character ex: \\n\n\t#Provide full file path and # of characters before inserting \\n character\n\t#Open input file read-only copy read all contents into one variable \n\twith open(filePath, 'r+', encoding='latin1') as f:\n\t\tcontent = f.read()\n\t\t#Every n characters replace with delimiter\n\t\tcontent_new = re.sub(\"(.{})\".format({every}), \"\\\\1{}\".format(delimiter), content, 0, re.DOTALL)\n\t\t#go back to the beginning of the file\n\t\tf.seek(0)\n\t\t#replace original content with regexed data\n\t\tf.write(content_new)\n\t\tf.truncate()\n\ndef addLineNumber(filePath):\n\twith open(filePath, 'r+', encoding='latin1') as f:\n\t\tdata = f.readlines()\n\t\tf.seek(0)\n\t\tfor (line_number,line) in enumerate(data,start=1):\n\t\t\tf.write((str(line_number).rjust(6)+line))\n\t\tf.truncate()\n\n\ndef s3Credentials():\n\ts3 = boto3.client('s3')\n\treturn s3\n\ndef downloadFromS3(s3,bucket,key):\n\tpaginator = s3.get_paginator('list_objects')\n\tpages = paginator.paginate(Bucket=bucket, Prefix=key)\n\tfiles_downloaded = []\n\tfor page in pages:\n\t\tfor obj in page['Contents']:\n\t\t\tif re.findall(r'ACHACHP125108997PD20191107T140517.ACHACHP125108997PD20191107T140517', obj['Key']):\n\t\t\t\tprint(obj['Key'])\n\t\t\t\tpath,filename = os.path.split(obj['Key'])\n\t\t\t\ts3.download_file(bucket,obj['Key'],filename)\n\t\t\t\tfiles_downloaded.append(filename)\n\treturn files_downloaded\n\ndef downloadFromS3RET(s3,bucket,key):\n\tpaginator = s3.get_paginator('list_objects')\n\tpages = paginator.paginate(Bucket=bucket, Prefix=key)\n\tfiles_downloaded = []\n\tfor page in pages:\n\t\tfor obj in page['Contents']:\n\t\t\tif re.findall(r'\\b(?!coastal)(?!.*pgp)ACHRET_?(ASP_)?_190819_?(\\w|\\W)?.(ACH|ach)?', obj['Key']):\n\t\t\t\tpath,filename = os.path.split(obj['Key'])\n\t\t\t\ts3.download_file(bucket,obj['Key'],filename)\n\t\t\t\tfiles_downloaded.append(filename)\n\treturn files_downloaded\n  \ndef UploadToS3(s3, filename, bucket, key):\n\t\"\"\"Uploads file to S3\n\tBucket is the main bucket\n\tKey is the path where you want the file to be uploaded to\n\tEx bucket=bucket-name\n\tkey=foo/bucket/folder\"\"\"\n\ts3.upload_file(filename,bucket,key)\n\ndef getBucketAndKeyS3(s3url):\n\tbucket_path = urlparse(s3url)\n\treturn bucket_path.netloc, bucket_path.path.lstrip('/')\n  \ndef update_grid_variables(list_of_items, grid_variable_name):\n\tnew_list = [[items] for items in list_of_items]\n\tcontext.updateGridVariable(grid_variable_name, new_list)\n\n\nif __name__ == \"__main__\":\n\tcreds = s3Credentials()\n\t#Matillion job variables\n\tfile_bucket,file_key = getBucketAndKeyS3('${parsed_file_path}')\n\tdownloaded_file_names = downloadFromS3(creds, file_bucket,file_key)\n\tmy_bucket,my_key = getBucketAndKeyS3('s3://aspiration-datateam/dump/szhang')\n\tprint(downloaded_file_names)\n\tupdate_grid_variables(downloaded_file_names, 'file_name_list')\n\tfor files_names in downloaded_file_names:\n\t\treplace_new_lines(files_names)\n\t\taddNewLine(files_names,94,'\\n')\n\t\taddLineNumber(files_names)\n\t\tUploadToS3(creds, files_names, my_bucket,os.path.join(my_key,files_names))\n\t\tos.remove(files_names)\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2957231":{"id":2957231,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-272,"y":96,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Update RAW ACH table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"delete from public.raw_ach_data_test_ln\nwhere file_date = '${current_year}-${current_month}-${current_day}'\n;\n\ninsert into public.raw_ach_data_test_ln(file_name, file_date, transaction_code, receiving_dfi_identification, check_digit, dfi_account_number, amount, individual_identification_number__identification_number__check_serial_number, individual_name__receiving_company_name, discretionary_data__payment_type_code__card_transaction_type_code, addenda_record_indicator, trace_number)\nselect '${file_name}','${current_year}-${current_month}-${current_day}', transaction_code, receiving_dfi_identification, check_digit, dfi_account_number, amount, individual_identification_number__identification_number__check_serial_number, individual_name__receiving_company_name, discretionary_data__payment_type_code__card_transaction_type_code, addenda_record_indicator, trace_number\nfrom etl.ach_entry_detail_staging\n;\n\nSELECT\n\tTO_CHAR(TO_DATE(CONVERT_TIMEZONE('UTC', 'America/Los_Angeles', CAST(depository_transactions.post_date  AS TIMESTAMP_NTZ))), 'YYYY-MM-DD') AS \"depository_transactions.post_date\",\n\tCOALESCE(SUM(abs((depository_transactions.amount::float)::float) ), 0) AS \"depository_transactions.abs_value_transaction_amount\",\n\tCOUNT(DISTINCT depository_transactions.unique_account_id ) AS \"depository_transactions.distinct_unique_account_id\"\nFROM bi.dt_depository_transactions  AS depository_transactions\n\nWHERE ((((depository_transactions.post_date ) >= ((CONVERT_TIMEZONE('America/Los_Angeles', 'UTC', CAST(TO_TIMESTAMP('2020-06-29') AS TIMESTAMP_NTZ)))) AND (depository_transactions.post_date ) < ((CONVERT_TIMEZONE('America/Los_Angeles', 'UTC', CAST(DATEADD('day', 7, TO_TIMESTAMP('2020-06-29')) AS TIMESTAMP_NTZ))))))) AND (case when depository_transactions.transaction_type in ('Purchase', 'Purchase with PIN', 'Debit Card - No PIN',\n              'Debit Card - PIN', 'Retail Sale', 'Unique Transactions', 'Pre-auth completion') then true else false end)\nGROUP BY TO_DATE(CONVERT_TIMEZONE('UTC', 'America/Los_Angeles', CAST(depository_transactions.post_date  AS TIMESTAMP_NTZ)))\nORDER BY 1 DESC\nLIMIT 500;\n\n\nselect top 100 *\nfrom bi.DT_DEPOSITORY_TRANSACTIONS\nwhere POST_DATE >= ((CONVERT_TIMEZONE('America/Los_Angeles', 'UTC', CAST(TO_TIMESTAMP('2020-06-29') AS TIMESTAMP_NTZ)))) and POST_DATE < ((CONVERT_TIMEZONE('America/Los_Angeles', 'UTC', CAST(DATEADD('day', 7, TO_TIMESTAMP('2020-06-29')) AS TIMESTAMP_NTZ)))) AND (case when transaction_type in ('Purchase', 'Purchase with PIN', 'Debit Card - No PIN',\n              'Debit Card - PIN', 'Retail Sale', 'Unique Transactions', 'Pre-auth completion') then true else false end);\n\n\nselect CONVERT_TIMEZONE('America/Los_Angeles', 'UTC', CAST(TO_TIMESTAMP('2020-06-29')));\n\nselect convert_timezone('America/Los_Angeles', 'UTC', cast('2020-06-29')));\n\nselect CONVERT_TIMEZONE('America/Los_Angeles', 'UTC', CAST('2020-06-29' as timestamp ));\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2957222":{"id":2957222,"sourceID":2957230,"targetID":2957224},"2957223":{"id":2957223,"sourceID":2957227,"targetID":2957226}},"failureConnectors":{},"unconditionalConnectors":{"2957216":{"id":2957216,"sourceID":2957171,"targetID":2957230},"2957217":{"id":2957217,"sourceID":2957220,"targetID":2957221}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{"2957219":{"id":2957219,"sourceID":2957224,"targetID":2957225}},"noteConnectors":{},"notes":{},"variables":{"current_day":{"definition":{"name":"current_day","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"07"},"current_month":{"definition":{"name":"current_month","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"11"},"current_year":{"definition":{"name":"current_year","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"2019"},"file_name":{"definition":{"name":"file_name","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""},"file_staging_path":{"definition":{"name":"file_staging_path","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"s3://aspiration-etl-staging/file_processing/ach"},"file_staging_table_name":{"definition":{"name":"file_staging_table_name","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"ach_file_staging"},"parsed_file_path":{"definition":{"name":"parsed_file_path","type":"TEXT","scope":"BRANCH","description":"Where python will download the decrypted file and upload the split lined file\n","visibility":"PUBLIC"},"value":"s3://aspiration-etl-staging/file_processing/ach/coastal_file_drop"},"s3_file_path":{"definition":{"name":"s3_file_path","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"2018/11"},"s3_filename":{"definition":{"name":"s3_filename","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"test_20181112.csv"}},"grids":{"ach_table_list":{"definition":{"name":"ach_table_list","scope":"BRANCH","definitions":[{"name":"table_name","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[{"values":["ach_file_staging"]},{"values":["ach_file_header_staging"]},{"values":["ach_batch_header_staging"]},{"values":["ach_entry_detail_staging"]},{"values":["ach_batch_control_staging"]},{"values":["ach_file_control_staging"]}]},"file_name_list":{"definition":{"name":"file_name_list","scope":"BRANCH","definitions":[{"name":"file_names_to_load","type":"TEXT"}],"description":"list of file names","visibility":"PUBLIC"},"values":[]}}},"info":{"name":"Copy of ach_file_parser_day","description":"","type":"ORCHESTRATION","tag":"f61625c5-c610-4a40-a69f-243d34368cc6"}}