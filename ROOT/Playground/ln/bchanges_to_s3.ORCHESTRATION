{"job":{"components":{"2959660":{"id":2959660,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":0,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2959662],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2959663":{"id":2959663,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":123,"y":7,"width":32,"height":32,"inputConnectorIDs":[2959662],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SQL Script 0"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"--temp table to hold header/detail/trailer data\ndrop table if exists tmp_file_postmates;\ncreate temp table tmp_file_postmates\n(\n  file_id varchar(7),\n  file_row varchar(5000)\n);\n--header\ninsert into tmp_file_postmates (file_id, file_row)\nselect '000000'::varchar as file_id,\n       'HHEADER'::varchar || rpad('454', 10, ' ')::varchar ||\n       rpad('584', 10, ' ')::varchar ||\n       rpad(('bchanges_584_' || replace(current_date::varchar(20), '-', '') || '_pp'\n                 || replace(substring(current_timestamp::varchar,12,8), ':', '')::varchar || '.gpg'::varchar), 50, ' ')::varchar ||\n       to_char(current_date(), 'MMDDYYYY')::varchar as file_row;\n--detail\ninsert into tmp_file_postmates (file_id, file_row)\nwith final_user_list as (\n    select prn as galileo_prn\n    from ulnguyen.adhoc_galileo_account_changes\n)\nselect lpad(row_number() over (order by galileo_prn desc nulls last)::varchar,6,'0') as galileo_file_record_number,\n       'D' ||\n       galileo_file_record_number ||\n       'R' ||\n       rpad(galileo_prn,50,' ') ||\n        rpad('1',5) ||\n        rpad('6635',255)\n       --select *\nfrom final_user_list;\n--trailer\ninsert into tmp_file_postmates (file_id, file_row)\nwith final_user_list as (\n    select prn as galileo_prn\n    from ulnguyen.adhoc_galileo_account_changes\n)\nselect '1000000',\n       'TTRAILER' || rpad(count(*),6,' ')\nfrom final_user_list;\n--check data\n--SELECT file_row FROM tmp_file_postmates ORDER BY file_id;\n--export to S3\ncopy into @public.datateam/dump/lnguyen/adhoc/bchanges_584_${current_year}${current_month}${current_day}_pp19.txt\n     from (SELECT file_row FROM tmp_file_postmates ORDER BY file_id)\n     file_format =(type='csv' compression='none' FILE_EXTENSION = '' EMPTY_FIELD_AS_NULL=false FIELD_OPTIONALLY_ENCLOSED_BY=none null_if=('') )\n     header = false\n     overwrite = true\n     single = true;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{},"failureConnectors":{},"unconditionalConnectors":{"2959662":{"id":2959662,"sourceID":2959660,"targetID":2959663}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{"current_day":{"definition":{"name":"current_day","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"28"},"current_month":{"definition":{"name":"current_month","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"09"},"current_year":{"definition":{"name":"current_year","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"2020"}},"grids":{}},"info":{"name":"bchanges_to_s3","description":null,"type":"ORCHESTRATION","tag":"ea630f92-0335-4e86-8f66-e1b6dc556d18"}}