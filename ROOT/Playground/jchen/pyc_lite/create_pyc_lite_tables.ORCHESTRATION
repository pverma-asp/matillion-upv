{"job":{"components":{"2959232":{"id":2959232,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":0,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2959248],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2959234":{"id":2959234,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":16,"y":224,"width":32,"height":32,"inputConnectorIDs":[2959249],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"create pyc-lite view"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"drop view if exists rdl.pyc_lite_funnel;\n\ncreate view rdl.pyc_lite_funnel\nas\nwith pyc_lite_users as (\n    select ue.USER_ID,\n           u.UUID          as EXTERNAL_USER_ID,\n           ue.EMAIL        as USER_EMAIL\n    from WEB_DB.user_email ue\n    join WEB_DB.USER_PRODUCT_APPLICATION upa on ue.USER_ID = upa.USER_ID\n    join WEB_DB.PRODUCT p on p.id = upa.PRODUCT_ID\n    join WEB_DB._USER u on ue.USER_ID = u.ID\n    where 1 = 1\n      and p.CODE = 'PYC-LITE'\n)\n, pyc_lite_leads as (\n    select\n        wl.EMAIL,\n        wl.UTM_SOURCE,\n        wl.UTM_CAMPAIGN,\n        wl.UTM_CONTENT,\n        wl.DATE_CREATED\n    from WEB_DB.wait_list_user wl\n    join pyc_lite_users plu on wl.EMAIL=plu.USER_EMAIL\n)\n, pyc_lite_funding_accounts as (\n    select\n        ra.ID as ROUNDUP_ACCOUNT_ID,\n        ra.USER_ID,\n        ra.CREATED_AT\n    from BANK_DB.ROUNDUP_ACCOUNT ra\n             join BANK_DB.PYC_SETTING ps on ra.ID = ps.FUNDING_ROUNDUP_ACCOUNT_ID\n    where 1 = 1\n--       and ra.USER_ID = 2116975\n)\n, pyc_lite_tracking_accounts as (\n    select\n        ra.USER_ID,\n        min(ra.CREATED_AT) as MIN_CREATED_AT\n    from BANK_DB.ROUNDUP_ACCOUNT ra\n    join BANK_DB.PYC_TRACKED_ACCOUNT pta on ra.id=pta.ROUNDUP_ACCOUNT_ID\n    where 1 = 1\n--       and USER_ID = 76\n    group by ra.USER_ID\n), pyc_lite_eligible_transactions as (\n    select\n        rt.USER_ID,\n        min(POSTED_DATE) as FIRST_PYC_ELIGIBLE_TRANSACTION_POSTED_DATE\n    from BANK_DB.ROUNDUP_TRANSACTION rt\n    where 1=1\n      and PYC_ELIGIBLE = TRUE\n--       and rt.USER_ID=2116975\n    group by USER_ID\n)\nselect\n    plu.*,\n    pll.UTM_SOURCE,\n    pll.UTM_CAMPAIGN,\n    pll.UTM_CONTENT,\n    pll.DATE_CREATED,\n    plta.MIN_CREATED_AT as TRACKING_ACCOUNT_LINK_DATE,\n    plfa.CREATED_AT as FUNDING_ACCOUNT_LINK_DATE,\n    plet.FIRST_PYC_ELIGIBLE_TRANSACTION_POSTED_DATE is not null as HAS_MADE_PYC_TXN,\n    plet.FIRST_PYC_ELIGIBLE_TRANSACTION_POSTED_DATE\nfrom pyc_lite_users plu\nleft join pyc_lite_leads pll on plu.USER_EMAIL=pll.EMAIL\nleft join pyc_lite_funding_accounts plfa on plu.USER_ID=plfa.USER_ID\nleft join pyc_lite_tracking_accounts plta on plu.USER_ID=plta.USER_ID\nleft join pyc_lite_eligible_transactions plet on plu.USER_ID=plet.USER_ID\n;\n\ngrant select on all views in schema rdl to role LOOKER_ROLE;\ngrant select on all views in schema rdl to role data_engineering_group;\n\ngrant select on all views in schema rdl to role data_science_analytics;\ngrant select on all views in schema rdl to role read_only_internal_users;\n\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2959235":{"id":2959235,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":16,"y":128,"width":32,"height":32,"inputConnectorIDs":[2959248],"outputSuccessConnectorIDs":[2959249],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"create bank_db pyc-lite tables"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"drop table if exists BANK_DB.ROUNDUP_DAILY_TRANSFER;\ncreate table BANK_DB.ROUNDUP_DAILY_TRANSFER\n(\n\tid VARCHAR,\n\troundup_date DATE,\n\tamount NUMBER(20),\n\troundup_id VARCHAR,\n\tgalileo_ach_transaction_id NUMBER(20),\n\tcreated_at TIMESTAMPNTZ,\n\tupdated_at TIMESTAMPNTZ,\n\tgalileo_adjustment_transaction_id NUMBER(20),\n\terrors VARCHAR,\n\tetl_load_date TIMESTAMPNTZ\n);\n\ndrop table if exists BANK_DB_STG.ROUNDUP_DAILY_TRANSFER;\ncreate table BANK_DB_STG.ROUNDUP_DAILY_TRANSFER\n(\n\tid VARCHAR,\n\troundup_date DATE,\n\tamount NUMBER(20),\n\troundup_id VARCHAR,\n\tgalileo_ach_transaction_id NUMBER(20),\n\tcreated_at TIMESTAMPNTZ,\n\tupdated_at TIMESTAMPNTZ,\n\tgalileo_adjustment_transaction_id NUMBER(20),\n\terrors VARCHAR,\n\tetl_load_date TIMESTAMPNTZ\n);"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2959249":{"id":2959249,"sourceID":2959235,"targetID":2959234}},"failureConnectors":{},"unconditionalConnectors":{"2959248":{"id":2959248,"sourceID":2959232,"targetID":2959235}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{},"grids":{}},"info":{"name":"create_pyc_lite_tables","description":null,"type":"ORCHESTRATION","tag":"127084c3-8af4-467f-ac73-fb1d94c47233"}}