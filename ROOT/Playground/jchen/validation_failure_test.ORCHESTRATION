{"job":{"components":{"2958773":{"id":2958773,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":112,"y":64,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"validation_failure_test_child_job"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"validation_failure_test_child_job"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[2958768]},"2958776":{"id":2958776,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":160,"y":-48,"width":32,"height":32,"inputConnectorIDs":[2958775],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Copy of table creation scripts"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"-- drop table if exists etl.tables_to_refresh_jchen_1;\n\n-- create table etl.tables_to_refresh_jchen_1\n-- as select * from etl.tables_to_refresh\n-- ;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2958777":{"id":2958777,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-160,"y":72,"width":32,"height":32,"inputConnectorIDs":[2958769],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"test variables"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\nprint 'staging_schema:', staging_schema\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2958778":{"id":2958778,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"ITERATE","implementationID":-158614544,"x":112,"y":64,"width":32,"height":16,"inputConnectorIDs":[2958774],"outputSuccessConnectorIDs":[2958772],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Retry 1"}}}},"visible":true},"2":{"slot":2,"name":"Number of Retries","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"3"}}}},"visible":true},"3":{"slot":3,"name":"Retry Delay","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Short delay"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[2958768],"inputIterationConnectorIDs":[]},"2958779":{"id":2958779,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":716056355,"x":112,"y":192,"width":32,"height":32,"inputConnectorIDs":[2958772],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Copy of Get sweep_db tables with delta support"}}}},"visible":true},"2":{"slot":2,"name":"","elements":{},"visible":false},"3":{"slot":3,"name":"Database Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"postgresql"}}}},"visible":true},"4":{"slot":4,"name":"RDS Endpoint","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"prod-web-db-analytics.ctawxryivyva.us-west-2.rds.amazonaws.com:5432"}}}},"visible":true},"5":{"slot":5,"name":"Database Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"sweep_db"}}}},"visible":true},"6":{"slot":6,"name":"Username","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"data_readonly"}}}},"visible":true},"7":{"slot":7,"name":"Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dA3j3RWFpzzo38LL"}}}},"visible":true},"8":{"slot":8,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"WITH column_list \nAS\n(\n    SELECT C.TABLE_NAME, \n    \tstring_agg(c.COLUMN_NAME, ',') AS column_list\n    FROM INFORMATION_SCHEMA.COLUMNS c\n    WHERE 1=1\n\t\tAND c.TABLE_SCHEMA = 'public'\n     \t AND (c.data_type not in ('json','jsonb')\n     \t    or (c.data_type in ('json','jsonb')\n     \t          and c.table_name = 'bank_account_plaid_identity_info'\n     \t          and c.column_name = 'original_plaid_data'))\n     \tAND c.COLUMN_NAME NOT IN ('tax_identification_number')\n   \tGROUP BY C.TABLE_NAME\n)\nSELECT 'prod-web-db-analytics.ctawxryivyva.us-west-2.rds.amazonaws.com:5432' AS SERVER_NAME,\n\t'sweep_db' AS DB_NAME,\n\t'sweep_db' AS TABLE_SCHEMA, \n    t.TABLE_SCHEMA AS SOURCE_SCHEMA,\n\tt.TABLE_NAME,\n\n  CASE \n    WHEN t.TABLE_NAME = 'promontory_balance_history' THEN 'depository_id::varchar || source_file::varchar'\n    WHEN t.TABLE_NAME = 'promontory_account_history' THEN 'depository_id::varchar || created_at::varchar'\n    WHEN t.TABLE_NAME = 'promontory_individual_account_balance_history' THEN 'depository_id::varchar || member_bank_number::varchar || source_file::varchar'\n    ELSE\n        (\n          SELECT '(' || string_agg(a.attname, ',') || ')' AS pk_cols\n          FROM pg_index i\n          INNER JOIN pg_attribute a ON (a.attrelid = i.indrelid AND a.attnum = ANY(i.indkey))\n          INNER JOIN pg_class c ON (c.oid = i.indrelid)\n          INNER JOIN pg_namespace ns ON (ns.oid = c.relnamespace)\n          WHERE 1=1\n            AND i.indisprimary\n            AND ns.nspname = t.TABLE_SCHEMA\n            AND i.indrelid::regclass::text = t.TABLE_NAME\n          GROUP BY ns.nspname, i.indrelid::regclass\n        )\n  END AS pk_cols,\n  \n\tc.column_list, \n   \n  CASE\n  \tWHEN c.column_list ILIKE '%updated_at%' THEN 'updated_at'\n  \tWHEN c.column_list ILIKE '%created_at%' THEN 'created_at'\n  \tWHEN c.column_list ILIKE '%calculated_at%' THEN 'calculated_at' \n  END AS update_column_name,\n  \n  current_timestamp\n\nFROM INFORMATION_SCHEMA.TABLES t\nINNER JOIN column_list c ON (c.TABLE_NAME = t.TABLE_NAME)\nWHERE 1=1\n  AND t.TABLE_TYPE = 'BASE TABLE'\n  AND t.TABLE_SCHEMA = 'public'\n  AND t.TABLE_NAME NOT ILIKE '%journal%'\n  AND t.TABLE_NAME NOT ILIKE 'dt_%'\n  AND t.TABLE_NAME NOT IN ('jellyfish_event_log')\n  AND t.TABLE_NAME NOT IN ('restriction','account_statement','user_cohorts', 'user_profile', 'user_product_application', 'depository', 'cma_migration', 'joint_account_invitation', 'cashback_posted_transaction')\n  AND EXISTS (SELECT * FROM INFORMATION_SCHEMA.COLUMNS c WHERE c.TABLE_SCHEMA = t.TABLE_SCHEMA AND c.TABLE_NAME = t.TABLE_NAME AND c.COLUMN_NAME IN ('created_at', 'updated_at', 'calculated_at'))\n--  AND TABLE_NAME = 'cma_migration'\nORDER BY t.TABLE_NAME\n;\n"}}}},"visible":true},"11":{"slot":11,"name":"JDBC Options","elements":{},"visible":true},"13":{"slot":13,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${staging_schema}"}}}},"visible":true},"14":{"slot":14,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"tables_to_refresh_jchen_1"}}}},"visible":true},"16":{"slot":16,"name":"S3 Staging Area","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"aspiration-etl-staging"}}}},"visible":true},"18":{"slot":18,"name":"Primary Key","elements":{},"visible":true},"20":{"slot":20,"name":"Data Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"101":{"slot":101,"name":"Basic/Advanced Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Advanced"}}}},"visible":true},"102":{"slot":102,"name":"Data Source","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"103":{"slot":103,"name":"Data Selection","elements":{},"visible":false},"104":{"slot":104,"name":"Data Source Filter","elements":{},"visible":false},"105":{"slot":105,"name":"Combine Filters","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":false},"106":{"slot":106,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"100"}}}},"visible":false},"1001":{"slot":1001,"name":"","elements":{},"visible":false},"40000":{"slot":40000,"name":"Encryption","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SSE KMS"}}}},"visible":true},"40001":{"slot":40001,"name":"KMS Key ID","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${kms_s3_key}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2958782":{"id":2958782,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":0,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2958769,2958774,2958775],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2958772":{"id":2958772,"sourceID":2958778,"targetID":2958779}},"failureConnectors":{},"unconditionalConnectors":{"2958769":{"id":2958769,"sourceID":2958782,"targetID":2958777},"2958774":{"id":2958774,"sourceID":2958782,"targetID":2958778},"2958775":{"id":2958775,"sourceID":2958782,"targetID":2958776}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{"2958768":{"id":2958768,"sourceID":2958778,"targetID":2958773}},"noteConnectors":{},"notes":{},"variables":{},"grids":{}},"info":{"name":"validation_failure_test","description":null,"type":"ORCHESTRATION","tag":"5c6de67f-2f6b-419b-a4bc-3030f5fd18f0"}}