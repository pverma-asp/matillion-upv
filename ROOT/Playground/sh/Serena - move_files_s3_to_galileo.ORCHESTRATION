{"job":{"components":{"2958484":{"id":2958484,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-1437,"y":-82,"width":32,"height":32,"inputConnectorIDs":[2958481],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SQL Script 0"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"drop table if exists ush.output;\ncreate table ush.output\n(\n  output_row varchar(2000)\n);\n\n\n\n\nCOPY INTO ush.output (output_row)\nFROM (SELECT $1\n      FROM @public.datateam/dump/sharris/${galileo_filename}.txt.out)\nFILE_FORMAT = ETL.PLAIN_TEXT\nON_ERROR = SKIP_FILE;\n\n--remove header and trailer\ndelete from ush.output \nwhere left(output_row,1) in ('H','T');\n\n/*\n--account change\ndrop table if exists ush.bas_352_account_change_output_reissue;\ncreate table ush.bas_352_account_change_output_reissue as\n  select\n    substring(output_row,1,1) as record_type,\n    substring(output_row,2,6) as record_number,\n    substring(output_row,8,1) as account_id_type,\n    trim(substring(output_row,9,50)) as account_identifier,\n    trim(substring(output_row,59,4)) as galileo_response_code\n  from ush.output;\n\n\n--transaction\ndrop table if exists ush.data_128_output;\ncreate table ush.data_128_output as\n  select\n    substring(output_row,1,1) as record_type,\n    substring(output_row,2,6) as record_number,\n    substring(output_row,8,1) as account_id_type,\n    substring(output_row,9,50) as account_identifier,\n    substring(output_row,59,20) as transaction_identifier,\n    substring(output_row,79,4) as galileo_response_code\n  from ush.output;\n*/\n\ngrant select on all tables in schema ush to data_engineering_group;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2958485":{"id":2958485,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-1536,"y":-80,"width":32,"height":32,"inputConnectorIDs":[2958483],"outputSuccessConnectorIDs":[2958481],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"decrypt_file"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import boto3\n#python function to call lambda to encrypt s3 file to send to galileo\n\n#body = json.dumps(dict(operation='dec',file='s3://aspiration-datateam/dump/sharris/${galileo_filename}.txt.gpg',\n#                       decrypted_file_path='s3://aspiration-datateam/dump/sharris',\n#                       extension='gpg'\n#                      ))\n\nbody = json.dumps(dict(operation='dec',file='s3://aspiration-datateam/dump/sharris/${galileo_filename}.txt.out.gpg',\n                       decrypted_file_path='s3://aspiration-datateam/dump/sharris',\n                       extension='gpg'\n                      ))\n\ndef run_lambda():\n    client = boto3.client('lambda', region_name='us-west-2')\n    response = client.invoke(\n    FunctionName='arn:aws:lambda:us-west-2:332894900161:function:prod-python-encrypt-decrypt-manual',\n    InvocationType='Event',\n    LogType='Tail',\n    Payload=body\n    )\n\nrun_lambda()        \n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2958486":{"id":2958486,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-1504,"y":16,"width":32,"height":32,"inputConnectorIDs":[2958460],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"decrypt non-output file"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import boto3\n#python function to call lambda to encrypt s3 file to send to galileo\n\nbody = json.dumps(dict(operation='dec',file='s3://aspiration-datateam/dump/sharris/${galileo_filename}.csv.gpg',\n                       decrypted_file_path='s3://aspiration-datateam/dump/sharris',\n                       extension='gpg'\n                      ))\n\n\n\ndef run_lambda():\n    client = boto3.client('lambda', region_name='us-west-2')\n    response = client.invoke(\n    FunctionName='arn:aws:lambda:us-west-2:332894900161:function:prod-python-encrypt-decrypt-manual',\n    InvocationType='Event',\n    LogType='Tail',\n    Payload=body\n    )\n\nrun_lambda()        \nprint(body)"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2958487":{"id":2958487,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-1664,"y":16,"width":32,"height":32,"inputConnectorIDs":[2958461],"outputSuccessConnectorIDs":[2958460],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"get_non_output_file"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import boto3\n\n\nbody = json.dumps(dict(operation='get',working_dir='/sftpdir',\n                       s3_output='s3://aspiration-datateam/dump/sharris/${galileo_filename}.csv.gpg',\n                       sftp_file_name='${galileo_filename}.csv.gpg',\n                       lambda_arn='none'\n                      ))\n\n\n\nprint (body)\n\ndef run_lambda():\n    client = boto3.client('lambda', region_name='us-west-2')\n    response = client.invoke(\n    FunctionName='arn:aws:lambda:us-west-2:332894900161:function:sftp-to-s3-python',\n    InvocationType='Event',\n    LogType='Tail',\n    Payload=body\n    )\n    \nrun_lambda()    "}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2958488":{"id":2958488,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-1664,"y":-80,"width":32,"height":32,"inputConnectorIDs":[2958480],"outputSuccessConnectorIDs":[2958461,2958483],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"get_galileo_response_file"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import boto3\n\n\n#body = json.dumps(dict(operation='get',working_dir='/sftpdir',\n#                       s3_output='s3://aspiration-datateam/dump/sharris/${galileo_filename}.txt.gpg',\n#                       sftp_file_name='${galileo_filename}.txt.gpg',\n#                       lambda_arn='none'\n#                      ))\n\nbody = json.dumps(dict(operation='get',working_dir='/sftpdir/response',\n                       s3_output='s3://aspiration-datateam/dump/sharris/${galileo_filename}.txt.out.gpg',\n                       sftp_file_name='${galileo_filename}.txt.out.gpg',\n                       lambda_arn='none'\n                      ))\n\nprint (body)\n\ndef run_lambda():\n    client = boto3.client('lambda', region_name='us-west-2')\n    response = client.invoke(\n    FunctionName='arn:aws:lambda:us-west-2:332894900161:function:sftp-to-s3-python',\n    InvocationType='Event',\n    LogType='Tail',\n    Payload=body\n    )\n    \nrun_lambda()    "}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2958489":{"id":2958489,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-1792,"y":-80,"width":32,"height":32,"inputConnectorIDs":[2958482],"outputSuccessConnectorIDs":[2958480],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"send_file_to_galileo"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import boto3\n#python function to call lambda to encrypt s3 file to send to galileo\n\nbody = json.dumps(dict(operation='put',working_dir='/sftpdir/batch',\n                       s3_output='s3://aspiration-datateam/dump/sharris/${galileo_filename}.txt.gpg',\n                       sftp_file_name='${galileo_filename}.txt.gpg',\n                       lambda_arn='None'\n                      ))\n\ndef run_lambda():\n    client = boto3.client('lambda', region_name='us-west-2')\n    response = client.invoke(\n    FunctionName='arn:aws:lambda:us-west-2:332894900161:function:sftp-to-s3-python',\n    InvocationType='Event',\n    LogType='Tail',\n    Payload=body\n    )\n\n    \nrun_lambda()"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2958490":{"id":2958490,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-1904,"y":-80,"width":32,"height":32,"inputConnectorIDs":[2958463],"outputSuccessConnectorIDs":[2958482],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"encrypt_file"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import boto3\n#python function to call lambda to encrypt s3 file to send to galileo\n\nbody = json.dumps(dict(operation='enc',file='s3://aspiration-datateam/dump/sharris/${galileo_filename}.txt',\n                       encrypted_file_path='s3://aspiration-datateam/dump/sharris/',\n                       gpg_key='galileo_public_key',\n                       extension='gpg'\n                      ))\n\ndef run_lambda():\n    client = boto3.client('lambda', region_name='us-west-2')\n    response = client.invoke(\n    FunctionName='arn:aws:lambda:us-west-2:332894900161:function:prod-python-encrypt-decrypt-manual',\n    InvocationType='RequestResponse',\n    LogType='Tail',\n    Payload=body\n    )\n    print(response['Payload'].read())\n\n\nrun_lambda()\n#{\n#   \"operation\": \"enc\",\n#   \"file\": \"s3://aspiration-datateam/dump/szhang/btrans_584_20200226_005.txt\",\n#   \"encrypted_file_path\": \"s3://aspiration-datateam/dump/szhang/\",\n#   \"gpg_key\": \"galileo_public_key\",\n#   \"extension\": \"gpg\"\n# }"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2958491":{"id":2958491,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-2032,"y":-80,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2958463],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2958460":{"id":2958460,"sourceID":2958487,"targetID":2958486},"2958461":{"id":2958461,"sourceID":2958488,"targetID":2958487},"2958480":{"id":2958480,"sourceID":2958489,"targetID":2958488},"2958481":{"id":2958481,"sourceID":2958485,"targetID":2958484},"2958482":{"id":2958482,"sourceID":2958490,"targetID":2958489},"2958483":{"id":2958483,"sourceID":2958488,"targetID":2958485}},"failureConnectors":{},"unconditionalConnectors":{"2958463":{"id":2958463,"sourceID":2958491,"targetID":2958490}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{"galileo_filename":{"definition":{"name":"galileo_filename","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"btrans_584_20220920_pyc171306"}},"grids":{"file_dates":{"definition":{"name":"file_dates","scope":"BRANCH","definitions":[{"name":"current_max_day","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[]}}},"info":{"name":"Serena - move_files_s3_to_galileo","description":"","type":"ORCHESTRATION","tag":"df1e3706-a98e-4d56-b09c-8538e05746d0"}}