{"job":{"components":{"2958592":{"id":2958592,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":515156205,"x":-320,"y":160,"width":32,"height":32,"inputConnectorIDs":[2958574],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"end fail"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2958593":{"id":2958593,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":48,"y":64,"width":32,"height":32,"inputConnectorIDs":[2958595],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"end alert"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2958596":{"id":2958596,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":-192,"y":160,"width":32,"height":32,"inputConnectorIDs":[2958572],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"end no alert"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2958597":{"id":2958597,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1032749985,"x":-320,"y":64,"width":32,"height":32,"inputConnectorIDs":[2958575],"outputSuccessConnectorIDs":[2958594],"outputFailureConnectorIDs":[2958574],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"set variable"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"with begin_max_id as (\n    select ISSUE_PROGRAM,\n           max(ISSUE_LOG_ID) as ISSUE_LOG_ID\n    from etl.ISSUE_LOG\n    where ISSUE_PROGRAM = 'Run Daily Refresh'\n    and ISSUE_DESCRIPTION = 'Begin Job'\n    group by 1\n)\n,end_max_id as (\n    select ISSUE_PROGRAM,\n           max(ISSUE_LOG_ID) as ISSUE_LOG_ID\n    from etl.ISSUE_LOG\n    where ISSUE_PROGRAM = 'Run Daily Refresh'\n    and ISSUE_DESCRIPTION = 'End Job'\n    group by 1\n)\n, running as (\n    --only want most recent begin without an end; else return nothing\n    select datediff(minute,a.CREATED_AT,current_timestamp) as minutes_diff\n    from etl.ISSUE_LOG a\n    join begin_max_id b on a.ISSUE_LOG_ID = b.ISSUE_LOG_ID\n    join end_max_id c on a.ISSUE_PROGRAM = c.ISSUE_PROGRAM\n    where b.ISSUE_LOG_ID > c.ISSUE_LOG_ID\n    )\nselect ifnull((select minutes_diff from running),0) as minutes_diff\n"}}}},"visible":true},"3":{"slot":3,"name":"Scalar Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"minutes_running"},"2":{"slot":2,"type":"STRING","value":"MINUTES_DIFF"}}}},"visible":true},"4":{"slot":4,"name":"","elements":{},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2958598":{"id":2958598,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":-64,"y":64,"width":32,"height":32,"inputConnectorIDs":[2958573],"outputSuccessConnectorIDs":[2958595],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"alert"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"us-west-2"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"data-alerts-pagerduty-prod"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Run Daily Refresh running >= 2 hours"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"The Run Daily Refresh job has been running >= 2 hours.  Please check what is causing the delay."}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2958599":{"id":2958599,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"CONDITIONAL","executionHint":"FLOW","implementationID":-1357378929,"x":-200,"y":63,"width":32,"height":32,"inputConnectorIDs":[2958594],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[2958573],"outputFalseConnectorIDs":[2958572],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"if running > 120 minutes"}}}},"visible":true},"2":{"slot":2,"name":"Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Simple"}}}},"visible":true},"3":{"slot":3,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"minutes_running"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Greater than or equal to"},"4":{"slot":4,"type":"STRING","value":"120"}}}},"visible":true},"4":{"slot":4,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":true},"5":{"slot":5,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2958600":{"id":2958600,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-448,"y":64,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2958575],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"start"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2958594":{"id":2958594,"sourceID":2958597,"targetID":2958599},"2958595":{"id":2958595,"sourceID":2958598,"targetID":2958593}},"failureConnectors":{"2958574":{"id":2958574,"sourceID":2958597,"targetID":2958592}},"unconditionalConnectors":{"2958575":{"id":2958575,"sourceID":2958600,"targetID":2958597}},"trueConnectors":{"2958573":{"id":2958573,"sourceID":2958599,"targetID":2958598}},"falseConnectors":{"2958572":{"id":2958572,"sourceID":2958599,"targetID":2958596}},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{"minutes_running":{"definition":{"name":"minutes_running","type":"DECIMAL","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"0"}},"grids":{}},"info":{"name":"refresh_length_check","description":"Checks how long the Run Daily Refresh job has been running","type":"ORCHESTRATION","tag":"bb3b5a84-8b7d-43c9-9fe5-524fc20cafb5"}}