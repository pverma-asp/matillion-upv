{"job":{"components":{"2967752":{"id":2967752,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":0,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2967772,2967775],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Start","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967753":{"id":2967753,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-128,"y":80,"width":32,"height":32,"inputConnectorIDs":[2967772],"outputSuccessConnectorIDs":[2967773],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"create external table scripts - ring_attempts"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"create or replace external table adw.api.stg_talkdesk_ring_attempts\n(\n  file_name varchar(255) as split_part(metadata$filename, '/', 4),\n  file_date date as to_date(substr(split_part(metadata$filename, '/', 4), 22, 8), 'YYYYMMDD')\n)\n  partition by (file_date)\n  with location = @public.datateam/api/talkdesk/ring_attempts\n  file_format = (type= json)\n;\n\nGRANT SELECT ON ALL external TABLES IN SCHEMA ADW.API TO DATA_ENGINEERING_GROUP;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967754":{"id":2967754,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-295,"y":196,"width":32,"height":32,"inputConnectorIDs":[2967773],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"create table scripts - ring_attempts"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"create or replace table api.talkdesk_ring_attempts (\n    file_date date,\n    file_name varchar(255),\n    attempt_type varchar(255),\n    batch_ring_id varchar(255),\n    contact_id varchar(255),\n    interaction_id varchar(255),\n    ring_attempt_duration numeric(20,2),\n    ring_attempt_id varchar(255),\n    ring_finished_at_time timestamp_tz,\n    ring_started_at_time timestamp_tz,\n    team_name varchar(255),\n    user_email varchar(255),\n    user_name varchar(255),\n    etl_load_date timestamp_tz default current_timestamp not null\n)\n;\n\nGRANT SELECT ON ALL TABLES IN SCHEMA ADW.API TO DATA_ENGINEERING_GROUP;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967755":{"id":2967755,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":64,"y":144,"width":32,"height":32,"inputConnectorIDs":[2967775],"outputSuccessConnectorIDs":[2967751],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"refresh external table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"alter external table adw.api.stg_talkdesk_ring_attempts refresh;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967758":{"id":2967758,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":206,"y":274,"width":32,"height":32,"inputConnectorIDs":[2967751],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"populate parsed table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"delete from api.talkdesk_ring_attempts\nwhere FILE_DATE='${file_date}'\n;\n\ninsert into api.talkdesk_ring_attempts\n    (FILE_DATE, FILE_NAME, ATTEMPT_TYPE, BATCH_RING_ID, CONTACT_ID, INTERACTION_ID, RING_ATTEMPT_DURATION, RING_ATTEMPT_ID, RING_FINISHED_AT_TIME, RING_STARTED_AT_TIME, TEAM_NAME, USER_EMAIL, USER_NAME) \nselect\n    FILE_DATE,\n    FILE_NAME,\n    fl.VALUE:attempt_type,\n    fl.VALUE:batch_ring_id,\n    fl.VALUE:contact_id,\n    fl.VALUE:interaction_id,\n    fl.VALUE:ring_attempt_duration,\n    fl.VALUE:ring_attempt_id,\n    fl.VALUE:ring_finished_at_time,\n    fl.VALUE:ring_started_at_time,\n    fl.VALUE:team_name,\n    fl.VALUE:user_email,\n    fl.VALUE:user_name\n\nfrom api.STG_talkdesk_ring_attempts report,\n     lateral flatten (input => report.value, path => 'entries') fl\nwhere 1=1\n  and FILE_DATE='${file_date}'\n--   and fl.VALUE:call_id='5ade27e4b826481494ca4aa81df3c29c'\n-- limit 5\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2967751":{"id":2967751,"sourceID":2967755,"targetID":2967758},"2967773":{"id":2967773,"sourceID":2967753,"targetID":2967754}},"failureConnectors":{},"unconditionalConnectors":{"2967772":{"id":2967772,"sourceID":2967752,"targetID":2967753},"2967775":{"id":2967775,"sourceID":2967752,"targetID":2967755}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{"file_date":{"definition":{"name":"file_date","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"2021-10-01"}},"grids":{}},"info":{"name":"talkdesk_ring_attempts_report_day","description":"","type":"ORCHESTRATION","tag":"a14cdb3a-a7d0-4333-a635-a67797e24288"}}