{"job":{"components":{"2967780":{"id":2967780,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":160,"y":16,"width":32,"height":32,"inputConnectorIDs":[2967778],"outputSuccessConnectorIDs":[2967776],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"download talkdesk report"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import boto3\n#python function to call lambda to encrypt s3 file to send to galileo\nimport time\n\nbody = json.dumps(dict(report_type='calls',\n                       date='${file_date}',\n                       file_name='s3://aspiration-datateam/api/talkdesk/calls/calls_report_20211102.json'\n                      ))\n\ndef run_lambda():\n    client = boto3.client('lambda', region_name='us-west-2')\n    response = client.invoke(\n    FunctionName='arn:aws:lambda:us-west-2:332894900161:function:DEV-1498_DataTeam-TalkDesk',\n    InvocationType='Event',\n    LogType='Tail',\n    Payload=body\n    )\n\n\nprint ('download talkdesk report:', 'calls', '${file_date}')\nrun_lambda()\n\nprint ('wait 30 seconds for report download...')\n#time.sleep(30)"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967781":{"id":2967781,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":206,"y":274,"width":32,"height":32,"inputConnectorIDs":[2967782],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"populate parsed table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"delete from api.talkdesk_calls\nwhere FILE_DATE='${file_date}'\n;\n\ncall ADW.api.parse_talkdesk_calls('${file_date}');"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967783":{"id":2967783,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-415,"y":327,"width":32,"height":32,"inputConnectorIDs":[2967779],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"adhoc"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"alter table api.talkdesk_contacts modify column direct_assignment_user VARCHAR(65535);\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967784":{"id":2967784,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":0,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2967778,2967800],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Start","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967785":{"id":2967785,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-128,"y":80,"width":32,"height":32,"inputConnectorIDs":[2967800],"outputSuccessConnectorIDs":[2967777],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"create external table scripts - calls"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"create or replace external table adw.api.stg_talkdesk_calls(\n  file_name varchar(255) as split_part(metadata$filename, '/', 4),\n  file_date date as to_date(substr(split_part(metadata$filename, '/', 4), 14, 8), 'YYYYMMDD')\n)\n  partition by (file_date)\n  with location = @public.datateam/api/talkdesk/calls\n  file_format = (type= json)\n;\n\nGRANT SELECT ON ALL external TABLES IN SCHEMA ADW.API TO DATA_ENGINEERING_GROUP;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967786":{"id":2967786,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-295,"y":196,"width":32,"height":32,"inputConnectorIDs":[2967777],"outputSuccessConnectorIDs":[2967779],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"create table scripts - calls"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"create or replace table api.talkdesk_calls (\n    file_date date,\n    file_name varchar(255),\n    abandon_time numeric(20,2),\n    call_id varchar(255),\n    callsid varchar(255),\n    contact_phone_number varchar(255),\n    csat_score varchar(255),\n    csat_survey_time varchar(255),\n    disposition_code varchar(255),\n    end_at timestamp_tz,\n    handling_user_email varchar(255),\n    handling_user_id varchar(255),\n    handling_user_name varchar(255),\n    hold_time numeric(20,2),\n    is_call_forwarding boolean,\n    is_callback_from_queue boolean,\n    is_external_transfer boolean,\n    is_if_no_answer boolean,\n    is_in_business_hours boolean,\n    is_mood_prompted boolean,\n    is_transfer boolean,\n    ivr_options varchar(255),\n    mood varchar(255),\n    notes variant,\n    rating_reason varchar(255),\n    recording_url varchar(255),\n    ring_groups varchar(255),\n    start_at timestamp_tz,\n    talk_time numeric(20,2),\n    talkdesk_phone_display_name varchar(255),\n    talkdesk_phone_number varchar(255),\n    team_id varchar(255),\n    team_name varchar(255),\n    total_ringing_time numeric(20,2),\n    total_time numeric(20,2),\n    type varchar(255),\n    user_email varchar(255),\n    user_id varchar(255),\n    user_name varchar(255),\n    user_voice_rating numeric(20,2),\n    wait_time numeric(20,2),\n    etl_load_date timestamp_tz default current_timestamp not null\n)\n;\n\nGRANT SELECT ON ALL TABLES IN SCHEMA ADW.API TO DATA_ENGINEERING_GROUP;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967787":{"id":2967787,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":160,"y":144,"width":32,"height":32,"inputConnectorIDs":[2967776],"outputSuccessConnectorIDs":[2967782],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"refresh external table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"alter external table adw.api.stg_talkdesk_calls refresh;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2967776":{"id":2967776,"sourceID":2967780,"targetID":2967787},"2967777":{"id":2967777,"sourceID":2967785,"targetID":2967786},"2967779":{"id":2967779,"sourceID":2967786,"targetID":2967783},"2967782":{"id":2967782,"sourceID":2967787,"targetID":2967781}},"failureConnectors":{},"unconditionalConnectors":{"2967778":{"id":2967778,"sourceID":2967784,"targetID":2967780},"2967800":{"id":2967800,"sourceID":2967784,"targetID":2967785}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{"file_date":{"definition":{"name":"file_date","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"2021-10-01"}},"grids":{}},"info":{"name":"talkdesk_calls_report_day","description":"","type":"ORCHESTRATION","tag":"17b1d083-ec93-4fb2-8176-9592b36790e9"}}