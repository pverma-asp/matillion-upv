{"job":{"components":{"2964536":{"id":2964536,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-1024,"y":160,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2964538],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964539":{"id":2964539,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-832,"y":160,"width":32,"height":32,"inputConnectorIDs":[2964538],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SQL Script 0"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"copy into @public.algolift/daily_data/engagement/engagementtransaction_date=${current_year}-${current_month}-${current_day}/engagement_${current_year}-${current_month}-${current_day}.csv\nfrom (with js_segment as (\n        select user_id\n         ,anonymous_id\n         ,received_at\n         ,event\n         ,'web' as event_source\n        from segment_events.prod_segment_js.tracks\n        where received_at::date =  '${current_year}-${current_month}-${current_day}'\n)\n,\n    segment_ios as (\n        select user_id\n        ,anonymous_id\n        ,received_at\n        ,event\n        ,'ios' as event_source\n        from segment_events.prod_segment_ios.tracks\n        where received_at::date =  '${current_year}-${current_month}-${current_day}'\n        union all\n        select user_id\n        ,anonymous_id\n        ,received_at\n        ,event\n        ,'ios' as event_source\n        from segment_events.prod_segment_ios.install_attributed\n        where received_at::date =  '${current_year}-${current_month}-${current_day}'\n)\n,\n    segment_android as (\n        select user_id\n        ,anonymous_id\n        ,received_at\n        ,event\n        ,'android' as event_source\n        from segment_events.prod_segment_android.tracks\n        where received_at::date =  '${current_year}-${current_month}-${current_day}'\n        union all\n        select user_id\n        ,anonymous_id\n        ,received_at\n        ,event\n        ,'android' as event_source\n        from segment_events.prod_segment_android.install_attributed\n        where received_at::date =  '${current_year}-${current_month}-${current_day}'\n)\n,\n    segment_tracker_service as (\n        select user_id\n        ,NULL as anonymous_id\n        ,received_at\n        ,event\n        ,NULL as event_source\n        from segment_events.prod_segment_tracker_service.tracks\n        where received_at::date =  '${current_year}-${current_month}-${current_day}'\n    )\n,\n    segment_data as (\n    select *\n    from js_segment jss\n    union all\n    select *\n    from segment_ios\n    union all\n    select *\n    from segment_android\n    union all\n    select *\n    from segment_tracker_service\n)\nselect coalesce(nullif(sd.user_id,''),sd.anonymous_id) as user_id\n,sd.event\n,count(*) as transaction_count\nfrom segment_data sd\ngroup by sd.event,sd.received_at,sd.event_source,sd.user_id, sd.anonymous_id)\nfile_format = (type=csv, fields_optionally_enclosed_by = '\"')\nheader = true;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{},"failureConnectors":{},"unconditionalConnectors":{"2964538":{"id":2964538,"sourceID":2964536,"targetID":2964539}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{"2964537":{"id":2964537,"x":-1072,"y":-273,"width":568,"height":363,"text":"CSV file formatting:\n- Headers should be present\n- All field entries should be in double quotes\n- Lines terminated by \\r\\n\n- NULL text fields should be delivered as NULL(empty field)\n- Revenue fields should never be NULL. If NULL in your dataset, pass 0\n- Engagement/Transaction counts should never be NULL. If NULL pass 0\n- Any other numerical field can be passed as NULL\n- Date format for all dates should be: YYYY-MM-DD hh:mm:ss\n- All times are assumed as UTC\n-Install and transaction files should be free from duplicates\n\nFile names should be named consistently with the following format:\n{date}_install_{titlename/identifier}.csv\n{date}_transaction_{titlename/identifier}.csv\n{date}_engagement_{titlename/identifier}.csv\n\nExample, 2017-10-01_install_your_company_name.csv\nAll CSVs should be delivered daily around midnight to an s3 bucket that will be assigned to you","colour":"e6e63c"}},"variables":{"current_day":{"definition":{"name":"current_day","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"28"},"current_month":{"definition":{"name":"current_month","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"05"},"current_year":{"definition":{"name":"current_year","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"2018"},"file_date":{"definition":{"name":"file_date","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"target_s3_bucket":{"definition":{"name":"target_s3_bucket","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""}},"grids":{}},"info":{"name":"user_engagement","description":"User engagement data is a record of important user events such as log-ins.","type":"ORCHESTRATION","tag":"4ac803a4-1ed4-4d68-8344-609144311047"}}