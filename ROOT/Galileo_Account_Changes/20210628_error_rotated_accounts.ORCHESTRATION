{"job":{"components":{"2967001":{"id":2967001,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":160,"y":288,"width":32,"height":32,"inputConnectorIDs":[2967003],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Send_BChanges_File_to_Galileo 0"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Send_BChanges_File_to_Galileo"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"galileo_filename"},"2":{"slot":2,"type":"STRING","value":"${galileo_filename}"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967004":{"id":2967004,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":128,"y":64,"width":32,"height":32,"inputConnectorIDs":[2967085],"outputSuccessConnectorIDs":[2967002],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"load ato user ids"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"create table etl.ato_user_ids_20210601 as\nwith user_ids as (\n    select distinct message:user_id as user_id\n    from events_db.domain_event\n    where type = 'Session'\n      and subtype = 'Request'\n      and message: language = 'de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7'\n      and created_at >= '2021-05-01'\n),\nuser_id_cma as (\n     select distinct ua.user_id\n     from web_db.user_account ua\n              inner join web_db.account a on a.id = ua.account_id\n              inner join web_db.depository d on d.account_id = a.id\n     where d.product_id in ('4', '5')\n       and ua.user_id in (select user_id from user_ids)\n)\nselect *\nfrom user_id_cma\n;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967006":{"id":2967006,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":0,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2967085],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967007":{"id":2967007,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":160,"y":176,"width":32,"height":32,"inputConnectorIDs":[2967002],"outputSuccessConnectorIDs":[2967003],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"create galileo account change table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"UPDATE etl.galileo_account_changes_batch_header\nSET file_name = '${galileo_filename}.gpg',\n       file_transmit_date = '${file_transmit_date}'\nWHERE record_type = 'H'\n;\n\ndelete from etl.galileo_account_changes_batch_detail;\ninsert into etl.galileo_account_changes_batch_detail(record_type, record_number, account_id_type, account_identifier, action_code, action_value)\n\nwith prns as (\n    select SPEND_GALILEO_PRN as prn\n    from ujc.error_rotated_accounts_20210628\n    where 1 = 1\n\n    union all\n\n    select SAVE_GALILEO_PRN as prn\n    from ujc.error_rotated_accounts_20210628\n    where 1 = 1\n      and SAVE_GALILEO_PRN is not null\n)\nselect\n  'D' as record_type\n  ,row_number() over (order by prn) as recordnumber\n  ,'R' as accountidtype\n  ,prn::varchar as accountidentifier\n  ,'2' as actioncode\n  ,'Z' actionvalue\nfrom prns\nwhere 1=1\n  and prn is not null\n;\n\n\n\n\n--trailer data\nUPDATE etl.galileo_account_changes_batch_trailer\n   SET \"count\" = (select count(*) from etl.galileo_account_changes_batch_detail)\nWHERE record_type = 'T';\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2967002":{"id":2967002,"sourceID":2967004,"targetID":2967007},"2967003":{"id":2967003,"sourceID":2967007,"targetID":2967001}},"failureConnectors":{},"unconditionalConnectors":{"2967085":{"id":2967085,"sourceID":2967006,"targetID":2967004}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{"file_transmit_date":{"definition":{"name":"file_transmit_date","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"06282021"},"galileo_filename":{"definition":{"name":"galileo_filename","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"bchanges_584_20210628_er001.txt"}},"grids":{}},"info":{"name":"20210628_error_rotated_accounts","description":"","type":"ORCHESTRATION","tag":"0c64edc2-dedd-4f18-8b35-86216431a22f"}}