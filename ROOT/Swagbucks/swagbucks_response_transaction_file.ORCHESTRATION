{"job":{"components":{"2961941":{"id":2961941,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":620619864,"x":-79,"y":-80,"width":32,"height":32,"inputConnectorIDs":[2961936],"outputSuccessConnectorIDs":[2961939],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Move"}}}},"visible":true},"2":{"slot":2,"name":"Source Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"S3"}}}},"visible":true},"4":{"slot":4,"name":"Target Object Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${output_filename}"}}}},"visible":true},"5":{"slot":5,"name":"Target Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"S3"}}}},"visible":true},"6":{"slot":6,"name":"Set Home Directory as Root","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"7":{"slot":7,"name":"Source URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ftp://[username[:password]@]hostname[:port][path]"}}}},"visible":false},"8":{"slot":8,"name":"Source Username","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"9":{"slot":9,"name":"Source Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":""}}}},"visible":false},"10":{"slot":10,"name":"Source URL","elements":{},"visible":false},"11":{"slot":11,"name":"Source URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"hdfs://host:port/filePath"}}}},"visible":false},"12":{"slot":12,"name":"Perform Certificate Validation","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"13":{"slot":13,"name":"Source URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"https://[username[:password]@]hostname[:port][absolute-path]"}}}},"visible":false},"14":{"slot":14,"name":"Source Username","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"15":{"slot":15,"name":"Source Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":""}}}},"visible":false},"16":{"slot":16,"name":"Source URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"http://[username[:password]@]hostname[:port][absolute-path]"}}}},"visible":false},"17":{"slot":17,"name":"Source Username","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"18":{"slot":18,"name":"Source Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":""}}}},"visible":false},"19":{"slot":19,"name":"Source URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"s3://${temp_bucket}/${output_filename}000"}}}},"visible":true},"20":{"slot":20,"name":"Set Home Directory as Root","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"21":{"slot":21,"name":"Source URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"sftp://[username[:password]@]hostname[:port][path]"}}}},"visible":false},"22":{"slot":22,"name":"Source Username","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"23":{"slot":23,"name":"Source Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":""}}}},"visible":false},"24":{"slot":24,"name":"Source SFTP Key","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"25":{"slot":25,"name":"Source URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"smb://[[[authdomain;]user@]host[:port][/share[/dirpath][/name]]][?context]"}}}},"visible":false},"26":{"slot":26,"name":"Source Domain","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"27":{"slot":27,"name":"Source Username","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"28":{"slot":28,"name":"Source Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":""}}}},"visible":false},"29":{"slot":29,"name":"Target URL","elements":{},"visible":false},"30":{"slot":30,"name":"Target URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"hdfs://host:port/filePath"}}}},"visible":false},"31":{"slot":31,"name":"Target URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"s3://${output_bucket}/"}}}},"visible":true},"33":{"slot":33,"name":"Set Home Directory as Root","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"34":{"slot":34,"name":"Target URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"sftp://[username[:password]@]hostname[:port][path]"}}}},"visible":false},"35":{"slot":35,"name":"Target Username","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"36":{"slot":36,"name":"Target Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":""}}}},"visible":false},"37":{"slot":37,"name":"Target SFTP Key","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"38":{"slot":38,"name":"Target URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"smb://[[[authdomain;]user@]host[:port][/share[/dirpath][/name]]][?context]"}}}},"visible":false},"39":{"slot":39,"name":"Target Domain","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"40":{"slot":40,"name":"Target Username","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"41":{"slot":41,"name":"Target Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":""}}}},"visible":false},"42":{"slot":42,"name":"Unpack ZIP file","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"43":{"slot":43,"name":"Gzip data","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"50":{"slot":50,"name":"URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"https://<account>.sharepoint.com"}}}},"visible":false},"51":{"slot":51,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"52":{"slot":52,"name":"Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":""}}}},"visible":false},"53":{"slot":53,"name":"SharePoint Edition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SharePoint Online"}}}},"visible":false},"54":{"slot":54,"name":"File Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Document"}}}},"visible":false},"55":{"slot":55,"name":"Library","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"56":{"slot":56,"name":"File URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"57":{"slot":57,"name":"Connection Options","elements":{},"visible":false},"16040":{"slot":16040,"name":"Blob Location","elements":{},"visible":false},"16140":{"slot":16140,"name":"Blob Location","elements":{},"visible":false},"40000":{"slot":40000,"name":"Encryption","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"None"}}}},"visible":true},"40001":{"slot":40001,"name":"KMS Key ID","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2961944":{"id":2961944,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":0,"y":0,"width":32,"height":32,"inputConnectorIDs":[2961942],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2961945":{"id":2961945,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-400,"y":0,"width":32,"height":32,"inputConnectorIDs":[2961938],"outputSuccessConnectorIDs":[2961943],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Variables"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Udating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\nimport re\n\n#add run_history_id to create a unique temp table for parrallel processing\ncontext.updateVariable(\"staging_table\", staging_table + str(run_history_id))\n\nre_pattern = r'^([^.]+)(([.]+[^.]+)*)$'\nre_replace = r'\\1_payouts\\2'\nre_string = '${input_filename}'\nre_output = re.sub(re_pattern,re_replace,re_string)\n\ncontext.updateVariable(\"output_filename\", re_output)\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2961946":{"id":2961946,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-160,"y":0,"width":32,"height":32,"inputConnectorIDs":[2961937],"outputSuccessConnectorIDs":[2961936],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Output"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"UNLOAD ('\n  SELECT redemption_id\n       , BatchDate\n       , DistributionAmount\n       , OrderID\n       , aspiration_transaction_id\n       , status\n  FROM etl.${staging_table}\n  ORDER BY etl_rownum ASC\n        ')\nTO 's3://${temp_bucket}/${output_filename}'\nIAM_ROLE 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nDELIMITER AS ','\nPARALLEL OFF ENCRYPTED\nALLOWOVERWRITE;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2961947":{"id":2961947,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-240,"y":0,"width":32,"height":32,"inputConnectorIDs":[2961940],"outputSuccessConnectorIDs":[2961937],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Temp"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE etl.${staging_table} AS\n   (SELECT 0 \t\t\t\t\t\t\t\t\t  AS etl_rownum\n\t\t, 'redemption_id'\t\t\t\t::VARCHAR AS redemption_id\n\t\t, 'BatchDate'\t\t\t\t\t::VARCHAR AS BatchDate\n\t\t, 'DistributionAmount'\t\t\t::VARCHAR AS DistributionAmount\n\t\t, 'OrderID'\t\t\t\t\t\t::VARCHAR AS OrderID\n\t\t, 'aspiration_transaction_id'\t::VARCHAR AS aspiration_transaction_id\n\t\t, 'status'\t\t\t\t\t\t::VARCHAR AS status\n   UNION ALL\n   SELECT red.etl_rownum \t\t\t\t\t\t  AS etl_rownum\n\t\t, red.redemption_code\t\t\t::VARCHAR AS redemption_id\n\t\t, red.batch_date \t\t\t\t::VARCHAR AS BatchDate\n\t\t, red.distribution_amount\t\t::VARCHAR AS DistributionAmount\n\t\t, red.order_id\t\t\t\t\t::VARCHAR AS OrderID\n\t\t, red.transaction_identifier\t::VARCHAR AS aspiration_transaction_id\n\t\t, res.response_code\t\t\t\t::VARCHAR AS status\n   FROM rdl.swagbucks_response res\n   JOIN rdl.swagbucks_redemption red ON red.transaction_identifier = res.transaction_identifier\n   WHERE res.etl_filename = '${output_filename}')\n   ORDER BY etl_rownum ASC"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2961948":{"id":2961948,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-80,"y":0,"width":32,"height":32,"inputConnectorIDs":[2961939],"outputSuccessConnectorIDs":[2961942],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Cleanup"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DROP TABLE IF EXISTS ${staging_schema}.${staging_table};"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2961949":{"id":2961949,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-480,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2961938],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2961950":{"id":2961950,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-320,"y":0,"width":32,"height":32,"inputConnectorIDs":[2961943],"outputSuccessConnectorIDs":[2961940],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Store"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INSERT INTO rdl.swagbucks_response \n\t( etl_run_history_id\n\t, etl_timestamp\n\t, etl_filename\n\t, file_transmit_date\n\t, transaction_identifier\n\t, response_code)\nSELECT '${run_history_id}' \t\tAS ETL_RUN_HISTORY_ID\n\t , sysdate\t\t\t\t\tAS ETL_TIMESTAMP\n\t , '${output_filename}' \tAS ETL_FILENAME\n     , t.paid_file_transmit_date\n     , t.transaction_identifier\n     , t.aspiration_response_code\nFROM rdl.swagbucks_redemption_status_v t\nWHERE t.etl_filename = '${input_filename}';"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2961936":{"id":2961936,"sourceID":2961946,"targetID":2961941},"2961937":{"id":2961937,"sourceID":2961947,"targetID":2961946},"2961939":{"id":2961939,"sourceID":2961941,"targetID":2961948},"2961940":{"id":2961940,"sourceID":2961950,"targetID":2961947},"2961942":{"id":2961942,"sourceID":2961948,"targetID":2961944},"2961943":{"id":2961943,"sourceID":2961945,"targetID":2961950}},"failureConnectors":{},"unconditionalConnectors":{"2961938":{"id":2961938,"sourceID":2961949,"targetID":2961945}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{"file_number":{"definition":{"name":"file_number","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""},"input_filename":{"definition":{"name":"input_filename","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"passed_variable.out.txt"},"output_bucket":{"definition":{"name":"output_bucket","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"s3://aspiration-etl-staging/file_processing/galileo_batch_transactions/response_files"},"output_filename":{"definition":{"name":"output_filename","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""},"staging_table":{"definition":{"name":"staging_table","type":"TEXT","scope":"BRANCH","description":"","visibility":"PRIVATE"},"value":"tmp_response"},"temp_bucket":{"definition":{"name":"temp_bucket","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"aspiration-etl-staging/file_processing/swagbucks/temp"}},"grids":{}},"info":{"name":"swagbucks_response_transaction_file","description":"","type":"ORCHESTRATION","tag":"69cf98aa-3910-4b8a-af67-504a12a9a1fd"}}