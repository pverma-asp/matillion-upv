{"job":{"components":{"2961151":{"id":2961151,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-527,"y":198,"width":32,"height":32,"inputConnectorIDs":[2961201],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"export save reminder emails"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"set timezone = 'America/Los_Angeles';\n\nUNLOAD ('\n\n\n-- users qualify for $1 ach transfers\nWITH users_qualify_ach_transfer AS (\n    SELECT\n      --   pt.depository_id\n      --   count(DISTINCT upa.user_id)\n      upa.user_id\n    FROM web_db.posted_transaction pt\n      JOIN web_db.galileo_posted_transaction gpt ON pt.id = gpt.posted_transaction_id\n      JOIN web_db.user_payment_account upa ON pt.depository_id = upa.depository_id\n    WHERE 1 = 1\n          AND transaction_code_type IN (''PMCE'', ''PMAC'', ''PMOR'', ''PMDP'', ''PMML'', ''ADQ'', ''SE8'')\n          AND pt.post_date >= ''2019-05-01''\n          AND pt.amount >= 1\n  -- LIMIT 500\n)\n-- SELECT\n--   count(DISTINCT user_id)\n--   *\n-- FROM users_qualify_ach_transfer;\n\n-- users qualify for $1 investment transfers\n, users_qualify_investment_transfer AS (\n    SELECT\n      user_id\n    FROM web_db.investment_txn it\n    JOIN web_db.investment i ON it.investment_id=i.id\n    JOIN web_db.account a ON i.account_id=a.id\n    JOIN web_db.user_account ua ON a.id=ua.account_id\n    WHERE 1=1\n      AND it.settled_date>=''2019-05-01''\n      AND settled_amount>=1\n)\n-- SELECT\n--   *\n--   count(DISTINCT user_id)\n-- FROM users_qualify_investment_transfer;\n\n-- users qualify for 10k daily balance\n,users_qualify_balance AS (\n    SELECT\n      user_id, dadd.*\n    --   count(dtad.unique_account_id)\n    --   count(DISTINCT da.user_id)\n    FROM bi.dt_account_daily_data dadd\n    JOIN bi.dt_accounts da ON dadd.unique_account_id=da.unique_account_id\n    WHERE 1=1\n      AND dadd.date>=''2019-05-01''\n      AND (dadd.spend_daily_balance>10000\n        OR dadd.save_daily_balance>10000\n      )\n    -- LIMIT 500\n    -- ;\n)\n-- SELECT\n--   *\n--   count(DISTINCT user_id)\n-- FROM users_qualify_balance;\n\n\nSELECT\n--  count(DISTINCT da.user_id)\n  da.user_id,\n  du.user_email,\n  du.first_name,\n  du.last_name\nFROM bi.dt_accounts da\nJOIN bi.dt_users du ON da.user_id=du.user_id\nWHERE 1=1\n  AND da.save_galileo_prn IS NOT NULL\n  AND da.user_id NOT IN (\n    SELECT user_id FROM users_qualify_ach_transfer\n      UNION\n    SELECT user_id FROM users_qualify_investment_transfer\n      UNION\n    SELECT user_id FROM users_qualify_balance\n  )\n')\nTO 's3://aspiration-datateam/dump/jchen/20190528_1930_may_apy_not_qualify_emails'\niam_role '${redshift_role}'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nDELIMITER AS ','\nPARALLEL OFF\nALLOWOVERWRITE\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2961204":{"id":2961204,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-464,"y":32,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python Script 0"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\n\nprint 'task 1'\n\nprint retry_iteration_no\n\n\nraise ValueError('invalid value')"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[2961224]},"2961205":{"id":2961205,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"ITERATE","implementationID":-158614544,"x":-464,"y":0,"width":32,"height":16,"inputConnectorIDs":[2961225],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2961202],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Iterations Attempted","mapTo":"retry_iteration_no"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Retry 0"}}}},"visible":true},"2":{"slot":2,"name":"Number of Retries","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"2"}}}},"visible":true},"3":{"slot":3,"name":"Retry Delay","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Short delay"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[2961224],"inputIterationConnectorIDs":[]},"2961206":{"id":2961206,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-145,"y":188,"width":32,"height":32,"inputConnectorIDs":[2961250],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Recreate rdl ticket comments table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"drop table if exists rdl.zendesk_ticket_comments;\n\ncreate TABLE rdl.zendesk_ticket_comments AS (\nSELECT\n    zt.id as ticket_id,\n    zt.created_at as ticket_created_at,\n    zt.subject as ticket_subject,\n    zt.description as ticket_description,\n    zt.status as ticket_status,\n    zt.is_public as ticket_is_public,\n    zt.priority as ticket_priority,\n    zt.group_id as ticket_group_id,\n    zt.tags as ticket_tags,\n\n    zt.submitter_id as ticket_submitter_id,\n    zusub.name as ticket_submitter_name,\n    zusub.email as ticket_submitter_email,\n\n    zt.requester_id as ticket_requester_id,\n    zureq.name as ticket_requester_name,\n    zureq.email as ticket_requester_email,\n\n    zt.assignee_id as ticket_assignee_id,\n    zuass.name as ticket_assignee_name,\n    zuass.email as ticket_assignee_email,\n\n\n    zte.id as comment_id,\n    zte.created_at as comment_timestamp,\n    zte.child_type as comment_type,\n    zte.author_id as author_id,\n    zuaut.name as author_name,\n    zte.child_plain_body as comment_plain_body,\n    zte.child_via_source_from_address as address_from,\n    zte.child_via_source_from_name as name_from,\n    zte.child_via_source_to_address as address_to,\n    zte.child_via_source_to_name as name_to,\n    zte.child_via_channel as comment_channel,\n    zte.child_via_source_rel as comment_source_rel\n\nFROM prod_zendesk.zendesk_tickets_incremental as zt\n  JOIN prod_zendesk.zendesk_users_incremental as zusub ON zt.submitter_id=zusub.id\n  JOIN prod_zendesk.zendesk_users_incremental as zureq ON zt.requester_id=zureq.id\n  JOIN prod_zendesk.zendesk_users_incremental as zuass ON zt.assignee_id=zuass.id\n  JOIN prod_zendesk.zendesk_ticket_events_incremental as zte ON zte.ticket_id=zt.id\n  JOIN prod_zendesk.zendesk_users_incremental as zuaut ON zte.author_id = zuaut.id\nWHERE zte.child_type='Comment'\n);\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2961207":{"id":2961207,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-614,"y":9,"width":32,"height":32,"inputConnectorIDs":[2961202],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python Script 1"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\n\nprint retry_iteration_no"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2961208":{"id":2961208,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":1214167174,"x":-416,"y":96,"width":32,"height":32,"inputConnectorIDs":[2961249],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2961201],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Zendesk_ticket_events_incremental_load_one_page"}}}},"visible":true},"2":{"slot":2,"name":"Basic/Advanced Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Basic"}}}},"visible":true},"6":{"slot":6,"name":"Data Source","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"tickets_events_incremental_load_no_paging_test1"}}}},"visible":true},"7":{"slot":7,"name":"Data Selection","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"created_at"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"event_type"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"system_client"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"system_latitude"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"system_location"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"system_longitude"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"ticket_id"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"timestamp"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"updater_id"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"via"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"child_comment_present"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"child_comment_public"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"child_event_type"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"child_group_id"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"child_id"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"author_id"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"child_body"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"child_previous_value"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"child_priority"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"child_rel"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"child_requester_id"}}},"23":{"slot":23,"values":{"1":{"slot":1,"type":"STRING","value":"child_status"}}},"24":{"slot":24,"values":{"1":{"slot":1,"type":"STRING","value":"child_subject"}}},"25":{"slot":25,"values":{"1":{"slot":1,"type":"STRING","value":"child_type"}}},"26":{"slot":26,"values":{"1":{"slot":1,"type":"STRING","value":"child_plain_body"}}},"27":{"slot":27,"values":{"1":{"slot":1,"type":"STRING","value":"child_via"}}},"28":{"slot":28,"values":{"1":{"slot":1,"type":"STRING","value":"child_via_channel"}}},"29":{"slot":29,"values":{"1":{"slot":1,"type":"STRING","value":"child_via_source_rel"}}},"30":{"slot":30,"values":{"1":{"slot":1,"type":"STRING","value":"child_via_reference_id"}}},"31":{"slot":31,"values":{"1":{"slot":1,"type":"STRING","value":"child_assignee_id"}}}},"visible":true},"8":{"slot":8,"name":"Data Source Filter","elements":{},"visible":true},"9":{"slot":9,"name":"Combine Filters","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":true},"10":{"slot":10,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT ..."}}}},"visible":false},"11":{"slot":11,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"12":{"slot":12,"name":"Connection Options","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"profilesettings"},"2":{"slot":2,"type":"STRING","value":"start_time=${start_time};url_prefix=aspiration"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"AuthScheme"},"2":{"slot":2,"type":"STRING","value":"Basic"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"User "},"2":{"slot":2,"type":"STRING","value":"jchen@aspiration.com/token"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"Password "},"2":{"slot":2,"type":"STRING","value":"k3cbcoSB8PzaLBkNn55n2c2EFybmqmllEsAHi2Gd"}}}},"visible":true},"14":{"slot":14,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dev_zendesk"}}}},"visible":true},"15":{"slot":15,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"zendesk_tickets_events_incremental_test"}}}},"visible":true},"17":{"slot":17,"name":"S3 Staging Area","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"aspiration-etl-staging"}}}},"visible":true},"100":{"slot":100,"name":"Profile","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Zendesk_Custom"}}}},"visible":true},"1001":{"slot":1001,"name":"","elements":{},"visible":false},"1013":{"slot":1013,"name":"Auto Debug","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"On"}}}},"visible":true},"1014":{"slot":1014,"name":"Debug Level","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"2"}}}},"visible":true},"40000":{"slot":40000,"name":"Encryption","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SSE KMS"}}}},"visible":true},"40001":{"slot":40001,"name":"KMS Key ID","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${kms_s3_key}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2961209":{"id":2961209,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-304,"y":0,"width":32,"height":32,"inputConnectorIDs":[2961229],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2961225],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"adhoc sql script"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"-- alter table prod_zendesk.zendesk_tickets_events_incremental rename to zendesk_tickets_events_incremental_no_source_20190315;\n-- alter table prod_zendesk.zendesk_tickets_events_incremental_with_source rename to zendesk_ticket_events_incremental;\n-- alter table prod_zendesk.zendesk_ticket_events_incremental_all_comment_fields rename to zendesk_ticket_events_incremental;\n\n-- alter table prod_zendesk.zendesk_tickets_incremental rename to zendesk_tickets_incremental_20190627_no_form_id;\n-- alter table prod_zendesk.zendesk_tickets_incremental_form_id rename to zendesk_tickets_incremental;\n\n-- truncate prod_zendesk.zendesk_tickets_incremental_20190627_no_form_id;\n-- drop table prod_zendesk.zendesk_tickets_incremental_20190627_no_form_id;\n\n-- drop table prod_zendesk.zendesk_tickets_incremental_stg;\n-- drop table prod_zendesk_stg.zendesk_tickets_events_incremental;\n\n-- drop table dev_zendesk.zendesk_tickets_events_incremental;\n-- drop table dev_zendesk.zendesk_tickets_events_incremental_stg;\n\n-- drop table etl.bank_account_plaid_identity_info;\n\n-- truncate table prod_zendesk.zendesk_ticket_events_incremental_no_source_20190315;\n-- drop table prod_zendesk.zendesk_ticket_events_incremental;\n\n-- truncate table prod_zendesk.zendesk_ticket_events_incremental_all_comment_fields;\n\n-- delete from prod_zendesk.zendesk_load_errors where id in (336, 320, 304)\n\n-- update prod_zendesk.zendesk_load_errors\n-- set failure_reason='Same start_time after load.'\n-- where id=385\n--  and start_time=1498850876\n-- ;\n\n-- update prod_zendesk.zendesk_load_errors\n-- set api_type='zendesk_ticket_events_incremental_20190328'\n-- WHERE 1=1\n--   AND api_type='zendesk_ticket_events_incremental'\n-- ;\n\n-- alter table prod_zendesk.zendesk_ticket_metric_events_incremental drop column deleted;\n\n-- delete FROM prod_zendesk.zendesk_ticket_metric_events_incremental\n-- WHERE time > '2017-04-18 5:10:30'\n-- ;\n\n-- delete from prod_zendesk.zendesk_load_errors\n-- where id=328\n--   and start_time=1492676814\n\n\n-- delete FROM prod_zendesk.zendesk_load_errors\n-- WHERE api_type='zendesk_ticket_events_incremental_all_comment_fields'\n-- ;\n\n\n-- drop table web_db.galileo_ach_transaction;\n\n-- ALTER TABLE web_db.depository\n--     ADD COLUMN account_approved_time timestamp with time zone\n-- ;\n\n\n-- create table public.ujc_kkkkkk as\n-- select * from ucj_ext.ucj_galileo_response_codes\n-- ;\n\n-- create table public.ujc_map_response_codes_123\n-- as select * from ucj_ext.ucj_map_response_codes\n-- ;\n\n-- grant select on public.ujc_map_response_codes_123 to group read_only_group;\n\n\n-- alter table public.ujc_kkkkkk rename to ujc_galileo_response_codes_123\n\n\n-- create table rdl.swagbucks_map_response_codes as\n-- select * from ucj_ext.ucj_map_response_codes\n-- ;\n\n-- delete from rdl.partnership_transactions\n-- where etl_file_name='Swagbucks_redemptions_05012019.csv'\n-- ;\n\n-- alter table rdl.partnership_transactions\n-- add column galileo_response_file_name varchar(256)\n-- ;\n\n-- create table rdl.partnership_transactions_backup_20190701 as\n-- select * from rdl.partnership_transactions\n-- ;\n\n-- delete from rdl.partnership_transactions;\n\n-- alter table rdl.partnership_transactions rename to partnership_transactions_old;\n\n\n-- delete from rdl.swagbucks_redemption;\n\n-- delete from rdl.galileo_batch_transaction;\n\n-- delete from rdl.galileo_batch_response;\n\n-- delete from rdl.galileo_batch_transit;\n\n-- delete from rdl.swagbucks_response;\n\n\n-- ERROR: column \"apy\" of relation \"depository_apy_qualification\" does not exist\n-- alter table web_db_stg.depository_apy_qualification\n-- add column apy numeric(21,20)\n-- ;\n\n\n-- DROP table prod_zendesk.zendesk_ticket_metric_events_incremental_backup_08072019;\n\n-- drop table prod_zendesk.zendesk_ticket_events_incremental_backup_08072019;\n\n-- drop table prod_zendesk.zendesk_tickets_incremental_backup_08072019;\n\n-- drop table prod_zendesk.zendesk_users_incremental_backup_08072019;\n\n-- create table rdl.save_interest_calculation_20191126_backup\n-- as select * from rdl.save_interest_calculation\n\n-- create table dev_zendesk.raw_galileo_account_card_data_backup_20191211\n-- as select * from rdl.raw_galileo_account_card_data\n-- ;\n\n-- create table dev_zendesk.galileo_account_card_file_detail_staging_backup_20191211\n-- as select * from etl.galileo_account_card_file_detail_staging\n-- ;\n\n-- delete from rdl.raw_galileo_account_card_data\n-- where file_date='2019-12-11'\n-- ;\n\n-- drop TABLE public.ujc_map_response_codes_123;\n\n-- create table dev_zendesk.raw_galileo_customer_master_data_backup_20191216\n-- as select * from rdl.raw_galileo_customer_master_data;\n\n-- delete from rdl.raw_galileo_customer_master_data\n-- where file_date='2019-12-16';\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2961210":{"id":2961210,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-304,"y":176,"width":32,"height":32,"inputConnectorIDs":[2961248],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2961249],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Set start_time and sleep"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\nimport time\nimport datetime\n\nprint 'len(v_ticket_events_grid_variables):', len(context.getGridVariable('v_ticket_events_grid_variables'))\n\nif len(context.getGridVariable('v_ticket_events_grid_variables')) == 0:\n  print \"v_ticket_events_grid_variables not set, assign start_time=2001-01-01\"\n  context.updateVariable('start_time', datetime.datetime(2001,1,1,0,0,0,0))\nelse:\n  print \"assign start_time=\", context.getGridVariable('v_ticket_events_grid_variables')[0][0]\n  context.updateVariable('start_time', context.getGridVariable('v_ticket_events_grid_variables')[0][0])\n\n# an error occur during stating\n#context.updateVariable('start_time', datetime.datetime(2019,2,21,7,6,48,0))\n# next page\n#context.updateVariable('start_time', datetime.datetime(2019,2,21,16,3,10,0))\n\n# an error occur during staging\ncontext.updateVariable('start_time', datetime.datetime(2014,8,21,2,36,50,0))\n\nprint (type(start_time))\n# print (start_time.timestamp())\n# print ( (start_time - datetime.datetime(1970, 1, 1)).total_seconds() )\nprint ('start_time', start_time)\n\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2961211":{"id":2961211,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":1155583855,"x":-192,"y":96,"width":32,"height":32,"inputConnectorIDs":[2961203],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2961248],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Query start_time"}}}},"visible":true},"2":{"slot":2,"name":"Basic/Advanced","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Basic"}}}},"visible":true},"4":{"slot":4,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"zendesk_tickets_events_incremental_stg"}}}},"visible":true},"6":{"slot":6,"name":"Table Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"created_at"}}}},"visible":true},"7":{"slot":7,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"8":{"slot":8,"name":"Grid Variable","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"v_ticket_events_grid_variables"}}}},"visible":true},"9":{"slot":9,"name":"Grid Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"created_at"}}}},"visible":true},"10":{"slot":10,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"1"}}}},"visible":true},"11":{"slot":11,"name":"Order By","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"created_at"}}}},"visible":true},"12":{"slot":12,"name":"Sort","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Descending"}}}},"visible":true},"20":{"slot":20,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dev_zendesk"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2961212":{"id":2961212,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":1998016859,"x":96,"y":0,"width":32,"height":32,"inputConnectorIDs":[2961228],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2961231],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Import Zendesk Ticket Events Incremental Delta"}}}},"visible":true},"2":{"slot":2,"name":"Basic/Advanced Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Basic"}}}},"visible":true},"3":{"slot":3,"name":"Authentication","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"6":{"slot":6,"name":"Data Source","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"tickets_events_incremental"}}}},"visible":true},"7":{"slot":7,"name":"Data Selection","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"created_at"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"event_type"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"system_client"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"system_latitude"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"system_location"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"system_longitude"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"ticket_id"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"timestamp"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"updater_id"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"via"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"child_assignee_id"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"child_comment_present"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"child_comment_public"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"child_event_type"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"child_group_id"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"child_id"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"child_previous_value"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"child_priority"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"child_rel"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"child_requester_id"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"child_status"}}},"23":{"slot":23,"values":{"1":{"slot":1,"type":"STRING","value":"child_subject"}}},"24":{"slot":24,"values":{"1":{"slot":1,"type":"STRING","value":"child_type"}}},"25":{"slot":25,"values":{"1":{"slot":1,"type":"STRING","value":"child_via"}}},"26":{"slot":26,"values":{"1":{"slot":1,"type":"STRING","value":"child_via_reference_id"}}},"27":{"slot":27,"values":{"1":{"slot":1,"type":"STRING","value":"author_id"}}},"28":{"slot":28,"values":{"1":{"slot":1,"type":"STRING","value":"child_body"}}}},"visible":true},"8":{"slot":8,"name":"Data Source Filter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"start_time"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"${new Date(Date.now() - 10*86400000).toISOString().substring(0,10) + \" 00:00:00Z\"}"}}}},"visible":true},"9":{"slot":9,"name":"Combine Filters","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":true},"10":{"slot":10,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT ..."}}}},"visible":false},"11":{"slot":11,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"12":{"slot":12,"name":"Connection Options","elements":{},"visible":true},"14":{"slot":14,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dev_zendesk"}}}},"visible":true},"15":{"slot":15,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"zendesk_tickets_events_incremental_stg"}}}},"visible":true},"17":{"slot":17,"name":"S3 Staging Area","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"aspiration-etl-staging"}}}},"visible":true},"102":{"slot":102,"name":"Username","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"jchen@aspiration.com/token"}}}},"visible":true},"103":{"slot":103,"name":"Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"9aqYhnVmom4tHkxkPUMGAMirNHMXMKnyw2KGbbEl"}}}},"visible":true},"104":{"slot":104,"name":"URL Prefix","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"aspiration1530554843"}}}},"visible":true},"1001":{"slot":1001,"name":"","elements":{},"visible":false},"1013":{"slot":1013,"name":"Auto Debug","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"On"}}}},"visible":true},"1014":{"slot":1014,"name":"Debug Level","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"2"}}}},"visible":true},"1015":{"slot":1015,"name":"Authentication Method","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"User/Password"}}}},"visible":true},"40000":{"slot":40000,"name":"Encryption","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SSE KMS"}}}},"visible":true},"40001":{"slot":40001,"name":"KMS Key ID","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${kms_s3_key}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2961213":{"id":2961213,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-64,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2961203,2961228,2961229,2961250],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2961214":{"id":2961214,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":96,"y":176,"width":32,"height":32,"inputConnectorIDs":[2961230],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Update main tables from staging with extracted data"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"alter table dev_zendesk.zendesk_tickets_events_incremental \nappend from dev_zendesk.zendesk_tickets_events_incremental_stg;\n\n-- insert into dev_zendesk.zendesk_tickets_events_incremental (select * from dev_zendesk.zendesk_tickets_events_incremental_stg);\n-- truncate dev_zendesk.zendesk_tickets_events_incremental_stg;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2961215":{"id":2961215,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":96,"y":96,"width":32,"height":32,"inputConnectorIDs":[2961231],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2961230],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Delete extracted data in destination table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DELETE FROM dev_zendesk.zendesk_tickets_events_incremental\nWHERE id in (\n    SELECT id FROM dev_zendesk.zendesk_tickets_events_incremental_stg\n)"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{},"failureConnectors":{},"unconditionalConnectors":{"2961201":{"id":2961201,"sourceID":2961208,"targetID":2961151},"2961202":{"id":2961202,"sourceID":2961205,"targetID":2961207},"2961203":{"id":2961203,"sourceID":2961213,"targetID":2961211},"2961225":{"id":2961225,"sourceID":2961209,"targetID":2961205},"2961228":{"id":2961228,"sourceID":2961213,"targetID":2961212},"2961229":{"id":2961229,"sourceID":2961213,"targetID":2961209},"2961230":{"id":2961230,"sourceID":2961215,"targetID":2961214},"2961231":{"id":2961231,"sourceID":2961212,"targetID":2961215},"2961248":{"id":2961248,"sourceID":2961211,"targetID":2961210},"2961249":{"id":2961249,"sourceID":2961210,"targetID":2961208},"2961250":{"id":2961250,"sourceID":2961213,"targetID":2961206}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{"2961224":{"id":2961224,"sourceID":2961205,"targetID":2961204}},"noteConnectors":{},"notes":{},"variables":{"max_ticket_event_timestamp":{"definition":{"name":"max_ticket_event_timestamp","type":"DECIMAL","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"0"},"retry_iteration_no":{"definition":{"name":"retry_iteration_no","type":"DECIMAL","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""},"start_time":{"definition":{"name":"start_time","type":"DATETIME","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""}},"grids":{"v_ticket_events_grid_variables":{"definition":{"name":"v_ticket_events_grid_variables","scope":"BRANCH","definitions":[{"name":"max_created_at","type":"DATETIME"}],"description":"","visibility":"PUBLIC"},"values":[]},"v_ticket_grid_variables":{"definition":{"name":"v_ticket_grid_variables","scope":"BRANCH","definitions":[{"name":"max_ticket_event_timestamp","type":"DECIMAL"},{"name":"comp","type":"TEXT"},{"name":"start_time","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[]}}},"info":{"name":"Zendesk_Ticket_Events_Incremental_Load_Test","description":"","type":"ORCHESTRATION","tag":"57935e5b-7ed5-48dd-877c-88caf0612a29"}}