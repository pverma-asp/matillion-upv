{"job":{"components":{"2961573":{"id":2961573,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-144,"y":-64,"width":32,"height":32,"inputConnectorIDs":[2961572],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2961575],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"parse ticket custom json field"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"drop table if exists rdl.zendesk_ticket_custom_fields_new;\ncreate table rdl.zendesk_ticket_custom_fields_new (\n  zendesk_ticket_custom_fields_id bigint identity(1, 1),\n  ticket_id numeric(20),\n  field_name varchar(1000),\n  field_value varchar(10000),\n  field_value_1 varchar(10000),\n  field_value_2 varchar(10000),\n  primary key (ticket_id)\n)\n;\n\n\ninsert into rdl.zendesk_ticket_custom_fields_new\n    (ticket_id, field_name, field_value, field_value_1, field_value_2)\nSELECT\n       id as ticket_id,\n--        custom_fields,\n--        VALUE\n       VALUE:id    as field_name,\n       VALUE:value as field_value,\n       split_part(FIELD_VALUE, '__', 1) as field_value_1,\n       split_part(FIELD_VALUE, '__', 2) as field_value_2\nFROM prod_zendesk.zendesk_tickets_incremental,\n    lateral flatten(input => parse_json(custom_fields), outer => true)\nwhere 1 = 1\n--  and length(CUSTOM_FIELDS) < 2000\n--  and id = 66585\n;\n\n\nalter table rdl.zendesk_ticket_custom_fields\nrename to rdl.zendesk_ticket_custom_fields_old;\n\nalter table rdl.zendesk_ticket_custom_fields_new\nrename to rdl.zendesk_ticket_custom_fields;\n\ndrop table rdl.zendesk_ticket_custom_fields_old;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2961576":{"id":2961576,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-448,"y":-64,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2961574],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2961578":{"id":2961578,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":48,"y":-64,"width":32,"height":32,"inputConnectorIDs":[2961575],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"parse ticket tags field"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"drop table if exists rdl.lkp_zendesk_ticket_tags_new;\ncreate table rdl.lkp_zendesk_ticket_tags_new\n(\n  lkp_zendesk_ticket_tags_id bigint identity(1,1),\n  tag_name varchar(2000)\n);\n\ndrop table if exists zendesk_ticket_tags_map;\ncreate temp table zendesk_ticket_tags_map as\nwith tmp as (\n    select\n        id,\n        case\n            when startswith(tags, '[') then tags\n            else '[\"' || replace(tags, ',', '\",\"') || '\"]'\n        end as tags\n    from prod_zendesk.zendesk_tickets_incremental\n    where 1 = 1\n--       and id=1822407\n--       and id = 1354497\n)\nselect\n    id as ticket_id,\n    replace(VALUE, '\"', ')') as tag_name\nfrom tmp\n     ,lateral flatten(input => parse_json(tags), outer => true)\nwhere VALUE is not null\n;\n\ninsert into rdl.lkp_zendesk_ticket_tags_new(tag_name)\nselect distinct tag_name\nfrom zendesk_ticket_tags_map;\n\ndrop table if exists rdl.zendesk_ticket_tags_incremental_new;\ncreate table rdl.zendesk_ticket_tags_incremental_new\n(\n  zendesk_ticket_tags_id bigint identity(1, 1),\n  zendesk_tickets_id numeric(20),\n  lkp_zendesk_ticket_tags_id bigint\n);\n\ninsert into rdl.zendesk_ticket_tags_incremental_new\n(\n  zendesk_tickets_id,\n  lkp_zendesk_ticket_tags_id\n)\nselect m.ticket_id,\n       l.lkp_zendesk_ticket_tags_id\nfrom zendesk_ticket_tags_map m\njoin rdl.lkp_zendesk_ticket_tags_new l on m.tag_name = l.tag_name;\n\n\nalter table rdl.lkp_zendesk_ticket_tags\nrename to rdl.lkp_zendesk_ticket_tags_old;\n\nalter table rdl.lkp_zendesk_ticket_tags_new\nrename to rdl.lkp_zendesk_ticket_tags;\n\ndrop table rdl.lkp_zendesk_ticket_tags_old;\n\nalter table rdl.zendesk_ticket_tags_incremental\nrename to rdl.zendesk_ticket_tags_incremental_old;\n\nalter table rdl.zendesk_ticket_tags_incremental_new\nrename to rdl.zendesk_ticket_tags_incremental;\n\ndrop table rdl.zendesk_ticket_tags_incremental_old;\n\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2961579":{"id":2961579,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-314,"y":-65,"width":32,"height":32,"inputConnectorIDs":[2961574],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2961572],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"parse user custom json fields"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"drop table if exists rdl.zendesk_user_custom_fields_new;\ncreate table rdl.zendesk_user_custom_fields_new\n(\n  zendesk_user_custom_fields_id bigint identity (1,1),\n  user_id numeric(20),\n  field_name varchar(500),\n  field_value varchar(1000),\n  primary key (user_id)\n)\n;\n\ninsert into rdl.zendesk_user_custom_fields_new\n\t(user_id, field_name, field_value)\nselect\n--     USER_FIELDS,\n    ID as USER_ID,\n    KEY as FIELD_NAME,\n    VALUE as FIELD_VALLUE\nfrom prod_zendesk.zendesk_users_incremental,\n     lateral flatten(input => parse_json(USER_FIELDS), outer => true)\nwhere 1=1\n--  and id=321130584\n;\n\n\nalter table rdl.zendesk_user_custom_fields\nrename to rdl.zendesk_user_custom_fields_old;\n\nalter table rdl.zendesk_user_custom_fields_new\nrename to rdl.zendesk_user_custom_fields;\n\ndrop table rdl.zendesk_user_custom_fields_old;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{},"failureConnectors":{},"unconditionalConnectors":{"2961572":{"id":2961572,"sourceID":2961579,"targetID":2961573},"2961574":{"id":2961574,"sourceID":2961576,"targetID":2961579},"2961575":{"id":2961575,"sourceID":2961573,"targetID":2961578}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{},"grids":{}},"info":{"name":"SF_Zendesk_custom_field_parse_incremental","description":"","type":"ORCHESTRATION","tag":"ffba3a51-bf04-43c0-8797-a222be43779e"}}