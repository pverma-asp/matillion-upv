{"job":{"components":{"2956813":{"id":2956813,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1032749985,"x":320,"y":96,"width":32,"height":32,"inputConnectorIDs":[2956812],"outputSuccessConnectorIDs":[2956814],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"row count"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select count(*) as row_count\nfrom rdl.raw_galileo_customer_master_data\nwhere file_date = '${current_year}-${current_month}-${current_day}'\nand file_date = convert_timezone('America/Los_Angeles',current_timestamp)::date\n"}}}},"visible":true},"3":{"slot":3,"name":"Scalar Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"row_count"},"2":{"slot":2,"type":"STRING","value":"ROW_COUNT"}}}},"visible":true},"4":{"slot":4,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"5":{"slot":5,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"6":{"slot":6,"name":"Table Columns","elements":{},"visible":false},"7":{"slot":7,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"10":{"slot":10,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"100"}}}},"visible":false},"11":{"slot":11,"name":"Order By","elements":{},"visible":false},"12":{"slot":12,"name":"Sort","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Ascending"}}}},"visible":false},"13":{"slot":13,"name":"Filter Conditions","elements":{},"visible":false},"14":{"slot":14,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":false},"20":{"slot":20,"name":"Basic / Advanced","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Advanced"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2956832":{"id":2956832,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":208,"y":16,"width":32,"height":32,"inputConnectorIDs":[2956809],"outputSuccessConnectorIDs":[2956808],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Load file sections"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"copy ${staging_schema}.galileo_customer_master_file_header_staging(\"HEADER\", \"PROCESSOR_NAME\", \"REPORT_DATA_FEED_NAME\", \"FILE_TRANSMIT_DATE\", \"WORK_OF_DATE\")\nfrom '${file_staging_path}/galileo_customer_master_file_header.txt'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'HEADER:6,PROCESSOR_NAME:50,REPORT_DATA_FEED_NAME:50,FILE_TRANSMIT_DATE:8,WORK_OF_DATE:8'\nTRIMBLANKS\nEMPTYASNULL\nBLANKSASNULL\nCOMPUPDATE OFF\nSTATUPDATE OFF\nACCEPTINVCHARS AS '?'\n;\n\ncopy ${staging_schema}.galileo_customer_master_file_detail_staging(\"UNIQUE_PROGRAM_ID\", \"ISSUED_DATE\", \"ID\", \"ID_TYPE\", \"PRIMARY_CARDHOLDER_FIRST_NAME\", \"PRIMARY_CARDHOLDER_LAST_NAME\", \"ADDRESS_LINE_1\", \"ADDRESS_LINE_2\", \"CITY\", \"STATE\", \"ZIP_CODE\", \"PRIMARY_PHONE_NUMBER\", \"SECONDARY_PHONE_NUMBER\", \"STATUS\", \"CURRENT_BALANCE\", \"CURRENT_BALANCE_SIGN\", \"CREATED_DATE\", \"NEGATIVE_BALANCE_DATE\", \"NEGATIVE_BALANCE_FEE_AMOUNT\", \"RELOADABLE_INDICATOR\", \"GALILEO_ACCOUNT_ID\", \"TYPE_OF_ACCOUNT\", \"AVAILABLE_BALANCE\", \"AVAILABLE_BALANCE_SIGN\", \"EXTERNAL_ACCOUNT_NUMBER\", \"LAST_TRANS_DATE\", \"DATE_OF_BIRTH\", \"BILL_CYCLE_DAY\", \"LOCATION_ID\", \"AGENT_USER_ID\", \"ID_2\", \"ID_TYPE_2\", \"USER_DATA_1\", \"USER_DATA_2\")\nfrom '${file_staging_path}/galileo_customer_master_file_detail.txt'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'UNIQUE_PROGRAM_ID:15,ISSUED_DATE:8,ID:50,ID_TYPE:5,PRIMARY_CARDHOLDER_FIRST_NAME:20,PRIMARY_CARDHOLDER_LAST_NAME:20,ADDRESS_LINE_1:40,ADDRESS_LINE_2:40,CITY:20,STATE:2,ZIP_CODE:9,PRIMARY_PHONE_NUMBER:10,SECONDARY_PHONE_NUMBER:10,STATUS:5,CURRENT_BALANCE:13,CURRENT_BALANCE_SIGN:1,CREATED_DATE:8,NEGATIVE_BALANCE_DATE:8,NEGATIVE_BALANCE_FEE_AMOUNT:13,RELOADABLE_INDICATOR:1,GALILEO_ACCOUNT_ID:30,TYPE_OF_ACCOUNT:5,AVAILABLE_BALANCE:13,AVAILABLE_BALANCE_SIGN:1,EXTERNAL_ACCOUNT_NUMBER:30,LAST_TRANS_DATE:8,DATE_OF_BIRTH:8,BILL_CYCLE_DAY:2,LOCATION_ID:20,AGENT_USER_ID:20,ID_2:50,ID_TYPE_2:5,USER_DATA_1:50,USER_DATA_2:50'\nTRIMBLANKS\nEMPTYASNULL\nBLANKSASNULL\nCOMPUPDATE OFF\nSTATUPDATE OFF\nACCEPTINVCHARS AS '?'\n;\n\ncopy ${staging_schema}.galileo_customer_master_file_trailer_staging(\"TRAILER\", \"COUNT\")\nfrom '${file_staging_path}/galileo_customer_master_file_trailer.txt'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'TRAILER:7,COUNT:9'\nTRIMBLANKS\nEMPTYASNULL\nBLANKSASNULL\nCOMPUPDATE OFF\nSTATUPDATE OFF\nACCEPTINVCHARS AS '?'\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2956833":{"id":2956833,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":80,"y":16,"width":32,"height":32,"inputConnectorIDs":[2956815],"outputSuccessConnectorIDs":[2956809],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Unload file sections"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"unload ('select record_data from ${staging_schema}.${file_staging_table_name} where record_type = ''H''')\nto '${file_staging_path}/galileo_customer_master_file_header.txt'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nparallel off\nallowoverwrite\n;\n\nunload ('select record_data from ${staging_schema}.${file_staging_table_name} where record_type = ''D''')\nto '${file_staging_path}/galileo_customer_master_file_detail.txt'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nparallel off\nallowoverwrite\n;\n\nunload ('select record_data from ${staging_schema}.${file_staging_table_name} where record_type = ''T''')\nto '${file_staging_path}/galileo_customer_master_file_trailer.txt'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nparallel off\nallowoverwrite\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2956834":{"id":2956834,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":237373210,"x":-368,"y":16,"width":32,"height":32,"inputConnectorIDs":[2956805],"outputSuccessConnectorIDs":[2956810],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Truncate Table 0"}}}},"visible":true},"3":{"slot":3,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"4":{"slot":4,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"5":{"slot":5,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"GALILEO_CUSTOMER_MASTER_FILE_DETAIL_STAGING"}}}},"visible":true},"6":{"slot":6,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2956835":{"id":2956835,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-656,"y":16,"width":32,"height":32,"inputConnectorIDs":[2956806],"outputSuccessConnectorIDs":[2956811],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Initialize Vars"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\n\nl_s3_file_path = '{0}/{1}'.format(current_year, int(current_month))\n\ncontext.updateVariable(\"s3_file_path\", l_s3_file_path)\n\nprint(l_s3_file_path)\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2956836":{"id":2956836,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":773867971,"x":-64,"y":16,"width":32,"height":32,"inputConnectorIDs":[2956804],"outputSuccessConnectorIDs":[2956815],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Load file to staging table"}}}},"visible":true},"4":{"slot":4,"name":"S3 Object Prefix","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${file_staging_output_path}/${s3_file_path}/"}}}},"visible":true},"5":{"slot":5,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"6":{"slot":6,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"7":{"slot":7,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ETL"}}}},"visible":true},"8":{"slot":8,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${file_staging_table_name}"}}}},"visible":true},"9":{"slot":9,"name":"Load Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"RECORD_TYPE"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"UNIQUE_PROGRAM_ID"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"ISSUED_DATE"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"ID"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"ID_TYPE"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"PRIMARY_CARDHOLDER_FIRST_NAME"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"PRIMARY_CARDHOLDER_LAST_NAME"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"ADDRESS_LINE_1"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"ADDRESS_LINE_2"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"CITY"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"STATE"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"ZIP_CODE"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"PRIMARY_PHONE_NUMBER"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"SECONDARY_PHONE_NUMBER"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"STATUS"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"CURRENT_BALANCE"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"CURRENT_BALANCE_SIGN"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"CREATED_DATE"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"NEGATIVE_BALANCE_DATE"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"NEGATIVE_BALANCE_FEE_AMOUNT"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"RELOADABLE_INDICATOR"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"GALILEO_ACCOUNT_ID"}}},"23":{"slot":23,"values":{"1":{"slot":1,"type":"STRING","value":"TYPE_OF_ACCOUNT"}}},"24":{"slot":24,"values":{"1":{"slot":1,"type":"STRING","value":"AVAILABLE_BALANCE"}}},"25":{"slot":25,"values":{"1":{"slot":1,"type":"STRING","value":"AVAILABLE_BALANCE_SIGN"}}},"26":{"slot":26,"values":{"1":{"slot":1,"type":"STRING","value":"EXTERNAL_ACCOUNT_NUMBER"}}},"27":{"slot":27,"values":{"1":{"slot":1,"type":"STRING","value":"LAST_TRANS_DATE"}}},"28":{"slot":28,"values":{"1":{"slot":1,"type":"STRING","value":"DATE_OF_BIRTH"}}},"29":{"slot":29,"values":{"1":{"slot":1,"type":"STRING","value":"BILL_CYCLE_DAY"}}},"30":{"slot":30,"values":{"1":{"slot":1,"type":"STRING","value":"LOCATION_ID"}}},"31":{"slot":31,"values":{"1":{"slot":1,"type":"STRING","value":"AGENT_USER_ID"}}},"32":{"slot":32,"values":{"1":{"slot":1,"type":"STRING","value":"ID_2"}}},"33":{"slot":33,"values":{"1":{"slot":1,"type":"STRING","value":"ID_TYPE_2"}}},"34":{"slot":34,"values":{"1":{"slot":1,"type":"STRING","value":"USER_DATA_1"}}},"35":{"slot":35,"values":{"1":{"slot":1,"type":"STRING","value":"USER_DATA_2"}}}},"visible":true},"10":{"slot":10,"name":"Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Custom]"}}}},"visible":true},"11":{"slot":11,"name":"File Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CSV"}}}},"visible":true},"12":{"slot":12,"name":"Compression","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AUTO"}}}},"visible":true},"20":{"slot":20,"name":"Record Delimiter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"CHAR","value":""}}}},"visible":true},"21":{"slot":21,"name":"Field Delimiter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"CHAR","value":""}}}},"visible":true},"22":{"slot":22,"name":"Skip Header","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":""}}}},"visible":true},"23":{"slot":23,"name":"Date Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"24":{"slot":24,"name":"Time Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"25":{"slot":25,"name":"Timestamp Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"26":{"slot":26,"name":"","elements":{},"visible":false},"27":{"slot":27,"name":"Escape","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"28":{"slot":28,"name":"Escape Unenclosed Field","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"CHAR","value":""}}}},"visible":true},"29":{"slot":29,"name":"Trim Space","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":true},"30":{"slot":30,"name":"Field Optionally Enclosed","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\""}}}},"visible":true},"31":{"slot":31,"name":"Null If","elements":{},"visible":true},"32":{"slot":32,"name":"Error On Column Count Mismatch","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":true},"33":{"slot":33,"name":"Empty Field as Null","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":true},"34":{"slot":34,"name":"Encoding Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"35":{"slot":35,"name":"Skip Blank Lines","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":true},"36":{"slot":36,"name":"Replace Invalid Characters","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":true},"40":{"slot":40,"name":"Enable Octal","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"41":{"slot":41,"name":"Allow Duplicates","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"42":{"slot":42,"name":"Strip Outer Array","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"43":{"slot":43,"name":"Strip Null Values","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"44":{"slot":44,"name":"Ignore UTF8 Errors","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"45":{"slot":45,"name":"Nest Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"46":{"slot":46,"name":"Null If","elements":{},"visible":false},"47":{"slot":47,"name":"Trim Space","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"50":{"slot":50,"name":"Null If","elements":{},"visible":false},"51":{"slot":51,"name":"Trim Space","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"60":{"slot":60,"name":"Ignore UTF8 Errors","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"61":{"slot":61,"name":"Preserve Space","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"62":{"slot":62,"name":"Strip Outer Element","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"63":{"slot":63,"name":"Disable Snowflake Data","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"64":{"slot":64,"name":"Disable Auto Convert","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"66":{"slot":66,"name":"Null If","elements":{},"visible":false},"67":{"slot":67,"name":"Trim Space","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"70":{"slot":70,"name":"Null If","elements":{},"visible":false},"71":{"slot":71,"name":"Trim Space","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"120":{"slot":120,"name":"On Error","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Abort Statement"}}}},"visible":true},"121":{"slot":121,"name":"n","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":""}}}},"visible":false},"122":{"slot":122,"name":"Size Limit (B)","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":""}}}},"visible":true},"123":{"slot":123,"name":"Purge Files","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":true},"124":{"slot":124,"name":"Truncate Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":true},"125":{"slot":125,"name":"Force Load","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":true},"126":{"slot":126,"name":"Match By Column Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"None"}}}},"visible":false},"140":{"slot":140,"name":"Encryption","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"None"}}}},"visible":true},"141":{"slot":141,"name":"Master Key","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"142":{"slot":142,"name":"KMS Key Id","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"143":{"slot":143,"name":"Authentication","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Credentials"}}}},"visible":true},"144":{"slot":144,"name":"Storage Integration","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"200":{"slot":200,"name":"Stage","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Custom]"}}}},"visible":true},"201":{"slot":201,"name":"Pattern","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":".*customermasterfile_${current_year}${current_month}${current_day}[.]csv"}}}},"visible":true},"203":{"slot":203,"name":"Metadata Fields","elements":{},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2956837":{"id":2956837,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-528,"y":16,"width":32,"height":32,"inputConnectorIDs":[2956811],"outputSuccessConnectorIDs":[2956805],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Initialize Vars - test"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Udating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\nimport datetime\n\nl_current_year = datetime.date.today().strftime('%Y')\nl_current_month = datetime.date.today().strftime('%m')\nl_current_day = datetime.date.today().strftime('%d')\n\nl_s3_file_path = '{0}/{1}'.format(l_current_year, l_current_month)\nl_s3_filename = 'interest_accrual_{0}{1}{2}.csv'.format(l_current_year, l_current_month, l_current_day)\n\ncontext.updateVariable(\"s3_file_path\", l_s3_file_path)\ncontext.updateVariable(\"s3_filename\", l_s3_filename)\n\n#print(l_s3_file_path)\n#print(l_s3_filename)\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2956838":{"id":2956838,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-768,"y":16,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2956806],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2956839":{"id":2956839,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":320,"y":16,"width":32,"height":32,"inputConnectorIDs":[2956808],"outputSuccessConnectorIDs":[2956812],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Process file data"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"delete from rdl.raw_galileo_customer_master_data\nwhere file_date = '${current_year}-${current_month}-${current_day}'\n;\n\ninsert into rdl.raw_galileo_customer_master_data(\"file_date\", \"record_type\", \"unique_program_id\", \"issued_date\", \"id\", \"id_type\", \"primary_cardholder_first_name\", \"primary_cardholder_last_name\", \"address_line_1\", \"address_line_2\", \"city\", \"state\", \"zip_code\", \"primary_phone_number\", \"secondary_phone_number\", \"status\", \"current_balance\", \"current_balance_sign\", \"created_date\", \"negative_balance_date\", \"negative_balance_fee_amount\", \"reloadable_indicator\", \"galileo_account_id\", \"type_of_account\", \"available_balance\", \"available_balance_sign\", \"external_account_number\", \"last_trans_date\", \"date_of_birth\", \"bill_cycle_day\", \"location_id\", \"agent_user_id\", \"id_2\", \"id_type_2\", \"user_data_1\", \"user_data_2\")\nselect '${current_year}-${current_month}-${current_day}', \"record_type\", \"unique_program_id\", \"issued_date\", \"id\", \"id_type\", \"primary_cardholder_first_name\", \"primary_cardholder_last_name\", \"address_line_1\", \"address_line_2\", \"city\", \"state\", \"zip_code\", \"primary_phone_number\", \"secondary_phone_number\", \"status\", \"current_balance\", \"current_balance_sign\", \"created_date\", \"negative_balance_date\", \"negative_balance_fee_amount\", \"reloadable_indicator\", \"galileo_account_id\", \"type_of_account\", \"available_balance\", \"available_balance_sign\", \"external_account_number\", \"last_trans_date\", \"date_of_birth\", \"bill_cycle_day\", \"location_id\", \"agent_user_id\", \"id_2\", \"id_type_2\", \"user_data_1\", \"user_data_2\"\nfrom etl.galileo_customer_master_file_detail_staging\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2956848":{"id":2956848,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"CONDITIONAL","executionHint":"FLOW","implementationID":-1357378929,"x":320,"y":176,"width":32,"height":32,"inputConnectorIDs":[2956814],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[2956807],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"if row_count > 0"}}}},"visible":true},"2":{"slot":2,"name":"Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Simple"}}}},"visible":true},"3":{"slot":3,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"row_count"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Greater than"},"4":{"slot":4,"type":"STRING","value":"0"}}}},"visible":true},"4":{"slot":4,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":true},"5":{"slot":5,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2956849":{"id":2956849,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-224,"y":16,"width":32,"height":32,"inputConnectorIDs":[2956810],"outputSuccessConnectorIDs":[2956804],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"convert fixed width file to csv"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\nimport boto3\nimport time\n#python function to call lambda to encrypt s3 file to send to galileo\n\nbody = json.dumps(dict(source_file='s3://aspiration-galileo-prod-sftp-all/${s3_file_path}/customermasterfile_${current_year}${current_month}${current_day}.txt',\n                       target_file='${file_staging_output_path}/${s3_file_path}/customermasterfile_${current_year}${current_month}${current_day}.csv',\n                       column_format='1,15,8,50,5,20,20,40,40,20,2,9,10,10,5,13,1,8,8,13,1,30,5,13,1,30,8,8,2,20,20,50,5,50,50',\n                       ignore_header='1',\n                       ignore_trailer='1',\n                       trim_blanks=True\n                      ))\n\ndef run_lambda():\n    client = boto3.client('lambda', region_name='us-west-2')\n    response = client.invoke(\n    FunctionName='${lambda_arn}',\n    InvocationType='Event',\n    LogType='Tail',\n    Payload=body\n    )\n\n\nrun_lambda()\n\n#delay before next step so file is done with conversion before attempting to import it\ntime.sleep(30)\n\n#{\n#   \"operation\": \"enc\",\n#   \"file\": \"s3://aspiration-datateam/dump/szhang/btrans_584_20200226_005.txt\",\n#   \"encrypted_file_path\": \"s3://aspiration-datateam/dump/szhang/\",\n#   \"gpg_key\": \"galileo_public_key\",\n#   \"extension\": \"gpg\"\n# }\n\n#{\n#   \"source_file\": \"s3://aspiration-datateam/dump/lnguyen/test_folder/accountcard_20200527.txt\",\n#   \"target_file\": \"s3://aspiration-datateam/dump/lnguyen/test_folder/accountcard_20200527.csv\",\n#   \"column_format\": \"1,15,15,15,30,12,8,5,30,16,10\",\n#   \"ignore_header\": 1,\n#   \"ignore_trailer\": 1,\n#   \"trim_blanks\": true\n# }"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2956850":{"id":2956850,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":320,"y":272,"width":32,"height":32,"inputConnectorIDs":[2956807],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"etl.daily_balances"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"daily_balances"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2956804":{"id":2956804,"sourceID":2956849,"targetID":2956836},"2956805":{"id":2956805,"sourceID":2956837,"targetID":2956834},"2956808":{"id":2956808,"sourceID":2956832,"targetID":2956839},"2956809":{"id":2956809,"sourceID":2956833,"targetID":2956832},"2956810":{"id":2956810,"sourceID":2956834,"targetID":2956849},"2956811":{"id":2956811,"sourceID":2956835,"targetID":2956837},"2956812":{"id":2956812,"sourceID":2956839,"targetID":2956813},"2956814":{"id":2956814,"sourceID":2956813,"targetID":2956848},"2956815":{"id":2956815,"sourceID":2956836,"targetID":2956833}},"failureConnectors":{},"unconditionalConnectors":{"2956806":{"id":2956806,"sourceID":2956838,"targetID":2956835}},"trueConnectors":{"2956807":{"id":2956807,"sourceID":2956848,"targetID":2956850}},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{"2956842":{"id":2956842,"x":1,"y":247,"width":250,"height":58,"text":"only run etl.daily_balances script if the file imported is for the current day","colour":"e6e63c"}},"variables":{"current_day":{"definition":{"name":"current_day","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"13"},"current_month":{"definition":{"name":"current_month","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"07"},"current_year":{"definition":{"name":"current_year","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"2022"},"file_staging_output_path":{"definition":{"name":"file_staging_output_path","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"s3://aspiration-etl-staging/file_processing/stage_files"},"file_staging_path":{"definition":{"name":"file_staging_path","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"s3://aspiration-etl-staging/file_processing/galileo_customer_master_file"},"file_staging_table_name":{"definition":{"name":"file_staging_table_name","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"galileo_customer_master_file_detail_staging"},"lambda_arn":{"definition":{"name":"lambda_arn","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"arn:aws:lambda:us-west-2:332894900161:function:data-python-fixedwidth-converter"},"row_count":{"definition":{"name":"row_count","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"0"},"s3_file_path":{"definition":{"name":"s3_file_path","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"2022/7"},"s3_filename":{"definition":{"name":"s3_filename","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"customermasterfile_20220713.txt"}},"grids":{"file_dates":{"definition":{"name":"file_dates","scope":"BRANCH","definitions":[{"name":"file_date_year","type":"TEXT"},{"name":"file_date_month","type":"TEXT"},{"name":"file_date_day","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[]},"table_list":{"definition":{"name":"table_list","scope":"BRANCH","definitions":[{"name":"table_name","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[{"values":["galileo_customer_master_file_staging"]},{"values":["galileo_customer_master_file_header_staging"]},{"values":["galileo_customer_master_file_detail_staging"]},{"values":["galileo_customer_master_file_trailer_staging"]}]}}},"info":{"name":"galileo_customer_master_file_parser_day","description":"","type":"ORCHESTRATION","tag":"0f024162-7493-486f-9c1b-a3dbf7fe1756"}}