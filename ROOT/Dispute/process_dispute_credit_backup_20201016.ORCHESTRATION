{"job":{"components":{"2964688":{"id":2964688,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":576,"y":176,"width":32,"height":32,"inputConnectorIDs":[2964737],"outputSuccessConnectorIDs":[2964747],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"load main table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SET TIMEZONE = 'America/Los_Angeles';\n\nINSERT INTO rdl.dispute_credit (create_timestamp, prn, credit_amount, external_user_id, status, pyc_flag)\nSELECT\n  create_timestamp,\n  prn,\n  replace(credit_amount, '\\$', '')::numeric(35,4),\n  external_user_id,\n  'new',\n  pyc_flag\nFROM etl.dispute_credit_staging\nWHERE (create_timestamp, prn) not in (\n  SELECT\n  \tcreate_timestamp, prn\n  FROM rdl.dispute_credit\n)\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964689":{"id":2964689,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"CONDITIONAL","executionHint":"FLOW","implementationID":-1357378929,"x":448,"y":176,"width":32,"height":32,"inputConnectorIDs":[2964743],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[2964737],"outputFalseConnectorIDs":[2964736],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"If record count > 0"}}}},"visible":true},"2":{"slot":2,"name":"Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Simple"}}}},"visible":true},"3":{"slot":3,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"record_count"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Greater than"},"4":{"slot":4,"type":"STRING","value":"0"}}}},"visible":true},"4":{"slot":4,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":true},"5":{"slot":5,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964690":{"id":2964690,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":608,"y":256,"width":32,"height":32,"inputConnectorIDs":[2964747],"outputSuccessConnectorIDs":[2964740],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"create galileo btrans table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"delete from etl.galileo_transaction_batch_header_jchen\nwhere filename='${galileo_filename}'\n;\n\ninsert into etl.galileo_transaction_batch_header_jchen (recordtype, header, clientid, programid, filename, filetransmitdate)\nvalues ('H', 'HEADER', '454', '584', '${galileo_filename}', '${galileo_file_transmit_date}')\n;\n\n\n\ndelete from etl.galileo_transaction_batch_detail_jchen\nwhere filename='${galileo_filename}'\n;\n\ninsert into etl.galileo_transaction_batch_detail_jchen(filename, recordtype,\nrecordnumber, accountidtype, accountidentifier, transactiontype,\ntransactionsubtype, transactionamount, transactiondescription, transactionidentifier, external_id)\nSELECT\n     '${galileo_filename}' as filename\n     , 'D' as recordtype\n     , row_number() over(order by prn) as recordnumber\n     , 'R' as accountidtype\n     ,  prn as accountidentifier\n     , 'A' as transactiontype\n     , 'tc' as transactionsubtype\n     ,  (-credit_amount)::numeric(18,2)::varchar(100) as transactionamount\n     , 'Dispute Credit' as transactiondescription\n     , 'DC_${galileo_transaction_identifier_date}-' || lpad(row_number() over(order by prn), 5, '0') as transactionidentifier\n     , id\nFROM rdl.dispute_credit\nWHERE 1=1\n  AND status='new'\nORDER BY create_timestamp ASC\n;\n\n\ndelete from etl.galileo_transaction_batch_trailer_jchen\nwhere filename='${galileo_filename}'\n;\n\ninsert into etl.galileo_transaction_batch_trailer_jchen (filename, recordtype, trailer, count)\nSELECT\n    '${galileo_filename}',\n    'T',\n    'TRAILER',\n    count(1) as cnt\nfrom etl.galileo_transaction_batch_detail_jchen where filename='${galileo_filename}'\n;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964691":{"id":2964691,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":448,"y":272,"width":32,"height":32,"inputConnectorIDs":[2964736],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Success - no records to process"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964694":{"id":2964694,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":0,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2964738,2964739],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964695":{"id":2964695,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":112,"y":0,"width":32,"height":32,"inputConnectorIDs":[2964738],"outputSuccessConnectorIDs":[2964741],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"set date variables"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\nfrom datetime import datetime\nfrom datetime import timedelta\nfrom dateutil.relativedelta import relativedelta\nfrom pytz import timezone\n\nprint 'current time in PST: ', datetime.now(timezone('US/Pacific'))\n\ntoday=datetime.now(timezone('US/Pacific')).strftime(\"%Y-%m-%d\")\nprint 'today: ', today\n\n#pwif_month_date = datetime.strptime(pwif_month, '%Y-%m-%d')\n#print 'pwif_month_date: ', pwif_month_date\n\ngalileo_filename_date = datetime.now(timezone('US/Pacific')).strftime('%Y%m%d')\ngalileo_filename = 'btrans_584_' + galileo_filename_date + '_dc027.txt'\ngalileo_transaction_identifier_date = datetime.now(timezone('US/Pacific')).strftime('%y%m%d')\ngalileo_file_transmit_date = datetime.now(timezone('US/Pacific')).strftime('%m%d%Y')\n\nprint 'galileo_filename_date: ', galileo_filename_date\nprint 'galileo_filename: ', galileo_filename\nprint 'galileo_transaction_identifier_date: ', galileo_transaction_identifier_date\nprint 'galileo_file_transmit_date: ', galileo_file_transmit_date\n\n\ncontext.updateVariable('galileo_filename_date', galileo_filename_date)\ncontext.updateVariable('galileo_filename', galileo_filename)\ncontext.updateVariable('galileo_transaction_identifier_date', galileo_transaction_identifier_date)\ncontext.updateVariable('galileo_file_transmit_date', galileo_file_transmit_date)\n\n\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964744":{"id":2964744,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":752,"y":272,"width":32,"height":32,"inputConnectorIDs":[2964740],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Send_btrans_File_to_Galileo_jchen 0"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Send_btrans_File_to_Galileo_jchen"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"galileo_filename"},"2":{"slot":2,"type":"STRING","value":"${galileo_filename}"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964745":{"id":2964745,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":448,"y":96,"width":32,"height":32,"inputConnectorIDs":[2964742],"outputSuccessConnectorIDs":[2964743],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"set record count variable"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\n\nprint context.getGridVariable('v_dispute_credit_grid_variables')[0][0]\n\ncontext.updateVariable('record_count', context.getGridVariable('v_dispute_credit_grid_variables')[0][0])\n\nprint 'record_count:', record_count\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964748":{"id":2964748,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":16,"y":144,"width":32,"height":32,"inputConnectorIDs":[2964739],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"table creation"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DROP TABLE if exists rdl.dispute_credit;\n\ncreate table rdl.dispute_credit\n(\n\tid integer identity(15000, 1),\n\tcreate_timestamp varchar(255),\n\tprn varchar(255),\n\tcredit_amount numeric(35,4),\n\texternal_user_id varchar(255),\n\tstatus varchar(255),\n\tetl_load_date timestamp_tz default current_timestamp not null,\n\tcreated_at timestamp_tz default current_timestamp not null,\n\tupdated_at timestamp_tz default current_timestamp not null,\n\tpyc_flag varchar(255)\n);\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964749":{"id":2964749,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":208,"y":96,"width":32,"height":32,"inputConnectorIDs":[2964741],"outputSuccessConnectorIDs":[2964746],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"load staging table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DROP TABLE if exists etl.dispute_credit_staging;\n\nCREATE TABLE if not exists etl.dispute_credit_staging (\n  create_timestamp varchar(255),\n  prn varchar(255),\n  credit_amount varchar(255),\n  pyc_flag varchar(255),\n  external_user_id varchar(255)\n)\n;\n\ncopy into etl.dispute_credit_staging\n\tfrom @public.datateam/dump/jchen/dispute/UBMs_for_MailMerge_${galileo_filename_date}.csv\nfile_format = (type ='CSV'\n    field_DELIMITER = ','\n    ESCAPE = '\\\\'\n    SKIP_HEADER = 2\n    )\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964750":{"id":2964750,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":1155583855,"x":320,"y":96,"width":32,"height":32,"inputConnectorIDs":[2964746],"outputSuccessConnectorIDs":[2964742],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"query record counts"}}}},"visible":true},"2":{"slot":2,"name":"Basic/Advanced","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Advanced"}}}},"visible":true},"3":{"slot":3,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ADW"}}}},"visible":true},"4":{"slot":4,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ZENDESK_TICKET_METRIC_EVENTS_INCREMENTAL"}}}},"visible":false},"6":{"slot":6,"name":"Table Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"TIME"}}}},"visible":false},"7":{"slot":7,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select count(1) as cnt\nfrom etl.dispute_credit_staging"}}}},"visible":true},"8":{"slot":8,"name":"Grid Variable","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"v_dispute_credit_grid_variables"}}}},"visible":true},"9":{"slot":9,"name":"Grid Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CNT"}}}},"visible":true},"10":{"slot":10,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"1"}}}},"visible":false},"11":{"slot":11,"name":"Order By","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"TIME"}}}},"visible":false},"12":{"slot":12,"name":"Sort","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Descending"}}}},"visible":false},"20":{"slot":20,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"PROD_ZENDESK"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2964740":{"id":2964740,"sourceID":2964690,"targetID":2964744},"2964741":{"id":2964741,"sourceID":2964695,"targetID":2964749},"2964742":{"id":2964742,"sourceID":2964750,"targetID":2964745},"2964743":{"id":2964743,"sourceID":2964745,"targetID":2964689},"2964746":{"id":2964746,"sourceID":2964749,"targetID":2964750},"2964747":{"id":2964747,"sourceID":2964688,"targetID":2964690}},"failureConnectors":{},"unconditionalConnectors":{"2964738":{"id":2964738,"sourceID":2964694,"targetID":2964695},"2964739":{"id":2964739,"sourceID":2964694,"targetID":2964748}},"trueConnectors":{"2964737":{"id":2964737,"sourceID":2964689,"targetID":2964688}},"falseConnectors":{"2964736":{"id":2964736,"sourceID":2964689,"targetID":2964691}},"iterationConnectors":{},"noteConnectors":{},"notes":{"2964692":{"id":2964692,"x":383,"y":-29,"width":250,"height":58,"text":"todo:\n- change schedule to run at 16:45\n- enable send file to galileo","colour":"e6e63c"}},"variables":{"galileo_file_transmit_date":{"definition":{"name":"galileo_file_transmit_date","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"01012020"},"galileo_filename":{"definition":{"name":"galileo_filename","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"btrans_584_20200101_dc027.txt"},"galileo_filename_date":{"definition":{"name":"galileo_filename_date","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"20200101"},"galileo_transaction_identifier_date":{"definition":{"name":"galileo_transaction_identifier_date","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"200101"},"record_count":{"definition":{"name":"record_count","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"0"}},"grids":{"v_dispute_credit_grid_variables":{"definition":{"name":"v_dispute_credit_grid_variables","scope":"BRANCH","definitions":[{"name":"record_count","type":"DECIMAL"}],"description":"","visibility":"PUBLIC"},"values":[]}}},"info":{"name":"process_dispute_credit_backup_20201016","description":"","type":"ORCHESTRATION","tag":"d7aa47b8-cc97-45df-97f3-981a5d01408b"}}