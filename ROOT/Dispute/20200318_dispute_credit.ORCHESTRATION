{"job":{"components":{"2964612":{"id":2964612,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":128,"y":144,"width":32,"height":32,"inputConnectorIDs":[2964609],"outputSuccessConnectorIDs":[2964614],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"load main table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"set timezone to 'America/Los_Angeles';\n\nINSERT INTO rdl.dispute_credit (create_timestamp, prn, credit_amount, external_user_id, status)\nSELECT\n  create_timestamp,\n  prn,\n  replace(credit_amount, '\\$', '')::numeric(35,4),\n  external_user_id,\n  'new'\nFROM etl.dispute_credit_staging\nWHERE (create_timestamp, prn) not in (\n  SELECT\n  \tcreate_timestamp, prn\n  FROM rdl.dispute_credit\n)\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964613":{"id":2964613,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-96,"y":160,"width":32,"height":32,"inputConnectorIDs":[2964611],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"table creation"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DROP TABLE if exists rdl.dispute_credit;\n\ncreate table rdl.dispute_credit\n(\n\tid integer identity(1,1),\n\tcreate_timestamp varchar(255),\n\tprn varchar(255),\n\tcredit_amount numeric(35,4),\n\texternal_user_id varchar(255),\n\tstatus varchar(255),\n\tetl_load_date timestamp_tz default current_timestamp not null,\n\tcreated_at timestamp_tz default current_timestamp not null,\n\tupdated_at timestamp_tz default current_timestamp not null,\n\tpyc_flag varchar(255)\n);\n\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964616":{"id":2964616,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":128,"y":64,"width":32,"height":32,"inputConnectorIDs":[2964608],"outputSuccessConnectorIDs":[2964609],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"load staging table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DROP TABLE if exists etl.dispute_credit_staging;\n\nCREATE TABLE if not exists etl.dispute_credit_staging (\n  create_timestamp varchar(255),\n  prn varchar(255),\n  credit_amount varchar(255),\n  filler_1 varchar(255),\n  external_user_id varchar(255)\n)\n;\n\n-- truncate etl.dispute_credit_staging;\n\ncopy etl.dispute_credit_staging\nfrom 's3://aspiration-datateam/dump/jchen/dispute/UBMs_for_MailMerge_20200318.csv'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\ndelimiter ','\nIGNOREHEADER 2\nremovequotes\n;\n\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964617":{"id":2964617,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":0,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2964608,2964611],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964618":{"id":2964618,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":128,"y":224,"width":32,"height":32,"inputConnectorIDs":[2964614],"outputSuccessConnectorIDs":[2964615],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"create galileo btrans table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"UPDATE etl.galileo_transaction_batch_header\nSET filename = 'btrans_584_20200318_027.txt.gpg',\nfiletransmitdate = '03182020'\nWHERE recordtype = 'H'\n;\n\n\ndelete from etl.galileo_transaction_batch_detail;\ninsert into etl.galileo_transaction_batch_detail(recordtype,\nrecordnumber, accountidtype, accountidentifier, transactiontype,\ntransactionsubtype, transactionamount, transactiondescription, transactionidentifier)\nSELECT\n    'D' as recordtype\n     , row_number() over(order by prn) as recordnumber\n     , 'R' as accountidtype\n     ,  prn as accountidentifier\n     , 'A' as transactiontype\n     , 'tc' as transactionsubtype\n     ,  (-credit_amount)::numeric(18,2)::varchar(100) as transactionamount\n     , 'Dispute Credit' as transactiondescription\n     , 'DC_2003018-' || lpad(row_number() over(order by prn), 5, '0') as transactionidentifier\nFROM rdl.dispute_credit\nWHERE 1=1\n  AND status='new'\nORDER BY create_timestamp ASC\n;\n\n\nUPDATE etl.galileo_transaction_batch_trailer\nSET \"count\" = (SELECT count(1) from etl.galileo_transaction_batch_detail)\nWHERE recordtype = 'T'\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964619":{"id":2964619,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":128,"y":304,"width":32,"height":32,"inputConnectorIDs":[2964615],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Copy of create galileo file"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"drop table if exists etl.galileo_file_temp_jchen;\ncreate table etl.galileo_file_temp_jchen (\n  row_no BIGINT,\n  row    varchar(20000)\n)\n;\n\ninsert into etl.galileo_file_temp_jchen (row_no, row)\nselect\n  0,\n  recordtype ||\n  header ||\n  rpad(clientid, 10, ' ') ||\n  rpad(programid, 10, ' ') ||\n  rpad((filename), 50, ' ') ||\n  filetransmitdate\nfrom etl.galileo_transaction_batch_header\n;\n\n\ninsert into etl.galileo_file_temp_jchen (row_no, row)\nselect recordnumber::BIGINT,\n       'D' ||\n       rpad(recordnumber, 6, ' ') ||\n       'R' ||\n       rpad(accountidentifier,50,' ') ||\n       lpad('',21,' ') ||\n       transactiontype ||\n       rpad(transactionsubtype, 3, ' ') ||\n       rpad(transactionamount,13,' ') ||\n       rpad((transactiondescription),40,' ') ||\n       rpad((transactionidentifier),20,' ')\nfrom etl.galileo_transaction_batch_detail\n;\n\ninsert into etl.galileo_file_temp_jchen (row_no, row)\nselect 10000000,\n       recordtype ||\n       trailer || rpad(count, 6,' ')\nfrom etl.galileo_transaction_batch_trailer\n;\n\n\nUNLOAD ('SELECT row FROM etl.galileo_file_temp_jchen ORDER BY row_no') \nTO 's3://aspiration-datateam/dump/jchen/galileo/btrans_584_20200318_027.txt'\niam_role '${redshift_role}'\nPARALLEL OFF \nENCRYPTED   \nALLOWOVERWRITE; \n\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2964609":{"id":2964609,"sourceID":2964616,"targetID":2964612},"2964614":{"id":2964614,"sourceID":2964612,"targetID":2964618},"2964615":{"id":2964615,"sourceID":2964618,"targetID":2964619}},"failureConnectors":{},"unconditionalConnectors":{"2964608":{"id":2964608,"sourceID":2964617,"targetID":2964616},"2964611":{"id":2964611,"sourceID":2964617,"targetID":2964613}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{},"grids":{}},"info":{"name":"20200318_dispute_credit","description":"","type":"ORCHESTRATION","tag":"5df6778b-9f94-41d0-bf04-e85634bdb6cb"}}