{"job":{"components":{"2962418":{"id":2962418,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-640,"y":-144,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2962478],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962476":{"id":2962476,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":773867971,"x":-432,"y":-144,"width":32,"height":32,"inputConnectorIDs":[2962479],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Copy of S3 Load 0"}}}},"visible":true},"4":{"slot":4,"name":"S3 Object Prefix","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"compliance_businesses"}}}},"visible":true},"7":{"slot":7,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"8":{"slot":8,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"compliance_businesses_staging"}}}},"visible":true},"9":{"slot":9,"name":"Load Columns","elements":{},"visible":true},"23":{"slot":23,"name":"Date Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":true},"24":{"slot":24,"name":"Time Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":true},"26":{"slot":26,"name":"","elements":{},"visible":false},"27":{"slot":27,"name":"Escape","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962477":{"id":2962477,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":773867971,"x":-544,"y":-141,"width":32,"height":32,"inputConnectorIDs":[2962478],"outputSuccessConnectorIDs":[2962479],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"S3 Load 0"}}}},"visible":true},"4":{"slot":4,"name":"S3 Object Prefix","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"compliance_customers"}}}},"visible":true},"7":{"slot":7,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"8":{"slot":8,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"compliance_customers_staging"}}}},"visible":true},"9":{"slot":9,"name":"Load Columns","elements":{},"visible":true},"23":{"slot":23,"name":"Date Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":true},"24":{"slot":24,"name":"Time Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":true},"26":{"slot":26,"name":"","elements":{},"visible":false},"27":{"slot":27,"name":"Escape","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2962479":{"id":2962479,"sourceID":2962477,"targetID":2962476}},"failureConnectors":{},"unconditionalConnectors":{"2962478":{"id":2962478,"sourceID":2962418,"targetID":2962477}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{"2962416":{"id":2962416,"x":-363,"y":-584,"width":314,"height":158,"text":"drop table if exists etl.compliance_businesses_staging;\ncreate table etl.compliance_businesses_staging \n(\ntracking_number varchar(1024),\nbusiness_name varchar(1024),\ndba_name varchar(1024),\nnumber varchar(1024),\nnumber_type varchar(1024),\nincorporated varchar(1024),\nstreet varchar(1024),\ncity varchar(1024),\nstate varchar(1024),\nzip varchar(1024),\ncountry varchar(1024),\nphone varchar(1024)\n)\n;\n\ndrop table if exists etl.compliance_customers_staging;\ncreate table etl.compliance_customers_staging \n(\ntracking_number varchar(1024),\nlast_name varchar(1024),\nfirst_name varchar(1024),\nmiddle_name varchar(1024),\nsuffix varchar(1024),\nalias_last_name varchar(1024),\nalias_first_name varchar(1024),\nalias_middle_name varchar(1024),\nalias_suffix varchar(1024),\nnumber varchar(1024),\nnumber_type varchar(1024),\ndob varchar(1024),\nstreet varchar(1024),\ncity varchar(1024),\nstate varchar(1024),\nzip varchar(1024),\ncountry varchar(1024),\nphone varchar(1024)\n)\n;\n","colour":"e6e63c"},"2962419":{"id":2962419,"x":-362,"y":-396,"width":367,"height":162,"text":"-------- customers check\n\n-- full match (ssn match)\nselect top 100 *\nfrom etl.compliance_customers_staging t\ninner join bi.dt_users dtu on (dtu.ssn = t.number)\ninner join bi.dt_accounts dta on (dta.user_id = dtu.user_id)\nwhere 1=1\n\tand dta.galileo_id is not null\n\tand t.number_type ilike '%ssn%'\n;\n\n-- partial match (lastname)\nselect top 100 *\nfrom etl.compliance_customers_staging t\ninner join bi.dt_users dtu on (dtu.last_name = t.last_name or dtu.last_name = t.alias_last_name)\ninner join bi.dt_accounts dta on (dta.user_id = dtu.user_id)\nwhere 1=1\n\tand dta.galileo_id is not null\n;\n\n-- partial match (address)\nselect top 100 \n-- \t*\n\tt.street, dtu.street_line_1\n\t, dtu.first_name, dtu.last_name, dtu.street_line_1, dtu.street_line_2, dtu.city, dtu.state, dtu.zip_code\n\t, t.*\nfrom etl.compliance_customers_staging t\ninner join bi.dt_users dtu on (t.street ilike '%' || dtu.street_line_1 || '%')\ninner join bi.dt_accounts dta on (dta.user_id = dtu.user_id)\nwhere 1=1\n\tand len(dtu.street_line_1) >= 7\n-- \tand dta.galileo_id is not null\n;\n\n-------- businesses check\n-- full match (ssn vs tin/ein match)\nselect top 100 *\nfrom etl.compliance_businesses_staging t\ninner join bi.dt_users dtu on (dtu.ssn = t.number)\ninner join bi.dt_accounts dta on (dta.user_id = dtu.user_id)\nwhere 1=1\n\tand dta.galileo_id is not null\n;\n\n-- partial match (lastname + street)\nselect top 100 \n-- \t*\n\tt.business_name, dtu.last_name\n\t, dtu.first_name, dtu.last_name, dtu.street_line_1, dtu.street_line_2, dtu.city, dtu.state, dtu.zip_code\n\t, t.*\nfrom etl.compliance_businesses_staging t\ninner join bi.dt_users dtu on (t.business_name ilike '%' || dtu.last_name || '%' and t.street ilike '%' || dtu.street_line_1 || '%')\ninner join bi.dt_accounts dta on (dta.user_id = dtu.user_id)\nwhere 1=1\n\tand dta.galileo_id is not null\n;\n\n-- partial match (address)\nselect top 100 \n-- \t*\n\tt.street, dtu.street_line_1\n\t, dtu.first_name, dtu.last_name, dtu.street_line_1, dtu.street_line_2, dtu.city, dtu.state, dtu.zip_code\n\t, t.*\nfrom etl.compliance_businesses_staging t\ninner join bi.dt_users dtu on (t.street ilike '%' || dtu.street_line_1 || '%')\ninner join bi.dt_accounts dta on (dta.user_id = dtu.user_id)\nwhere 1=1\n\tand len(dtu.street_line_1) >= 7\n-- \tand dta.galileo_id is not null\n;\n\n-------------\n\nselect top 1000 \n\tdtu.street_line_1, dtu.street_line_2, dtu.*\nfrom bi.dt_users dtu \ninner join bi.dt_accounts dta on (dta.user_id = dtu.user_id)\nwhere 1=1\n\tand dta.galileo_id is not null\n;\n","colour":"e6e63c"}},"variables":{},"grids":{}},"info":{"name":"compliance_check_list","description":null,"type":"ORCHESTRATION","tag":"8d3fd65b-97f9-43eb-b0f8-a36720bc6aee"}}