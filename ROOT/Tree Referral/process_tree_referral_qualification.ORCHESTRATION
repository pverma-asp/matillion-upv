{"job":{"components":{"2964824":{"id":2964824,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":208,"y":176,"width":32,"height":32,"inputConnectorIDs":[2964826],"outputSuccessConnectorIDs":[2964821],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Load staging table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"drop table if exists etl.tree_referral_qualification_staging;\n\ncreate table etl.tree_referral_qualification_staging as\nwith account_balances as (\n    select\n        du.user_id,\n        du.user_email,\n        dadd.unique_account_id,\n        dadd.date,\n        dadd.daily_balance,\n        da.termination_date,\n        row_number() over (partition by dadd.unique_account_id order by dadd.date) as business_day_sequence_number\n    from bi.dt_account_daily_data dadd\n    join etl.dates d on dadd.date = d.date\n                    and d.date >= '2020-06-12'\n                    and d.is_business_day = True\n    join bi.dt_accounts da on da.unique_account_id=dadd.unique_account_id\n    join bi.dt_users du on da.user_id=du.user_id\n    where 1=1\n      and da.account_type='Checking'\n--       and du.user_id=1738184\n)\nselect\n    us.inviting_user_id,\n    du_inviting.user_email as inviting_user_email,\n    us.invited_user_id,\n    du_invited.user_email as invited_user_email,\n    ab.date as qualified_date\n--     count(1)\nfrom account_balances ab\njoin web_db.user_signup us on ab.user_id=us.invited_user_id\n    and inviting_user_id != 1\n    and us.date_created >='2020-06-12'\njoin bi.dt_users du_inviting on us.inviting_user_id=du_inviting.user_id\njoin bi.dt_users du_invited  on us.invited_user_id=du_invited.user_id\nwhere 1=1\n--   and us.invited_user_id=1755753\n  and ab.business_day_sequence_number = 10\n  and ab.daily_balance > 0\n  and (ab.termination_date is null\n        or ab.termination_date > qualified_date\n      )\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964825":{"id":2964825,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":288,"y":288,"width":32,"height":32,"inputConnectorIDs":[2964821],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Load main table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"insert into rdl.tree_referral_qualification\n(inviting_user_id, inviting_user_email, invited_user_id, invited_user_email, qualified_date)\nselect\n    inviting_user_id,\n    inviting_user_email,\n    invited_user_id,\n    invited_user_email,\n    qualified_date\nfrom etl.tree_referral_qualification_staging\nwhere (inviting_user_id, invited_user_id) not in (\n    select inviting_user_id, invited_user_id\n    from rdl.tree_referral_qualification\n    )\n;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964827":{"id":2964827,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-149,"y":326,"width":32,"height":32,"inputConnectorIDs":[2964820],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"adhoc_query"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"delete from  rdl.tree_referral_qualification\nwhere 1=1\n  and ETL_LOAD_DATE > '2021-02-01'\n;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964828":{"id":2964828,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":0,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2964822,2964823],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964830":{"id":2964830,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":144,"y":80,"width":32,"height":32,"inputConnectorIDs":[2964822],"outputSuccessConnectorIDs":[2964826],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"create dates table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"drop table if exists etl.dates;\n\ncreate table etl.dates as\nWITH all_dates as (\n    SELECT '2020-06-01'::DATE + i - 1 AS date\n    FROM etl.numbers\n    WHERE i <= '2022-01-01'::DATE - '2020-06-01'::DATE + 1\n)\n, holidays as (\n    select '2020-07-03' as date union all\n    select '2020-09-07' union all\n    select '2020-11-26' union all\n    select '2020-12-25' union all\n    select '2021-01-01' union all\n    select '2021-01-18' union all\n    select '2021-03-31' union all\n    select '2021-07-05' union all\n    select '2021-09-06' union all\n    select '2021-11-11' union all\n    select '2021-11-25' union all\n    select '2021-12-24' union all\n    select '2021-12-31' union all\n    select '2022-01-01'\n)\nselect\n    ad.date,\n    date_part('weekday', ad.date) in (1,2,3,4,5) as is_weekday,\n    case\n        when h.date is null then False\n        else True\n    end as is_holiday,\n    is_weekday and not is_holiday as is_business_day\nfrom all_dates ad\nleft join holidays h on ad.date=h.date\norder by date asc\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964831":{"id":2964831,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-80,"y":128,"width":32,"height":32,"inputConnectorIDs":[2964823],"outputSuccessConnectorIDs":[2964820],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"table creation scripts"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"drop table if exists rdl.tree_referral_qualification;\n\ncreate table rdl.tree_referral_qualification\n(\n\tinviting_user_id bigint,\n\tinvited_user_id bigint,\n\tqualified_date date,\n\tetl_load_date timestamp_tz default current_timestamp not null,\n\tjob_run_date date default current_date,\n    inviting_user_email varchar(255),\n    invited_user_email varchar(255)\n);\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2964820":{"id":2964820,"sourceID":2964831,"targetID":2964827},"2964821":{"id":2964821,"sourceID":2964824,"targetID":2964825},"2964826":{"id":2964826,"sourceID":2964830,"targetID":2964824}},"failureConnectors":{},"unconditionalConnectors":{"2964822":{"id":2964822,"sourceID":2964828,"targetID":2964830},"2964823":{"id":2964823,"sourceID":2964828,"targetID":2964831}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{},"grids":{}},"info":{"name":"process_tree_referral_qualification","description":"","type":"ORCHESTRATION","tag":"4e2c527a-96c2-445d-8671-602a17ec6241"}}