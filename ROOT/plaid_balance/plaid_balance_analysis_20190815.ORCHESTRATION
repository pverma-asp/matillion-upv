{"job":{"components":{"2962404":{"id":2962404,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-160,"y":0,"width":32,"height":32,"inputConnectorIDs":[2962401],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ad hoc"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"-- alter table rdl.plaid_balance_parsed_20190815 rename to plaid_balance_parsed_20190815_snapshot_backup"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962405":{"id":2962405,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":192,"y":112,"width":32,"height":32,"inputConnectorIDs":[2962406],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"load plaid_balance_parsed"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"drop table if exists rdl.plaid_balance_parsed_20190815;\n\ncreate table rdl.plaid_balance_parsed_20190815 as\nwith seq_0_to_10 AS (\n    SELECT 0 AS i UNION ALL\n    SELECT 1 UNION ALL\n    SELECT 2 UNION ALL\n    SELECT 3 UNION ALL\n    SELECT 4 UNION ALL\n    SELECT 5 UNION ALL\n    SELECT 6 UNION ALL\n    SELECT 7 UNION ALL\n    SELECT 8 UNION ALL\n    SELECT 9 UNION ALL\n    SELECT 10 as i\n)\n, accounts as (\n    SELECT\n      plaid_token,\n--       json_extract_path_text(original_plaid_data, 'accounts'),\n      json_extract_array_element_text(json_extract_path_text(original_plaid_data, 'accounts'), seq_0_to_10.i) as account_json\n    --   json_extract_array_element_text(original_plaid_data, seq.i)\n    FROM rdl.plaid_balance_raw_20190815\n      CROSS JOIN seq_0_to_10\n    WHERE 1 = 1\n      AND seq_0_to_10.i < JSON_ARRAY_LENGTH(json_extract_path_text(original_plaid_data, 'accounts'))\n--      AND plaid_token='access-production-500d9279-d98f-414a-bb84-0d14ddc2ae9d'\n      AND original_plaid_data not like '{\"error%'\n)\nSELECT\n  plaid_token,\n--  account_json,\n  json_extract_path_text(account_json, 'account_id') as account_id,\n--  json_extract_path_text(account_json, 'balances') as balances,\n  json_extract_path_text(account_json, 'balances', 'available') as available_balance,\n  json_extract_path_text(account_json, 'balances', 'current') as current_balance,\n  json_extract_path_text(account_json, 'balances', 'limit') as balance_limit,\n  json_extract_path_text(account_json, 'mask') as mask,\n  json_extract_path_text(account_json, 'name') as name,\n  json_extract_path_text(account_json, 'official_name') as official_name,\n  json_extract_path_text(account_json, 'subtype') as subtype,\n  json_extract_path_text(account_json, 'type') as type\nFROM accounts\n;\n\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962410":{"id":2962410,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":192,"y":0,"width":32,"height":32,"inputConnectorIDs":[2962407],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2962406],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"load plaid_balance_raw"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE if not exists rdl.plaid_balance_raw_20190815 (\n  plaid_token varchar(255) not null,\n  original_plaid_data varchar(65535) not null\n)\n;\n\ntruncate rdl.plaid_balance_raw_20190815;\n\ncopy rdl.plaid_balance_raw_20190815\nfrom 's3://aspiration-datateam/dump/jchen/plaid_balance/plaid_balance_20190820_acc.csv'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\ndelimiter ','\nremovequotes\n;\n\ncopy rdl.plaid_balance_raw_20190815\nfrom 's3://aspiration-datateam/dump/jchen/plaid_balance/plaid_balance_20190820_d3d.csv'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\ndelimiter ','\nremovequotes\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962411":{"id":2962411,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":0,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2962401,2962407],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{},"failureConnectors":{},"unconditionalConnectors":{"2962401":{"id":2962401,"sourceID":2962411,"targetID":2962404},"2962406":{"id":2962406,"sourceID":2962410,"targetID":2962405},"2962407":{"id":2962407,"sourceID":2962411,"targetID":2962410}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{},"grids":{}},"info":{"name":"plaid_balance_analysis_20190815","description":null,"type":"ORCHESTRATION","tag":"4d68ef96-581d-4cb3-8ef1-2f434524b4b3"}}