{"job":{"components":{"2968160":{"id":2968160,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-224,"y":-80,"width":32,"height":32,"inputConnectorIDs":[2968180],"outputSuccessConnectorIDs":[2968190],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"load into staging"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"drop table if exists etl.ach_coastal_file_staging;\n\ncreate table etl.ach_coastal_file_staging \n(\n  TRACE varchar(50),\n  NAME varchar(300),\n  PMT_REF_NO varchar(20),\n  SCHEDULED_DT varchar(20),\n  DEB_CRED_IND varchar(10),\n  FILE_DT varchar(20),\n  AMT varchar(20),\n  FILENAME varchar(50),\n  TRANS_TYPE varchar(50),\n  RETURN_CODE varchar(50),\n  ACH_TYPE varchar(50),\n  RETURN_DT varchar(50),\n  SOURCE_TRACE varchar(50),\n  POSTING_DT varchar(50),\n  SETTLE_DT  varchar(50)\n);\n\ncopy into etl.ach_coastal_file_staging \nfrom '${copy_into_full_path}'\nFILE_FORMAT = (SKIP_HEADER = 1, TYPE = CSV, FIELD_OPTIONALLY_ENCLOSED_BY = '\"');\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2968161":{"id":2968161,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-96,"y":-80,"width":32,"height":32,"inputConnectorIDs":[2968190],"outputSuccessConnectorIDs":[2968185],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"delete existing records"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"delete from rdl.ach_coastal_file\nwhere file_name = '${ach_file_name}';"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2968162":{"id":2968162,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":32,"y":-80,"width":32,"height":32,"inputConnectorIDs":[2968185],"outputSuccessConnectorIDs":[2968184],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"insert into final table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Insert into rdl.ach_coastal_file\n(\n  FILE_NAME,\n  FILE_DATE, \n  TRACE_NUMBER,\n  NAME, \n  PMT_REF_NO, \n  SCHEDULED_DATE,                            \n  DEBIT_CREDIT_INDICATOR, \n  FILE_DATA_DATE, \n  AMOUNT, \n  FILE_DATA_NAME, \n  TRANSACTION_TYPE,\n  RETURN_CODE, \n  ACH_TYPE, \n  RETURN_DATE, \n  SOURCE_TRACE, \n  POSTING_DATE, \n  SETTLE_DATE\n)\nselect\n    '${ach_file_name}',\n    '${file_date}',\n  \tTRACE,\n  \tNAME,\n  \tPMT_REF_NO,\n    to_date('20' || substring(to_date(left(SCHEDULED_DT,9)),3,8) || ' ' || substring(SCHEDULED_DT,11,8)) as SCHEDULED_DT,\n    DEB_CRED_IND,\n    to_date('20' || substring(to_date(left(FILE_DT,9)),3,8) || ' ' || substring(FILE_DT,11,8)) as FILE_DT,\n    AMT,\n    FILENAME,\n    TRANS_TYPE,\n    RETURN_CODE,\n    ACH_TYPE,\n    to_date('20' || substring(to_date(left(RETURN_DT,9)),3,8) || ' ' || substring(RETURN_DT,11,8)) as RETURN_DT,\n    SOURCE_TRACE,\n    to_date('20' || substring(to_date(left(POSTING_DT,9)),3,8) || ' ' || substring(POSTING_DT,11,8)) as POSTING_DT,\n    to_date('20' || substring(to_date(left(SETTLE_DT,9)),3,8) || ' ' || substring(SETTLE_DT,11,8)) as SETTLE_DT\nfrom etl.ach_coastal_file_staging;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2968163":{"id":2968163,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":32,"y":128,"width":32,"height":32,"inputConnectorIDs":[2968181],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"log data imported"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"--log any files expected to be there but weren't\ninsert into etl.issue_log\n(issue_program, issue_description, issue_count, issue_object, issue_identifier, issue_priority)\nselect\n       'Coastal ACH File',\n       'Data import completed successfully - ${records_inserted} records inserted.',\n        ${records_inserted},\n       'rdl.ach_coastal_file',\n       'file_name = ${ach_file_name}',\n       'low';"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2968164":{"id":2968164,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-688,"y":-80,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2968182],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"start"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2968166":{"id":2968166,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-576,"y":-80,"width":32,"height":32,"inputConnectorIDs":[2968182],"outputSuccessConnectorIDs":[2968187],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"set variables"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\n\n\ncontext.updateVariable('copy_into_full_path', copy_into_path + \"/\" + yr + \"/\" + mo + \"/\" + ach_file_name)\n\nprint (copy_into_full_path)\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2968167":{"id":2968167,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1032749985,"x":32,"y":16,"width":32,"height":32,"inputConnectorIDs":[2968184],"outputSuccessConnectorIDs":[2968181],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"get row count"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select count(*) as row_count\nfrom rdl.ach_coastal_file\nwhere file_name = '${ach_file_name}'\n\n"}}}},"visible":true},"3":{"slot":3,"name":"Scalar Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"records_inserted"},"2":{"slot":2,"type":"STRING","value":"ROW_COUNT"}}}},"visible":true},"4":{"slot":4,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2968188":{"id":2968188,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"CONDITIONAL","executionHint":"FLOW","implementationID":-1357378929,"x":-352,"y":-80,"width":32,"height":32,"inputConnectorIDs":[2968186],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[2968180],"outputFalseConnectorIDs":[2968183],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"file exists"}}}},"visible":true},"2":{"slot":2,"name":"Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Simple"}}}},"visible":true},"3":{"slot":3,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ach_file_exists"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"true"}}}},"visible":true},"4":{"slot":4,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":true},"5":{"slot":5,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2968189":{"id":2968189,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-464,"y":-80,"width":32,"height":32,"inputConnectorIDs":[2968187],"outputSuccessConnectorIDs":[2968186],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"check for file"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\n\nimport boto3\nimport botocore\n\ns3 = boto3.resource('s3')\n\ntry:\n    s3.Object(\"aspiration-galileo-prod-sftp-all\", yr + \"/\" + mo + \"/\" + ach_file_name).load()\nexcept botocore.exceptions.ClientError as e:\n       context.updateVariable('ach_file_exists', \"false\")\nelse:\n       context.updateVariable('ach_file_exists', \"true\")\n\nprint(\"ACH file exists: \" + ach_file_exists)"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2968191":{"id":2968191,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-352,"y":16,"width":32,"height":32,"inputConnectorIDs":[2968183],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"log no file to import"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"--log any files expected to be there but weren't\ninsert into etl.issue_log\n(issue_program, issue_description, issue_count, issue_object, issue_identifier, issue_priority)\nselect\n       'Coastal ACH File',\n       'Expected file ${ach_file_name}, but it was missing',\n        null,\n       'rdl.ach_coastal_file',\n       'file_name = ${ach_file_name}',\n       'high';"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2968181":{"id":2968181,"sourceID":2968167,"targetID":2968163},"2968184":{"id":2968184,"sourceID":2968162,"targetID":2968167},"2968185":{"id":2968185,"sourceID":2968161,"targetID":2968162},"2968186":{"id":2968186,"sourceID":2968189,"targetID":2968188},"2968187":{"id":2968187,"sourceID":2968166,"targetID":2968189},"2968190":{"id":2968190,"sourceID":2968160,"targetID":2968161}},"failureConnectors":{},"unconditionalConnectors":{"2968182":{"id":2968182,"sourceID":2968164,"targetID":2968166}},"trueConnectors":{"2968180":{"id":2968180,"sourceID":2968188,"targetID":2968160}},"falseConnectors":{"2968183":{"id":2968183,"sourceID":2968188,"targetID":2968191}},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{"ach_file_exists":{"definition":{"name":"ach_file_exists","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"true"},"ach_file_name":{"definition":{"name":"ach_file_name","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"Aspiration_ACH_20220208.csv"},"copy_into_full_path":{"definition":{"name":"copy_into_full_path","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"@public.GALILEO_SFTP/2021/5/Aspiration_ACH_20220208.csv"},"copy_into_path":{"definition":{"name":"copy_into_path","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"@public.GALILEO_SFTP"},"file_date":{"definition":{"name":"file_date","type":"DATETIME","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"2022-02-08"},"mo":{"definition":{"name":"mo","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"2"},"records_inserted":{"definition":{"name":"records_inserted","type":"DECIMAL","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":null},"yr":{"definition":{"name":"yr","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"2022"}},"grids":{}},"info":{"name":"Coastal ACH File process","description":"","type":"ORCHESTRATION","tag":"85cee2a8-d342-42b1-bffd-f07caf6f7e71"}}