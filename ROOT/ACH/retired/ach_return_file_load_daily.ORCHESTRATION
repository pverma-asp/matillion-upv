{"job":{"components":{"2968201":{"id":2968201,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":237373210,"x":-2272,"y":-48,"width":32,"height":32,"inputConnectorIDs":[2968223],"outputSuccessConnectorIDs":[2968203],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Copy of Truncate ACH tables"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2968204":{"id":2968204,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-1696,"y":-48,"width":32,"height":32,"inputConnectorIDs":[2968202],"outputSuccessConnectorIDs":[2968221],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Unload file sections"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"unload ('select ach_data from ${staging_schema}.${file_staging_table_name_returns} where record_type = ''1''')\nto '${file_staging_path}/ach_return_file_header_${file_name}'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nparallel off\nallowoverwrite\n;\n\nunload ('select row_index_number,ach_data from ${staging_schema}.${file_staging_table_name_returns} where record_type = ''5''')\nto '${file_staging_path}/ach_return_batch_header_${file_name}'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'row_index_number:6,ach_data:93'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nparallel off\nallowoverwrite\n;\n\nunload ('select row_index_number,ach_data from ${staging_schema}.${file_staging_table_name_returns} where record_type = ''6''')\nto '${file_staging_path}/ach_return_entry_detail_${file_name}'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'row_index_number:6,ach_data:93'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nparallel off\nallowoverwrite\n;\n\nunload ('select row_index_number,ach_data from ${staging_schema}.${file_staging_table_name_returns} where record_type = ''7''')\nto '${file_staging_path}/ach_return_addenda_record_${file_name}'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'row_index_number:6,ach_data:93'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nparallel off\nallowoverwrite\n;\n\n\nunload ('select ach_data from ${staging_schema}.${file_staging_table_name_returns} where record_type = ''8''')\nto '${file_staging_path}/ach_return_batch_control_${file_name}'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nparallel off\nallowoverwrite\n;\n\nunload ('select ach_data from ${staging_schema}.${file_staging_table_name_returns} where record_type = ''9'' and ach_data != replicate(''9'', 93)')\nto '${file_staging_path}/ach_return_file_control_${file_name}'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nENCRYPTED\nKMS_KEY_ID '${kms_key_id}'\nparallel off\nallowoverwrite\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2968205":{"id":2968205,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":773867971,"x":-2128,"y":-48,"width":32,"height":32,"inputConnectorIDs":[2968203],"outputSuccessConnectorIDs":[2968202],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"S3 Load ACH file"}}}},"visible":true},"4":{"slot":4,"name":"S3 Object Prefix","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${file_name}"}}}},"visible":true},"7":{"slot":7,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"8":{"slot":8,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${file_staging_table_name_returns}"}}}},"visible":true},"9":{"slot":9,"name":"Load Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"row_index_number"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"record_type"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"ach_data"}}}},"visible":true},"23":{"slot":23,"name":"Date Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":true},"24":{"slot":24,"name":"Time Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":true},"26":{"slot":26,"name":"","elements":{},"visible":false},"27":{"slot":27,"name":"Escape","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2968206":{"id":2968206,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-1440,"y":-48,"width":32,"height":32,"inputConnectorIDs":[2968220],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Update RAW ACH table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"delete from rdl.ach_return_batch_header\nwhere file_name =  '${file_name}'\n;\n\ninsert into rdl.ach_return_batch_header(file_name, file_date, row_index_number, service_class_code, company_name, company_discretionary_data, company_identification, standard_entry_class_code, company_entry_description, company_descriptive_date, effective_entry_date, settlement_date_julian, originator_status_code, originating_dfi_identification, batch_number)\nselect  '${file_name}', to_date('${current_year}-${current_month}-${current_day}','YY-MM-DD'), row_index_number::bigint, service_class_code::int, company_name, company_discretionary_data, company_identification, standard_entry_class_code, company_entry_description, company_descriptive_date, effective_entry_date, settlement_date_julian, originator_status_code, originating_dfi_identification, batch_number\nfrom etl.ach_return_batch_header_staging\n;\n\ndelete from rdl.ach_return_entry_detail\nwhere file_name =  '${file_name}'\n;\n\ninsert into rdl.ach_return_entry_detail(file_name, file_date, row_index_number, record_type_code, transaction_code, receiving_dfi_identification, check_digit,\n                                        dfi_account_number, amount, individual_identification_number__identification_number__check_serial_number,\n                                        individual_name__receiving_company_name, discretionary_data__payment_type_code__card_transaction_type_code,\n                                        addenda_record_indicator, trace_number,return_reason_code)\nselect  '${file_name}', to_date('${current_year}-${current_month}-${current_day}','YY-MM-DD'), areds.row_index_number::bigint, areds.record_type_code, transaction_code, receiving_dfi_identification, check_digit, dfi_account_number, (amount/100.00)::numeric(14,2),\n       individual_identification_number__identification_number__check_serial_number, individual_name__receiving_company_name,\n       discretionary_data__payment_type_code__card_transaction_type_code, addenda_record_indicator, areds.trace_number::bigint,arar.return_reason_code\nfrom etl.ach_return_entry_detail_staging areds\nleft join (select return_reason_code, trace_number, addenda_type_code\n  from etl.ach_return_addenda_record\n  where addenda_type_code = '99') arar on areds.trace_number = arar.trace_number;\n\n\ndelete from rdl.raw_ach_return_data\nwhere file_name = '${file_name}'\n;\n\ninsert into rdl.raw_ach_return_data(ach_return_entry_detail_id,file_name, file_date, row_index_number, addenda_type_code, return_reason_code, original_entry_trace_number, date_of_death, original_receiving_dfi_identification, addenda_information, trace_number)\nselect  rard.ach_return_entry_detail_id, '${file_name}', to_date('${current_year}-${current_month}-${current_day}','YY-MM-DD'),arar.row_index_number::bigint, arar.addenda_type_code,\n       arar.return_reason_code, arar.original_entry_trace_number, arar.date_of_death, arar.original_receiving_dfi_identification, arar.addenda_information, arar.trace_number::bigint\nfrom etl.ach_return_addenda_record arar\ninner join rdl.ach_return_entry_detail rard on arar.trace_number::bigint = rard.trace_number\nwhere rard.file_name = '${file_name}'\n;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2968207":{"id":2968207,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-1584,"y":-48,"width":32,"height":32,"inputConnectorIDs":[2968221],"outputSuccessConnectorIDs":[2968220],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Load file sections"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"copy ${staging_schema}.ach_return_file_header_staging(priority_code, immediate_destination, immediate_origin, file_creation_date, file_creation_time, file_id_modifier, record_size, blocking_factor, format_code, immediate_destination_name, immediate_origin_name, reference_code)\nfrom '${file_staging_path}/ach_return_file_header_${file_name}'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'priority_code:2,immediate_destination:10,immediate_origin:10,file_creation_date:6,file_creation_time:4,file_id_modifier:1,record_size:3,blocking_factor:2,format_code:1,immediate_destination_name:23,immediate_origin_name:23,reference_code:8';\n\ncopy ${staging_schema}.ach_return_batch_header_staging(row_index_number, service_class_code, company_name, company_discretionary_data, company_identification, standard_entry_class_code, company_entry_description, company_descriptive_date, effective_entry_date, settlement_date_julian, originator_status_code, originating_dfi_identification, batch_number)\nfrom '${file_staging_path}/ach_return_batch_header_${file_name}'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'row_index_number:6,service_class_code:3,company_name:16,company_discretionary_data:20,company_identification:10,standard_entry_class_code:3,company_entry_description:10,company_descriptive_date:6,effective_entry_date:6,settlement_date_julian:3,originator_status_code:1,originating_dfi_identification:8,batch_number:7';\n\ncopy ${staging_schema}.ach_return_entry_detail_staging(row_index_number, transaction_code, receiving_dfi_identification, check_digit, dfi_account_number, amount, individual_identification_number__identification_number__check_serial_number, individual_name__receiving_company_name, discretionary_data__payment_type_code__card_transaction_type_code, addenda_record_indicator, trace_number)\nfrom '${file_staging_path}/ach_return_entry_detail_${file_name}'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'row_index_number:6,transaction_code:2,receiving_dfi_identification:8,check_digit:1,dfi_account_number:17,amount:10,individual_identification_number__identification_number__check_serial_number:15,individual_name__receiving_company_name:22,discretionary_data__payment_type_code__card_transaction_type_code:2,addenda_record_indicator:1,trace_number:15';\n\ncopy\t${staging_schema}.ach_return_addenda_record(row_index_number,addenda_type_code, return_reason_code, original_entry_trace_number,date_of_death, original_receiving_dfi_identification, addenda_information, trace_number)\nfrom\t'${file_staging_path}/ach_return_addenda_record_${file_name}'\niam_role\t'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth\t'row_index_number:6,addenda_type_code:2,return_reason_code:3,original_entry_trace_number:15,date_of_death:6,original_receiving_dfi_identification:8,addenda_information:44,trace_number:15';\t\n\ncopy ${staging_schema}.ach_return_batch_control_staging(service_class_code, entry__addenda_count, entry_hash, total_debit_entry_dollar_amount_in_batch, total_credit_entry_dollar_amount_in_batch, company_identification, message_authentication_code, reserved, originating_dfi_identification, batch_number)\nfrom '${file_staging_path}/ach_return_batch_control_${file_name}'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'service_class_code:3,entry__addenda_count:6,entry_hash:10,total_debit_entry_dollar_amount_in_batch:12,total_credit_entry_dollar_amount_in_batch:12,company_identification:10,message_authentication_code:19,reserved:6,originating_dfi_identification:8,batch_number:7';\n\ncopy ${staging_schema}.ach_return_file_control_staging(batch_count, block_count, entry__addenda_count, entry_hash, total_debit_entry_dollar_amount_in_file, total_credit_entry_dollar_amount_in_file, reserved)\nfrom '${file_staging_path}/ach_return_file_control_${file_name}'\niam_role 'arn:aws:iam::332894900161:role/RedshiftClusterRole'\nfixedwidth 'batch_count:6,block_count:6,entry__addenda_count:8,entry_hash:10,total_debit_entry_dollar_amount_in_file:12,total_credit_entry_dollar_amount_in_file:12,reserved:39';"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2968242":{"id":2968242,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-2640,"y":-48,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2968223],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2968202":{"id":2968202,"sourceID":2968205,"targetID":2968204},"2968203":{"id":2968203,"sourceID":2968201,"targetID":2968205},"2968220":{"id":2968220,"sourceID":2968207,"targetID":2968206},"2968221":{"id":2968221,"sourceID":2968204,"targetID":2968207}},"failureConnectors":{},"unconditionalConnectors":{"2968223":{"id":2968223,"sourceID":2968242,"targetID":2968201}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{"current_day":{"definition":{"name":"current_day","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"26"},"current_month":{"definition":{"name":"current_month","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"06"},"current_year":{"definition":{"name":"current_year","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"2018"},"file_name":{"definition":{"name":"file_name","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"ACHRET_192001"},"file_staging_path":{"definition":{"name":"file_staging_path","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"s3://aspiration-etl-staging/file_processing/ach/staging_files"},"file_staging_table_name":{"definition":{"name":"file_staging_table_name","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"ach_file_staging"},"file_staging_table_name_returns":{"definition":{"name":"file_staging_table_name_returns","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"ach_return_file_staging"},"parsed_file_path":{"definition":{"name":"parsed_file_path","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"s3://aspiration-etl-staging/file_processing/ach/coastal_file_drop"},"s3_file_path":{"definition":{"name":"s3_file_path","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"2018/11"},"s3_filename":{"definition":{"name":"s3_filename","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"test_20181112.csv"}},"grids":{"ach_return_table_list":{"definition":{"name":"ach_return_table_list","scope":"BRANCH","definitions":[{"name":"table_name","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[{"values":["ach_return_file_staging"]},{"values":["ach_return_file_header_staging"]},{"values":["ach_return_batch_header_staging"]},{"values":["ach_return_entry_detail_staging"]},{"values":["ach_return_batch_control_staging"]},{"values":["ach_return_file_control_staging"]},{"values":["ach_return_addenda_record"]}]},"ach_table_list":{"definition":{"name":"ach_table_list","scope":"BRANCH","definitions":[{"name":"table_name","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[{"values":["ach_return_file_staging"]},{"values":["ach_return_file_header_staging"]},{"values":["ach_return_batch_header_staging"]},{"values":["ach_return_entry_detail_staging"]},{"values":["ach_return_batch_control_staging"]},{"values":["ach_return_file_control_staging"]}]},"file_name_list":{"definition":{"name":"file_name_list","scope":"BRANCH","definitions":[{"name":"file_names_to_load","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[{"values":["files"]}]}}},"info":{"name":"ach_return_file_load_daily","description":"","type":"ORCHESTRATION","tag":"c9946ccc-a9f1-46c0-bb02-c8a0d4d76fb8"}}