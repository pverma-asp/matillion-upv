{"job":{"components":{"2962251":{"id":2962251,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-16,"y":240,"width":32,"height":32,"inputConnectorIDs":[2962271],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[2962264],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"swap table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ALTER TABLE rdl.DT_ACCOUNT_90_DAY_WINDOW_DATA\n  SWAP WITH etl.DT_ACCOUNT_90_DAY_WINDOW_DATA_staging;\nGRANT SELECT ON ADW.RDL.DT_ACCOUNT_90_DAY_WINDOW_DATA TO ROLE SVC_SEGMENT;\nGRANT SELECT ON ADW.RDL.DT_ACCOUNT_90_DAY_WINDOW_DATA TO ROLE Exactius;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962254":{"id":2962254,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-16,"y":112,"width":32,"height":32,"inputConnectorIDs":[2962265],"outputSuccessConnectorIDs":[2962271],"outputFailureConnectorIDs":[2962267],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"recreate etl.dt_account_90_day_window_data_staging"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"use warehouse unit_21;\n\ndrop table if exists etl.DT_ACCOUNT_90_DAY_WINDOW_DATA_staging;\n\ncreate table etl.DT_ACCOUNT_90_DAY_WINDOW_DATA_staging as\nwith dadd as (\n    select\n        dadd.UNIQUE_ACCOUNT_ID,\n        dadd.date,\n        dateadd('day', -89, dadd.date) as window_start,\n        dadd.date as window_end\n    from bi.DT_ACCOUNT_DAILY_DATA dadd\n    join bi.DT_ACCOUNTS da on dadd.UNIQUE_ACCOUNT_ID=da.UNIQUE_ACCOUNT_ID\n    -- left join rdl.DT_ACCOUNT_90_DAY_WINDOW_DATA dadde\n    --     on dadde.UNIQUE_ACCOUNT_ID=dadd.UNIQUE_ACCOUNT_ID\n    --    and dadde.DATE=dadd.DATE\n    where 1=1\n      and da.ACCOUNT_TYPE='Checking'\n      -- and dadde.UNIQUE_ACCOUNT_ID is null -- incremental load\n      -- and window_end <= (select max(post_date) from bi.DT_DEPOSITORY_TRANSACTIONS )  -- only calculate for days with posted transactions\n--       and window_end <= '2022-08-16'  -- only calculate for days with posted transactions\n--   and da.UNIQUE_ACCOUNT_ID='g2192959'\n--       and date = '2022-08-12'\n)\nselect\n    dadd.UNIQUE_ACCOUNT_ID,\n    dadd.DATE,\n    sum(DBT_CARD_PIN_COUNT + DBT_CARD_NO_PIN_COUNT) = 0 as inactive_debit,\n    sum(case when INTERNAL_TRANSFER_DEPOSIT != 0 then 1 else 0 end\n        + wire_deposit_count + other_deposit_count\n        + atm_deposit_count + check_deposit_count + ach_deposit_count) = 0 as inactive_debit_deposit,\n    sum(case when ACTUAL_PWIF_PAID < 0 then 1 else 0 end\n    + case when APLUS_FEE_PAID < 0 then 1 else 0 end\n    + case when PYC_REVENUE_AMOUNT < 0 then 1 else 0 end\n    + case when INTERCHANGE_FEE_AMOUNT < 0 then 1 else 0 end) = 0 as inactive_noninterest_revenue\nfrom dadd\njoin bi.DT_ACCOUNT_DAILY_DATA daddw\n    on dadd.UNIQUE_ACCOUNT_ID=daddw.UNIQUE_ACCOUNT_ID\n   and daddw.DATE between dadd.window_start and dadd.window_end\nwhere 1=1\ngroup by 1,2\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962255":{"id":2962255,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":0,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2962265],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Start","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962268":{"id":2962268,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":144,"y":160,"width":32,"height":32,"inputConnectorIDs":[2962264,2962267],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2962270],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Or 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962269":{"id":2962269,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":273,"y":194,"width":32,"height":32,"inputConnectorIDs":[2962270],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Send Alert to Pager Duty"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"us-west-2"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"data-alerts-pagerduty-prod"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AWS Notification Message"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"process_dt_account_90_day_window_data\" job failed"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2962271":{"id":2962271,"sourceID":2962254,"targetID":2962251}},"failureConnectors":{"2962264":{"id":2962264,"sourceID":2962251,"targetID":2962268},"2962267":{"id":2962267,"sourceID":2962254,"targetID":2962268}},"unconditionalConnectors":{"2962265":{"id":2962265,"sourceID":2962255,"targetID":2962254},"2962270":{"id":2962270,"sourceID":2962268,"targetID":2962269}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{},"grids":{}},"info":{"name":"process_dt_account_90_day_window_data","description":"","type":"ORCHESTRATION","tag":"5c7c9ad2-88a7-4ee6-87dd-3ef62b435931"}}