{"job":{"components":{"2956768":{"id":2956768,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-762,"y":-37,"width":32,"height":32,"inputConnectorIDs":[2956797],"outputSuccessConnectorIDs":[2956770],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dw.galileo_transaction_code_mapping_dim update"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"drop table if exists #tmp;\n\nselect src.galileo_trans_cd\ninto #tmp\nfrom dw.lkp_galileo_transaction_code_mapping src\ninner join dw.galileo_transaction_code_mapping_dim dst on (dst.galileo_trans_cd = src.galileo_trans_cd and dst.end_date = '9999-12-31')\nwhere src.galileo_trans_desc != dst.galileo_trans_desc\n  or src.transaction_cd != dst.transaction_cd\n  or src.transaction_group != dst.transaction_group\n;\n\nbegin transaction\n;\n\nupdate dw.galileo_transaction_code_mapping_dim\nset end_date = current_date - 1\nwhere galileo_trans_cd in (select t.galileo_trans_cd from #tmp t)\n;\n\ninsert into dw.galileo_transaction_code_mapping_dim(galileo_trans_cd, start_date, end_date, galileo_trans_desc, transaction_cd, transaction_group)\nselect src.galileo_trans_cd, \n\n  case\n    when t.galileo_trans_cd is not null then current_date\n    else '1900-01-01'\n  end as start_date, \n\n  '9999-12-31' as end_date, \n  src.galileo_trans_desc, \n  src.transaction_cd, \n  src.transaction_group\nfrom dw.lkp_galileo_transaction_code_mapping src\nleft join dw.galileo_transaction_code_mapping_dim dst on (dst.galileo_trans_cd = src.galileo_trans_cd and dst.end_date = '9999-12-31')\nleft join #tmp t on (t.galileo_trans_cd = src.galileo_trans_cd)\nwhere dst.galileo_trans_cd is null\n;\n\ncommit transaction\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2956769":{"id":2956769,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-770,"y":-132,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2956797],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2956771":{"id":2956771,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-771,"y":58,"width":32,"height":32,"inputConnectorIDs":[2956770],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dw.daily_snapshot_galileo_transactions_fact update"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"begin transaction\n;\n\ndelete from dw.daily_snapshot_galileo_transactions_fact\nwhere snapshot_date_dim_id = to_char(current_date, 'YYYYMMDD')::int\n;\n\ninsert into dw.daily_snapshot_galileo_transactions_fact(snapshot_date_dim_id, post_date_dim_id, transaction_group, total_transaction_group_amount)\nselect snapshot_date_dim_id, post_date_dim_id, transaction_group, total_transaction_group_amount\nfrom etl.daily_snapshot_galileo_transactions_fact_view\n;\n\ncommit transaction\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2956770":{"id":2956770,"sourceID":2956768,"targetID":2956771}},"failureConnectors":{},"unconditionalConnectors":{"2956797":{"id":2956797,"sourceID":2956769,"targetID":2956768}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{"2956772":{"id":2956772,"x":-1021,"y":-453,"width":250,"height":58,"text":"drop view if exists etl.daily_snapshot_galileo_transactions_fact_view;\n\ncreate or replace view etl.daily_snapshot_galileo_transactions_fact_view\nas\nwith t as\n(\n  select post_dates.post_date_dim_id, gtcm.transaction_group\n  from dw.galileo_transaction_code_mapping_dim gtcm\n  cross join\n  (\n    select to_char(to_date(gpt.post_date, 'MMDDYYYY'), 'YYYYMMDD')::int as post_date_dim_id\n    from web_db.galileo_posted_transaction gpt\n    group by to_date(gpt.post_date, 'MMDDYYYY')\n  ) as post_dates\n  where gtcm.galileo_transaction_code_mapping_dim_id != -1\n    and gtcm.end_date = '9999-12-31'\n  group by post_dates.post_date_dim_id, gtcm.transaction_group\n),\nt2 as\n(\n  select to_char(to_date(gpt.post_date, 'MMDDYYYY'), 'YYYYMMDD')::int as post_date_dim_id, \n    gtcm.transaction_group,\n    sum(case\n          when gpt.transaction_amount_sign = '+' then gpt.transaction_amount::numeric(13,4)\n          else gpt.transaction_amount::numeric(13,4) * -1\n        end) as total_transaction_group_amount\n  from web_db.galileo_posted_transaction gpt\n  inner join dw.galileo_transaction_code_mapping_dim gtcm on (gpt.transaction_code_type ilike gtcm.galileo_trans_cd + '%' and to_date(gpt.post_date, 'MMDDYYYY') between gtcm.start_date and gtcm.end_date)\n  group by to_char(to_date(gpt.post_date, 'MMDDYYYY'), 'YYYYMMDD')::int, gtcm.transaction_group\n)\nselect to_char(current_date, 'YYYYMMDD')::int as snapshot_date_dim_id,\n  t.post_date_dim_id,\n  t.transaction_group,\n  isnull(t2.total_transaction_group_amount, 0) as total_transaction_group_amount\nfrom t\nleft join t2 on (t2.post_date_dim_id = t.post_date_dim_id and t2.transaction_group = t.transaction_group)\n;\n\n-- select *\n-- from etl.daily_snapshot_galileo_transactions_fact_view\n-- order by post_date_dim_id, transaction_group\n-- ;\n","colour":"e6e63c"},"2956773":{"id":2956773,"x":-1291,"y":-454,"width":250,"height":58,"text":"drop table if exists dw.lkp_galileo_transaction_code_mapping;\ncreate table dw.lkp_galileo_transaction_code_mapping\n(\n  galileo_trans_cd varchar(10),\n  galileo_trans_desc varchar(128),\n  transaction_cd varchar(10),\n  transaction_group varchar(128)\n)\n;\n\nINSERT INTO dw.lkp_galileo_transaction_code_mapping(galileo_trans_cd, galileo_trans_desc, transaction_cd, transaction_group)\nSELECT 'PMCE', 'Coastal Direct Deposit', '', '1 - ACH Push DDs and ACH Debit transactions.' UNION ALL\nSELECT 'ADce', 'Coastal ACH Reversal', '', '1 - ACH Push DDs and ACH Debit transactions.' UNION ALL\nSELECT 'ADCE', 'Coastal ACH Debit', '', '1 - ACH Push DDs and ACH Debit transactions.' UNION ALL\nSELECT 'PMAC', 'E-Check', '', '2 - ACH Pull from external bank' UNION ALL\nSELECT 'ADce2', 'Coastal ACH Reversal', '', '2 - ACH Pull from external bank' UNION ALL\nSELECT 'ADS', 'Money Transfer', '', '3 - ACH Send to external bank' UNION ALL\nSELECT 'ADs', 'Money Transfer (sign reverse)', '', '3 - ACH Send to external bank' UNION ALL\nSELECT 'PMOR', 'RDC Other Check Deposit', '', '4 - RDC Check Deposit' UNION ALL\nSELECT 'ADor', 'RDC Other Check Dep Ret', '', '4 - RDC Check Deposit' UNION ALL\nSELECT 'PMR1', 'RDC Treasury Check Deposit', '', '4 - RDC Check Deposit' UNION ALL\nSELECT 'ADDR', 'RDC Treasury Chk Dep Ret', '', '4 - RDC Check Deposit' UNION ALL\nSELECT 'SE', 'Various codes for settle type', 'MC', '5 - Associations - MC' UNION ALL\nSELECT 'SD', 'Various codes for settle type', 'Maestro', '5 - Associations - Maestro' UNION ALL\nSELECT 'IS', 'Various codes for settle type', 'Interlink', '5 - Associations - Interlink' UNION ALL\nSELECT 'SP', 'Various codes for settle type', 'Pulse', '5 - Associations - Pulse' UNION ALL\nSELECT 'SS', 'Various codes for settle type', 'STAR', '5 - Associations - STAR' UNION ALL\nSELECT 'ADB', 'Chargeoff', '', '6 - Chargeoff' UNION ALL\nSELECT 'ADb', 'Chargeoff Recovery', '', '6 - Chargeoff' UNION ALL\nSELECT 'ADtc', 'Provisional Credit', '', '7 - Adjustments' UNION ALL\nSELECT 'ADfd', 'Final Dispute', '', '7 - Adjustments' UNION ALL\nSELECT 'ADQ', 'CS Initiated Adjustment', '', '7 - Adjustments' UNION ALL\nSELECT 'FE', 'Various codes for fee types', '', '8 - Program Fees' UNION ALL\nSELECT 'ADF1', 'Canadian Item Collection Fee ', '', '8 - Program Fees' UNION ALL\nSELECT 'ADF2', 'PWIF monthly summit tip fee ', '', '8 - Program Fees' UNION ALL\nSELECT 'ADF3', 'Deposited Item Reversal Fee', '', '8 - Program Fees' UNION ALL\nSELECT 'ADF4', 'Foreign Item Collection Fee', '', '8 - Program Fees' UNION ALL\nSELECT 'ADF5', 'Returned Item Charge Fee', '', '8 - Program Fees' UNION ALL\nSELECT 'ADF6', 'Domestic Wire In Fee', '', '8 - Program Fees' UNION ALL\nSELECT 'ADF7', 'Domestic Wire Out Fee', '', '8 - Program Fees' UNION ALL\nSELECT 'ADF8', 'International Wire In Fee', '', '8 - Program Fees' UNION ALL\nSELECT 'ADF9', 'International Wire Out Fee', '', '8 - Program Fees' UNION ALL\nSELECT 'ADZ', 'Paper Billpay', '', '9 - Billpay - checks sent directly from card account' UNION ALL\nSELECT 'ADR', 'Electronic Billpay', '', '9 - Billpay - checks sent directly from card account' UNION ALL\nSELECT 'PMWT', 'Wire Transfer', '', '10 - Wire Transfer in' UNION ALL\nSELECT 'ADwt', 'Wire Transfer Reversal', '', '10 - Wire Transfer in' UNION ALL\nSELECT 'ADSH', 'API Funds Transfer', '', '11 - Wire Transfer Out' UNION ALL\nSELECT 'ADsh', 'API Funds Transfer offset', '', '11 - Wire Transfer Out' UNION ALL\nSELECT 'ADZB', 'Inclearing Check Payment', '', '12 - Checks written on the card account by customers' UNION ALL\nSELECT 'ADzb', 'Check Deposit Return', '', '12 - Checks written on the card account by customers' UNION ALL\nSELECT 'ADAD', 'Domestic ATM Fee Rebate ', '', '13 - ATM Reimbursement Fee Rebate' UNION ALL\nSELECT 'ADAT', 'International ATM Fee Rebate ', '', '13 - ATM Reimbursement Fee Rebate' UNION ALL\nSELECT 'ADz', 'Interest', '', '14 - Interest' UNION ALL\nSELECT 'PMRH', 'Radius ACH Transfer ', '', '14 - Interest'\n;\n\n--------------------------\n\ndrop table if exists dw.galileo_transaction_code_mapping_dim cascade;\ncreate table dw.galileo_transaction_code_mapping_dim\n(\n  galileo_transaction_code_mapping_dim_id int identity(-1,1),\n  galileo_trans_cd varchar(10),\n  start_date date,\n  end_date date,\n  galileo_trans_desc varchar(128),\n  transaction_cd varchar(10),\n  transaction_group varchar(128)\n)\n;\n\ninsert into dw.galileo_transaction_code_mapping_dim(galileo_trans_cd, start_date, end_date, galileo_trans_desc, transaction_cd, transaction_group)\nvalues('-', '1900-01-01', '9999-12-31', '-', '-', '-')\n;\n\ninsert into dw.galileo_transaction_code_mapping_dim(galileo_trans_cd)\nvalues(null)\n;\n\ndelete from dw.galileo_transaction_code_mapping_dim\nwhere galileo_transaction_code_mapping_dim_id = 0\n;\n\n----------------------------\n\ndrop table if exists dw.daily_snapshot_galileo_transactions_fact;\ncreate table dw.daily_snapshot_galileo_transactions_fact\n(\n  id bigint identity(1,1),\n  etl_create_date timestamp default(current_date),\n  etl_update_date timestamp default(current_date),\n  snapshot_date_dim_id int,\n  post_date_dim_id int,\n  transaction_group varchar(128),\n  total_transaction_group_amount numeric(13,4)\n)\n;\n","colour":"e6e63c"},"2956774":{"id":2956774,"x":-483,"y":-455,"width":250,"height":58,"text":"begin transaction\n;\n\ndelete from dw.daily_snapshot_galileo_transactions_fact\nwhere snapshot_date_dim_id = to_char(current_date, 'YYYYMMDD')::int\n;\n\ninsert into dw.daily_snapshot_galileo_transactions_fact(snapshot_date_dim_id, post_date_dim_id, transaction_group, total_transaction_group_amount)\nselect snapshot_date_dim_id, post_date_dim_id, transaction_group, total_transaction_group_amount\nfrom etl.daily_snapshot_galileo_transactions_fact_view\n;\n\ncommit transaction\n;\n","colour":"e6e63c"},"2956775":{"id":2956775,"x":-755,"y":-453,"width":250,"height":58,"text":"drop table if exists #tmp;\n\nselect src.galileo_trans_cd\ninto #tmp\nfrom dw.lkp_galileo_transaction_code_mapping src\ninner join dw.galileo_transaction_code_mapping_dim dst on (dst.galileo_trans_cd = src.galileo_trans_cd and dst.end_date = '9999-12-31')\nwhere src.galileo_trans_desc != dst.galileo_trans_desc\n  or src.transaction_cd != dst.transaction_cd\n  or src.transaction_group != dst.transaction_group\n;\n\nbegin transaction\n;\n\nupdate dw.galileo_transaction_code_mapping_dim\nset end_date = current_date - 1\nwhere galileo_trans_cd in (select t.galileo_trans_cd from #tmp t)\n;\n\ninsert into dw.galileo_transaction_code_mapping_dim(galileo_trans_cd, start_date, end_date, galileo_trans_desc, transaction_cd, transaction_group)\nselect src.galileo_trans_cd, \n\n  case\n    when t.galileo_trans_cd is not null then current_date\n    else '1900-01-01'\n  end as start_date, \n\n  '9999-12-31' as end_date, \n  src.galileo_trans_desc, \n  src.transaction_cd, \n  src.transaction_group\nfrom dw.lkp_galileo_transaction_code_mapping src\nleft join dw.galileo_transaction_code_mapping_dim dst on (dst.galileo_trans_cd = src.galileo_trans_cd and dst.end_date = '9999-12-31')\nleft join #tmp t on (t.galileo_trans_cd = src.galileo_trans_cd)\nwhere dst.galileo_trans_cd is null\n;\n\ncommit transaction\n;\n\n---------------------\nbegin transaction\n;\n\ndelete from dw.daily_snapshot_galileo_transactions_fact\nwhere snapshot_date_dim_id = to_char(current_date, 'YYYYMMDD')::int\n;\n\ninsert into dw.daily_snapshot_galileo_transactions_fact(snapshot_date_dim_id, post_date_dim_id, transaction_group, total_transaction_group_amount)\nselect snapshot_date_dim_id, post_date_dim_id, transaction_group, total_transaction_group_amount\nfrom etl.daily_snapshot_galileo_transactions_fact_view\n;\n\ncommit transaction\n;\n","colour":"e6e63c"}},"variables":{},"grids":{}},"info":{"name":"DW tables update","description":"","type":"ORCHESTRATION","tag":"c44bca40-5505-4086-9d0d-a8b85dd648a8"}}