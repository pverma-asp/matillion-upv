{"job":{"components":{"2964178":{"id":2964178,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-1312,"y":-160,"width":32,"height":32,"inputConnectorIDs":[2964243],"outputSuccessConnectorIDs":[2964250],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_init_view_accounts_termination_dates"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_init_view_accounts_termination_dates"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964225":{"id":2964225,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-1306,"y":-331,"width":32,"height":32,"inputConnectorIDs":[2964240],"outputSuccessConnectorIDs":[2964247],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_etl_email"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_etl_email"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964228":{"id":2964228,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSACTION","implementationID":977205684,"x":-708,"y":-237,"width":32,"height":32,"inputConnectorIDs":[2964224],"outputSuccessConnectorIDs":[2964248],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Commit 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964229":{"id":2964229,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSACTION","implementationID":-1540940111,"x":-752,"y":-112,"width":32,"height":32,"inputConnectorIDs":[2964246],"outputSuccessConnectorIDs":[2964244],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Rollback 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964230":{"id":2964230,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":515156205,"x":-657,"y":-112,"width":32,"height":32,"inputConnectorIDs":[2964244],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Failure 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964231":{"id":2964231,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":-864,"y":-112,"width":32,"height":32,"inputConnectorIDs":[2964204,2964205],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2964246],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Or 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964232":{"id":2964232,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":235671163,"x":-1184,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2964226,2964247,2964250],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2964242],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964233":{"id":2964233,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-1312,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2964241],"outputSuccessConnectorIDs":[2964226],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_init_view_unique_user_accounts"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_init_view_unique_user_accounts"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964234":{"id":2964234,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSACTION","implementationID":-1785670938,"x":-1056,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2964242],"outputSuccessConnectorIDs":[2964245],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Begin 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964235":{"id":2964235,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-480,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2964248],"outputSuccessConnectorIDs":[2964249],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_init_consolidated_pnl"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_init_consolidated_pnl"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Source_table"},"2":{"slot":2,"type":"STRING","value":"${Target_table}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"Item_name"},"2":{"slot":2,"type":"STRING","value":"${Item_name}"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964236":{"id":2964236,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-816,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2964227],"outputSuccessConnectorIDs":[2964224],"outputFailureConnectorIDs":[2964204],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Execution"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"set timezone = 'America/Los_Angeles';\n\nINSERT INTO edw.${Target_table}(execution,\n                           User_id,\n                           Account_id,\n                           Non_customer,\n                           Category,\n                           Item,\n                           Date,\n                           Value,\n                           Value_type)\n\nWITH customer_to_account AS (\n      SELECT to_date(effective_date, 'YYYYMMDD') AS effective_date,\n             customer_id,\n             SUBSTRING(customer_id, 4) AS account_num\n      FROM edw.etl_return_fee\n    ),\n\n     accounts AS (\n       SELECT effective_date,\n              account_num,\n              COALESCE(a.id,\n                       account_num::bigint) AS account_id\n       FROM customer_to_account cta\n       LEFT JOIN WEB_DB.ACCOUNT a on cta.account_num = a.ACCOUNT_NUMBER or '__'+ cta.account_num = a.ACCOUNT_NUMBER\n     ),\n\n     transactions_count AS (\n       SELECT effective_date,\n              account_id,\n              COUNT(*) AS cnt,\n              cnt * 5.5 AS Value\n       FROM accounts\n       GROUP BY effective_date, account_id\n     )\n\nSELECT current_date() AS execution,\n       COALESCE(uua.user_id, 0) AS User_id,\n       tc.Account_id,\n       FALSE AS Non_customer,\n       'Direct'::text AS Category,\n       'Return Fee'::text AS Item,\n       effective_date AS Date,\n       -tc.Value AS Value,\n       'Cost'::text AS Value_type\nFROM transactions_count AS tc\n  LEFT JOIN edw.view_unique_user_accounts AS uua ON tc.account_id = uua.account_id;\n\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964237":{"id":2964237,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-1456,"y":-240,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2964240,2964241,2964243],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964238":{"id":2964238,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-928,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2964245],"outputSuccessConnectorIDs":[2964227],"outputFailureConnectorIDs":[2964205],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Create\\Truncate"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE IF NOT EXISTS edw.${Target_table}(\n                               id bigint identity(1, 1),\n                               execution timestamp with time zone,\n                               User_id bigint not null,\n                               Account_id bigint not null,\n                               Depository_id bigint,\n                               Investment_id bigint,\n                               Account_type varchar(50),\n                               Product_type varchar(50),\n--                                Account_product_type_id int, --account.product_type\n--                                Account_product_type_name varchar(50), --1 = investment, 2 = depository\n--                                Account_product_id int, --<depository.product_id>\n--                                Account_product_name varchar(50), --3 = Summit , 4 = Spend, 5 = Save\n--                                Account_type_id int, --<account.account_type_id>\n--                                Account_type_name varchar(50), --2 = Individual, 3 = IRA\n--                                Account_investment_type_id int, --<investment.fund_id>\n--                                Account_investment_type_name varchar(50), --1 = Flagship, 2 = Redwood\n                               Non_customer boolean not null, -- True for ZenDesk/False for others\n                               Category varchar(50) not null,\n                               Item varchar(50) not null,\n                               Date timestamp with time zone,\n                               Value numeric(38,8),\n                               Value_type varchar(50),\n                               primary key(id));\n                                                \nTRUNCATE edw.${Target_table}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964239":{"id":2964239,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-352,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2964249],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"TMP"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"GRANT SELECT ON ${Pnl_schema}.${Target_table} TO \"spashchenko.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Target_table} TO \"ashumakov.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Target_table} TO \"vfigurkin.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Target_table} TO \"opetrova.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Target_table} TO \"idudkin.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Consolidated_table} TO \"spashchenko.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Consolidated_table} TO \"ashumakov.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Consolidated_table} TO \"vfigurkin.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Consolidated_table} TO \"opetrova.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Consolidated_table} TO \"idudkin.ctr\";"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2964224":{"id":2964224,"sourceID":2964236,"targetID":2964228},"2964226":{"id":2964226,"sourceID":2964233,"targetID":2964232},"2964227":{"id":2964227,"sourceID":2964238,"targetID":2964236},"2964244":{"id":2964244,"sourceID":2964229,"targetID":2964230},"2964245":{"id":2964245,"sourceID":2964234,"targetID":2964238},"2964247":{"id":2964247,"sourceID":2964225,"targetID":2964232},"2964248":{"id":2964248,"sourceID":2964228,"targetID":2964235},"2964249":{"id":2964249,"sourceID":2964235,"targetID":2964239},"2964250":{"id":2964250,"sourceID":2964178,"targetID":2964232}},"failureConnectors":{"2964204":{"id":2964204,"sourceID":2964236,"targetID":2964231},"2964205":{"id":2964205,"sourceID":2964238,"targetID":2964231}},"unconditionalConnectors":{"2964240":{"id":2964240,"sourceID":2964237,"targetID":2964225},"2964241":{"id":2964241,"sourceID":2964237,"targetID":2964233},"2964242":{"id":2964242,"sourceID":2964232,"targetID":2964234},"2964243":{"id":2964243,"sourceID":2964237,"targetID":2964178},"2964246":{"id":2964246,"sourceID":2964231,"targetID":2964229}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{"2964179":{"id":2964179,"x":-394,"y":-281,"width":91,"height":90,"text":"for development","colour":"d60000"}},"variables":{"Consolidated_table":{"definition":{"name":"Consolidated_table","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"consolidated_pnl"},"Item_name":{"definition":{"name":"Item_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"'Return Fee'"},"Month_iterator":{"definition":{"name":"Month_iterator","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"Pnl_schema":{"definition":{"name":"Pnl_schema","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"edw"},"Target_table":{"definition":{"name":"Target_table","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"return_fee"}},"grids":{"Months":{"definition":{"name":"Months","scope":"BRANCH","definitions":[{"name":"Month","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[]}}},"info":{"name":"pnl_init_return_fee","description":"Initialization of Item in PnL Report schema and load all data incl historical","type":"ORCHESTRATION","tag":"cf76e130-edf9-4cff-bbef-d8c69398cf49"}}