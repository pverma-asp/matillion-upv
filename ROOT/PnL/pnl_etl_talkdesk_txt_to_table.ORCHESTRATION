{"job":{"components":{"2962770":{"id":2962770,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-400,"y":-16,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2962827],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962828":{"id":2962828,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-144,"y":-96,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DELETE FROM TABLE"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DELETE FROM ${schema_name}.${table_name}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962829":{"id":2962829,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":80,"y":-16,"width":32,"height":32,"inputConnectorIDs":[2962830],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INSERT INTO TABLE"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INSERT INTO ${schema_name}.${table_name}(flag_processed,\n                                        credit_start_date,\n                                        credit_end_date,\n                                        credit_amount,\n                                        enterprise_start_date,\n                                        enterprise_end_date,\n                                        enterprise_amount)\n\nVALUES (\n  FALSE,\n  TO_DATE(TO_CHAR(${credit_start_date}, 'FM99999999'), 'YYYYMMDD'),\n  TO_DATE(TO_CHAR(${credit_end_date}, 'FM99999999'), 'YYYYMMDD'),\n  ${credit_amount},\n  TO_DATE(TO_CHAR(${enterprise_start_date}, 'FM99999999'), 'YYYYMMDD'),\n  TO_DATE(TO_CHAR(${enterprise_end_date}, 'FM99999999'), 'YYYYMMDD'),\n  ${enterprise_amount});\n\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962831":{"id":2962831,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-32,"y":-96,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DROP TABLE"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DROP TABLE ${schema_name}.${table_name}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962848":{"id":2962848,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-80,"y":96,"width":32,"height":32,"inputConnectorIDs":[2962824],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Grant Select access to created table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"GRANT SELECT ON edw.${table_name} TO \"spashchenko.ctr\";\nGRANT SELECT ON edw.${table_name} TO \"ashumakov.ctr\";\nGRANT SELECT ON edw.${table_name} TO \"vfigurkin.ctr\";\nGRANT SELECT ON edw.${table_name} TO \"opetrova.ctr\";\nGRANT SELECT ON edw.${table_name} TO \"idudkin.ctr\";\nGRANT SELECT ON edw.${table_name} TO \"spashchenko.ctr\";\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962849":{"id":2962849,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-240,"y":-16,"width":32,"height":32,"inputConnectorIDs":[2962827],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2962824,2962825],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE IF NOT EXISTS ${schema_name}.${table_name}(id bigint identity(1, 1),\n                                                       flag_processed bool not null,\n                                                       credit_start_date date not null,\n                                                       credit_end_date date not null,\n                                                       credit_amount numeric(38,8) not null,\n                                                       enterprise_start_date date not null,\n                                                       enterprise_end_date date not null,\n                                                       enterprise_amount numeric(38,8) not null);"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962850":{"id":2962850,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-80,"y":-16,"width":32,"height":32,"inputConnectorIDs":[2962825],"outputSuccessConnectorIDs":[2962830],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"parse Talkdesk txt"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import boto3\nimport re\n\nbucket = s3_bucket\nfile_name = txt_file_name\n\ns3 = boto3.resource('s3')\nobject = s3.Object(bucket, file_name)\ntext = object.get()[\"Body\"].read()\nmonths = {'Jan':'01','Feb':'02','Mar':'03','Apr':'04','May':'05','Jun':'06','Jul':'07','Aug':'08','Sep':'09','Oct':'10','Nov':'11','Dec':'12'}\n\ndef parseDate(text_date):\n  lst = text_date.split(\".\")\n  date, year, month = \"\", \"\", \"\"\n  for x in lst:\n    if len(x) == 4: year += x\n    if len(x) == 3: month += months.get(x)\n    if len(x) == 2: date += x\n    if len(x) == 1: date += \"0\" + x \n  return year + month + date\n\nresult = re.findall(r'Semi-Annual Credit Commit;(\\d{2}\\.\\w{3}\\.\\d{4})(.*?)(\\d{2}\\.\\w{3}\\.\\d{4})', text)\ncontext.updateVariable('credit_start_date', parseDate(result[0][0]))\ncontext.updateVariable('credit_end_date', parseDate(result[0][2]))\n\nresult = re.findall(r'Annual Licenses - Enterprise;(\\d{2}\\.\\w{3}\\.\\d{4})(.*?)(\\d{2}\\.\\w{3}\\.\\d{4})', text)\ncontext.updateVariable('enterprise_start_date', parseDate(result[0][0]))\ncontext.updateVariable('enterprise_end_date', parseDate(result[0][2]))\n\nresult = re.findall(r'Semi-Annual Credit Commit;(.*?);(.*?);(.*?);(.*?);(.*?);(.*?);', text)\ncontext.updateVariable('credit_amount', result[-1][-1][1:].replace(\",\",\"\"))\n\nresult = re.findall(r'Annual Licenses - Enterprise;(.*?);(.*?);(.*?);(.*?);(.*?);(.*?);', text)\ncontext.updateVariable('enterprise_amount', result[-1][-1][1:].replace(\",\",\"\"))\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2962830":{"id":2962830,"sourceID":2962850,"targetID":2962829}},"failureConnectors":{},"unconditionalConnectors":{"2962824":{"id":2962824,"sourceID":2962849,"targetID":2962848},"2962825":{"id":2962825,"sourceID":2962849,"targetID":2962850},"2962827":{"id":2962827,"sourceID":2962770,"targetID":2962849}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{"2962771":{"id":2962771,"x":-231,"y":-131,"width":266,"height":72,"text":"dev","colour":"d60000"}},"variables":{"credit_amount":{"definition":{"name":"credit_amount","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"credit_end_date":{"definition":{"name":"credit_end_date","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"credit_start_date":{"definition":{"name":"credit_start_date","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"enterprise_amount":{"definition":{"name":"enterprise_amount","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"enterprise_end_date":{"definition":{"name":"enterprise_end_date","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"enterprise_start_date":{"definition":{"name":"enterprise_start_date","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"s3_bucket":{"definition":{"name":"s3_bucket","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"aspiration-pnl-project-staging"},"schema_name":{"definition":{"name":"schema_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"edw"},"table_name":{"definition":{"name":"table_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"etl_call_center_talkdesk"},"txt_file_name":{"definition":{"name":"txt_file_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null}},"grids":{}},"info":{"name":"pnl_etl_talkdesk_txt_to_table","description":"","type":"ORCHESTRATION","tag":"897d1292-03aa-42e8-827f-3ff369530611"}}