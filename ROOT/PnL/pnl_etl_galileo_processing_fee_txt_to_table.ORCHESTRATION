{"job":{"components":{"2963456":{"id":2963456,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":144,"y":112,"width":32,"height":32,"inputConnectorIDs":[2963486],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Grant SELECT access to created table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"GRANT SELECT ON ${schema_name}.${table_name} TO \"spashchenko.ctr\";\nGRANT SELECT ON ${schema_name}.${table_name} TO \"ashumakov.ctr\";\nGRANT SELECT ON ${schema_name}.${table_name} TO \"vfigurkin.ctr\";\nGRANT SELECT ON ${schema_name}.${table_name} TO \"opetrova.ctr\";\nGRANT SELECT ON ${schema_name}.${table_name} TO \"idudkin.ctr\";\nGRANT SELECT ON ${schema_name}.${table_name} TO \"spashchenko.ctr\";\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2963457":{"id":2963457,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-13,"y":-3,"width":32,"height":32,"inputConnectorIDs":[2963484],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2963486,2963487],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE IF NOT EXISTS ${schema_name}.${table_name}(id bigint identity(1, 1),\n                                   \t\t\t\t\t\tprocessing_month date not null,\n                                                        account_set_up numeric(38,8) not null,\n                                                        active_account_on_file numeric(38,8) not null,\n                                                        additional_transactions numeric(38,8) not null,\n                                                        active_savings_account numeric(38,8) not null,\n                                                        inactive_account_on_file numeric(38,8) not null,\n                                                        dispute_processing numeric(38,8) not null,\n                                                        fraud_analysis numeric(38,8) not null,\n                                                        subtotal numeric(38,8) not null);\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2963458":{"id":2963458,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":144,"y":-144,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DROP TABLE"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DROP TABLE ${schema_name}.${table_name}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2963459":{"id":2963459,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":304,"y":0,"width":32,"height":32,"inputConnectorIDs":[2963485],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INSERT INTO TABLE"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INSERT INTO ${schema_name}.${table_name}(processing_month,\n                                         account_set_up,\n                                         active_account_on_file,\n                                         additional_transactions,\n                                         active_savings_account,\n                                         inactive_account_on_file,\n                                         dispute_processing,\n                                         fraud_analysis,\n                                         subtotal)\nVALUES (\n  TO_DATE(TO_CHAR(${proc_month}, 'FM99999999'), 'YYYYMMDD'),\n  ${account_set_up},\n  ${active_account_on_file},\n  ${additional_transactions},\n  ${active_savings_account},\n  ${inactive_account_on_file},\n  ${dispute_processing},\n  ${fraud_analysis},\n  ${subtotal});\n\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2963462":{"id":2963462,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":144,"y":0,"width":32,"height":32,"inputConnectorIDs":[2963487],"outputSuccessConnectorIDs":[2963485],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"parse txt"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import boto3\nimport re\n\ns3 = boto3.resource('s3')\n#object = s3.Object(bucket_name, txt_file_name)\nobject = s3.Object(bucket_name, 'txt/galileo_processing_fees_aspiration_financial,_llcprocessing-sep-2019.txt')\ntext = object.get()[\"Body\"].read()\n\ndef parseDate(text_date):\n  lst = text_date.split(\"/\")\n  year, month, day = lst[2], lst[0], \"01\"\n  month = str(int(month) - 1)\n  if month == \"0\": \n    month = \"12\"\n    year = str(int(year)-1)\n  if len(month) == 1: month = \"0\" + month\n  return year + month + day\n\nresult = re.search(r'Due Date;(.*?);', text).group(1)\ncontext.updateVariable(\"proc_month\", parseDate(result))\nprint(proc_month)\n\nresult = re.search(r'Account Set Up;(.*?);(.*?);', text).group(2)[1:].replace(',','')\ncontext.updateVariable(\"account_set_up\", result)\nprint(account_set_up)\n\nresult = re.search(r'Active Account on File;(.*?);(.*?);', text).group(2)[1:].replace(',','')\ncontext.updateVariable(\"active_account_on_file\", result)\nprint(active_account_on_file)\n\nresult = re.search(r'Additional Transactions;(.*?);(.*?);', text).group(2)[1:].replace(',','')\ncontext.updateVariable(\"additional_transactions\", result)\nprint(additional_transactions)\n\nresult = re.search(r'Active Savings Account(.*?);(.*?);(.*?);', text).group(3)[1:].replace(',','')\ncontext.updateVariable(\"active_savings_account\", result)\nprint(active_savings_account)\n\nresult = re.search(r'Inactive Account on File;(.*?);(.*?);', text).group(2)[1:].replace(',','')\ncontext.updateVariable(\"inactive_account_on_file\", result)\nprint(inactive_account_on_file)\n\nresult = re.search(r';Dispute Processing;(.*?);(.*?);', text).group(2)[1:].replace(',','')\ncontext.updateVariable(\"dispute_processing\", result)\nprint(dispute_processing)\n\nresult = re.search(r'Fraud Analysis(.*?);(.*?);(.*?);', text).group(3)[1:].replace(',','')\ncontext.updateVariable(\"fraud_analysis\", result)\nprint(fraud_analysis)\n\nresult = re.findall(r';SUBTOTAL;(.*?);', text)[1][1:].replace(',','')\ncontext.updateVariable(\"subtotal\", result)\nprint(subtotal)\n\n#date = \"\"\n#year = \"\"\n#for x in lst:\n#  if len(x) < 2: x = \"0\" + x\n#  if len(x) < 4: date += x\n#  else: year += x\n#date = year + date\n\n\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2963463":{"id":2963463,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-144,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2963484],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2963485":{"id":2963485,"sourceID":2963462,"targetID":2963459}},"failureConnectors":{},"unconditionalConnectors":{"2963484":{"id":2963484,"sourceID":2963463,"targetID":2963457},"2963486":{"id":2963486,"sourceID":2963457,"targetID":2963456},"2963487":{"id":2963487,"sourceID":2963457,"targetID":2963462}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{"2963460":{"id":2963460,"x":77,"y":-170,"width":109,"height":70,"text":"dev","colour":"d60000"}},"variables":{"account_set_up":{"definition":{"name":"account_set_up","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"active_account_on_file":{"definition":{"name":"active_account_on_file","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"active_savings_account":{"definition":{"name":"active_savings_account","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"additional_transactions":{"definition":{"name":"additional_transactions","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"bucket_name":{"definition":{"name":"bucket_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"aspiration-pnl-project-staging"},"dispute_processing":{"definition":{"name":"dispute_processing","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"fraud_analysis":{"definition":{"name":"fraud_analysis","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"inactive_account_on_file":{"definition":{"name":"inactive_account_on_file","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"proc_month":{"definition":{"name":"proc_month","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"schema_name":{"definition":{"name":"schema_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"edw"},"subtotal":{"definition":{"name":"subtotal","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"table_name":{"definition":{"name":"table_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"etl_galileo_processing_fee"},"txt_file_name":{"definition":{"name":"txt_file_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null}},"grids":{}},"info":{"name":"pnl_etl_galileo_processing_fee_txt_to_table","description":"","type":"ORCHESTRATION","tag":"9088e79b-4769-4900-8cfe-c6336975c4a8"}}