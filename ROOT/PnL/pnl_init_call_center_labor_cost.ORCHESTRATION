{"job":{"components":{"2964032":{"id":2964032,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"ITERATE","implementationID":-424773870,"x":-1168,"y":-272,"width":32,"height":16,"inputConnectorIDs":[2964075],"outputSuccessConnectorIDs":[2964093],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Grid Iterator 0"}}}},"visible":true},"3":{"slot":3,"name":"Grid Variable","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Billed_month"}}}},"visible":true},"4":{"slot":4,"name":"Grid Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Billed_month"},"2":{"slot":2,"type":"STRING","value":"billed_month_iterator"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"end_date"},"2":{"slot":2,"type":"STRING","value":"billed_month_day_iterator"}}}},"visible":true},"5":{"slot":5,"name":"Break on Failure","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"6":{"slot":6,"name":"Concurrency","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Sequential"}}}},"visible":true},"999":{"slot":999,"name":"Record Values In Task History","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[2964061],"inputIterationConnectorIDs":[]},"2964033":{"id":2964033,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-1168,"y":-240,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_etl_parse_tymeshift_api"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_etl_parse_tymeshift_api"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Billed_month"},"2":{"slot":2,"type":"STRING","value":"${billed_month_iterator}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"end_day"},"2":{"slot":2,"type":"STRING","value":"${billed_month_day_iterator}"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[2964061]},"2964034":{"id":2964034,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-560,"y":-240,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Execution NonCust"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SET timezone TO 'America/Los_Angeles';\n\nINSERT INTO edw.${Target_table_n}(execution,\n                                                    crm_phone_number,\n                                                    crm_user_email,\n                                                    user_id,\n                                                    Non_customer,\n                                                    Category,\n                                                    Item,\n                                                    Date,\n                                                    Value,\n                                                    Value_type)\n\nWITH\n  month_dates AS (\n    SELECT DATE_TRUNC('month', DATEADD(month, -1, current_date))::date AS month_first_day,\n           LAST_DAY(month_first_day) AS month_last_day,\n           EXTRACT(day from month_last_day) AS days_in_month\n  ),\n\n  salaries AS (\n    SELECT assignee_id,\n           MIN(annual_salary)/52/40/60/60 AS salary_per_second\n    FROM edw.etl_call_center_labor_cost_wages\n    GROUP BY assignee_id\n  ),\n\n  tickets_grouped_by_ticket_id AS (\n    SELECT ticket_id, SUM(seconds) AS total_seconds, request_topic,\n           assignee_id, crm_user_email, crm_phone_number, MAX(updated_at) AS updated_at\n    FROM edw.call_center_labor_cost_activities\n    WHERE user_id IS NULL\n    GROUP BY ticket_id, assignee_id, request_topic, crm_user_email, crm_phone_number\n  ),\n\n  tickets_avg AS (\n    SELECT AVG(total_seconds) AS avg_ticket_time, assignee_id, request_topic\n    FROM tickets_grouped_by_ticket_id\n    GROUP BY assignee_id, request_topic\n    ORDER BY assignee_id\n  ),\n\n  ticket_costs AS (\n    SELECT t.assignee_id,\n           t.request_topic,\n           sal.salary_per_second * t.avg_ticket_time AS ticket_type_cost\n    FROM tickets_avg t\n           INNER JOIN salaries sal ON t.assignee_id = sal.assignee_id\n  ),\n\n  noncustomer_tickets AS (\n    SELECT crm_phone_number,\n           crm_user_email,\n           updated_at::date AS Date,\n           (-tc.ticket_type_cost) AS Value\n    FROM tickets_grouped_by_ticket_id t\n           INNER JOIN ticket_costs tc ON t.assignee_id = tc.assignee_id\n      AND (tc.request_topic = t.request_topic OR (tc.request_topic IS NULL AND t.request_topic IS NULL))\n  )\n\nSELECT getdate() AS execution,\n       crm_phone_number,\n       crm_user_email,\n       0 AS user_id,\n       TRUE AS Non_customer,\n       'Direct'::text AS Category,\n       'Call Center Labor Cost Noncustomers'::text AS Item,\n       Date,\n       Value,\n       'Cost'::text AS Value_type\nFROM noncustomer_tickets;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[2964082]},"2964035":{"id":2964035,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-688,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2964074],"outputSuccessConnectorIDs":[2964069],"outputFailureConnectorIDs":[2964080],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Create\\Truncate NonCust"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE IF NOT EXISTS edw.${Target_table_n}(id bigint identity(1, 1),\n                                                                   execution timestamp with time zone,\n                                                                   crm_phone_number varchar(2001),\n                                                                   crm_user_email varchar(2000),\n                                                \t\t\t\t   User_id bigint,\n                                                                   Account_id bigint,\n                                                               \t   Depository_id bigint,\n                                                                   Investment_id bigint,\n                                                                   Account_type varchar(50),\n                                                                   Product_type varchar(50),\n                                                                   Non_customer boolean, -- True for ZenDesk/False for others\n                                                                   Category varchar(50) not null,\n                                                                   Item varchar(50) not null,\n                                                                   Date timestamp with time zone,\n                                                                   Value numeric(38,8),\n                                                                   Value_type varchar(50),\n                                                                   primary key(id));\nTRUNCATE edw.${Target_table_n}\n\n\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964036":{"id":2964036,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-1296,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2964085],"outputSuccessConnectorIDs":[2964075],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Months"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\nimport datetime\nimport math\nfrom dateutil.relativedelta import relativedelta\n\nnow = datetime.datetime.today() \nstart = datetime.datetime(2019, 11, 1)\n\ndelta = now - start\n\nmonthslist = []\n\nmonthq = ((start.year - now.year) * 12 + start.month - now.month)\n\nprint(monthq)\n\ni = monthq\nwhile i < 0:\n monthslist.append([i])\n i = i + 1\ncontext.updateGridVariable('Months', monthslist)\nprint Months\n\n\ntotal_months = lambda dt: dt.month + 12 * dt.year\nmlist = []\n\nfor tot_m in xrange(total_months(start)-1, total_months(now)-1):\n y, m = divmod(tot_m, 12)\n day = int((datetime.datetime(y, m+1, 1)+ relativedelta(months=+1) - datetime.timedelta(1)).strftime(\"%d\"))\n month = datetime.datetime(y, m+1, 1).strftime(\"%Y%m%d\")\n while day > 0:\n  mlist.append([month,day])\n  day = day - 1\nlenl = len(mlist)\ncurend = now - datetime.timedelta(1)\n#mlist[lenl-1][1] = curend.strftime(\"%d\")\ncontext.updateGridVariable('Billed_month', mlist)  \nprint Billed_month\n\n\n\n\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964037":{"id":2964037,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-1616,"y":-160,"width":32,"height":32,"inputConnectorIDs":[2964084],"outputSuccessConnectorIDs":[2964070],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_init_view_accounts_termination_dates"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_init_view_accounts_termination_dates"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964038":{"id":2964038,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-1616,"y":-320,"width":32,"height":32,"inputConnectorIDs":[2964094],"outputSuccessConnectorIDs":[2964073],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_etl_call_center_labor_cost_wages"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_etl_call_center_labor_cost_wages"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964039":{"id":2964039,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"ITERATE","implementationID":-424773870,"x":-800,"y":-272,"width":32,"height":16,"inputConnectorIDs":[2964071],"outputSuccessConnectorIDs":[2964074],"outputFailureConnectorIDs":[2964083],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Copy of Grid Iterator 0"}}}},"visible":true},"3":{"slot":3,"name":"Grid Variable","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Months"}}}},"visible":true},"4":{"slot":4,"name":"Grid Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Month"},"2":{"slot":2,"type":"STRING","value":"Month_iterator"}}}},"visible":true},"5":{"slot":5,"name":"Break on Failure","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"6":{"slot":6,"name":"Concurrency","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Sequential"}}}},"visible":true},"999":{"slot":999,"name":"Record Values In Task History","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[2964060],"inputIterationConnectorIDs":[]},"2964040":{"id":2964040,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSACTION","implementationID":977205684,"x":-464,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2964078],"outputSuccessConnectorIDs":[2964067],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Commit 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964041":{"id":2964041,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSACTION","implementationID":-1540940111,"x":-864,"y":-448,"width":32,"height":32,"inputConnectorIDs":[2964089],"outputSuccessConnectorIDs":[2964064],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Rollback 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964042":{"id":2964042,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":515156205,"x":-800,"y":-448,"width":32,"height":32,"inputConnectorIDs":[2964064],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Failure 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964043":{"id":2964043,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":-864,"y":-384,"width":32,"height":32,"inputConnectorIDs":[2964080,2964081,2964083,2964086,2964087],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2964089],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Or 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964046":{"id":2964046,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSACTION","implementationID":-1785670938,"x":-1072,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2964093],"outputSuccessConnectorIDs":[2964068],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Begin 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964047":{"id":2964047,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-352,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2964067],"outputSuccessConnectorIDs":[2964072],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_init_consolidated_pnl Cust"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_init_consolidated_pnl"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Source_table"},"2":{"slot":2,"type":"STRING","value":"${Target_table}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"Item_name"},"2":{"slot":2,"type":"STRING","value":"${Item_name}"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964048":{"id":2964048,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-176,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2964072],"outputSuccessConnectorIDs":[2964092],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_init_consolidated_pnl NonCust"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_init_consolidated_pnl"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Source_table"},"2":{"slot":2,"type":"STRING","value":"${Target_table_n}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"Item_name"},"2":{"slot":2,"type":"STRING","value":"${Item_name_n}"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964049":{"id":2964049,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"ITERATE","implementationID":-424773870,"x":-560,"y":-272,"width":32,"height":16,"inputConnectorIDs":[2964069],"outputSuccessConnectorIDs":[2964078],"outputFailureConnectorIDs":[2964086],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Copy of Grid Iterator 0 (1)"}}}},"visible":true},"3":{"slot":3,"name":"Grid Variable","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Months"}}}},"visible":true},"4":{"slot":4,"name":"Grid Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Month"},"2":{"slot":2,"type":"STRING","value":"Month_iterator"}}}},"visible":true},"5":{"slot":5,"name":"Break on Failure","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"6":{"slot":6,"name":"Concurrency","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Sequential"}}}},"visible":true},"999":{"slot":999,"name":"Record Values In Task History","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[2964082],"inputIterationConnectorIDs":[]},"2964050":{"id":2964050,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-1408,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2964091],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2964085],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Truncate etl_tymeshift"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"                                              \nTRUNCATE edw.etl_call_center_tymeshift_ace_tickets"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964076":{"id":2964076,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-1616,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2964090],"outputSuccessConnectorIDs":[2964065],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_init_view_unique_user_accounts"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_init_view_unique_user_accounts"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964077":{"id":2964077,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-912,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2964066],"outputSuccessConnectorIDs":[2964071],"outputFailureConnectorIDs":[2964087],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Create\\Truncate Cust"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE IF NOT EXISTS edw.${Target_table}(id bigint identity(1, 1),\n                                                                 execution timestamp with time zone,\n                                                                 User_id bigint not null,\n                                                                 Account_id bigint,\n                                                                 Depository_id bigint,\n                                                                 Investment_id bigint,\n                                                                 Account_type varchar(50),\n                                                                 Product_type varchar(50),\n--                                                                  Account_product_type_id int, --account.product_type\n--                                                                  Account_product_type_name varchar(50), --1 = investment, 2 = depository\n--                                                                  Account_product_id int, --<depository.product_id>\n--                                                                  Account_product_name varchar(50), --3 = Summit , 4 = Spend, 5 = Save\n--                                                                  Account_type_id int, --<account.account_type_id>\n--                                                                  Account_type_name varchar(50), --2 = Individual, 3 = IRA\n--                                                                  Account_investment_type_id int, --<investment.fund_id>\n--                                                                  Account_investment_type_name varchar(50), --1 = Flagship, 2 = Redwood\n                                                                 Non_customer boolean, -- True for ZenDesk/False for others\n                                                                 Category varchar(50) not null,\n                                                                 Item varchar(50) not null,\n                                                                 Date timestamp with time zone,\n                                                                 Value numeric(38,8),\n                                                                 Value_type varchar(50),\n                                                                 primary key(id));\n                                                \nTRUNCATE edw.${Target_table}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964079":{"id":2964079,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":235671163,"x":-1504,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2964065,2964070,2964073,2964095],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2964091],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964096":{"id":2964096,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-1728,"y":-240,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2964084,2964088,2964090,2964094],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964097":{"id":2964097,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-1616,"y":-448,"width":32,"height":32,"inputConnectorIDs":[2964088],"outputSuccessConnectorIDs":[2964095],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_etl_tymeshift_agents_list 0"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_etl_tymeshift_agents_list"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964098":{"id":2964098,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-48,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2964092],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"TMP"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"GRANT SELECT ON ${Pnl_schema}.${Target_table} TO \"spashchenko.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Target_table} TO \"ashumakov.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Target_table} TO \"vfigurkin.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Target_table} TO \"opetrova.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Target_table} TO \"idudkin.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Consolidated_table} TO \"spashchenko.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Consolidated_table} TO \"ashumakov.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Consolidated_table} TO \"vfigurkin.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Consolidated_table} TO \"opetrova.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Consolidated_table} TO \"idudkin.ctr\";\n\n---drop table edw.${Target_table_n}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964099":{"id":2964099,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-800,"y":-240,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Execution Cust"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SET timezone TO 'America/Los_Angeles';\n\nINSERT INTO edw.${Target_table}(execution,\n                                                 User_id,\n                                                 Non_customer,\n                                                 Category,\n                                                 Item,\n                                                 Date,\n                                                 Value,\n                                                 Value_type)\n\nWITH\n  month_dates AS (\n    SELECT DATE_TRUNC('month', DATEADD(month, ${Month_iterator}, current_date))::date AS month_first_day,\n           LAST_DAY(month_first_day) AS month_last_day,\n           EXTRACT(day from month_last_day) AS days_in_month\n  ),\n\n  salaries AS (\n    SELECT assignee_id,\n           MIN(annual_salary)/52/40/60/60 AS salary_per_second\n    FROM edw.etl_call_center_labor_cost_wages\n    GROUP BY assignee_id\n  ),\n\n  tickets_grouped_by_ticket_id AS (\n    SELECT ticket_id, SUM(seconds) AS total_seconds, request_topic,\n           assignee_id, user_id, MAX(updated_at) AS updated_at\n    FROM edw.call_center_labor_cost_activities\n    GROUP BY ticket_id, assignee_id, request_topic, user_id\n  ),\n\n  tickets_avg AS (\n    SELECT AVG(total_seconds) AS avg_ticket_time, assignee_id, request_topic\n    FROM tickets_grouped_by_ticket_id\n    GROUP BY assignee_id, request_topic\n    ORDER BY assignee_id\n  ),\n\n  ticket_costs AS (\n    SELECT t.assignee_id,\n           t.request_topic,\n           sal.salary_per_second * t.avg_ticket_time AS ticket_type_cost\n    FROM tickets_avg t\n           INNER JOIN salaries sal ON t.assignee_id = sal.assignee_id\n  ),\n\n  customers_tickets AS (\n    SELECT user_id,\n           updated_at::date AS Date,\n           SUM(-tc.ticket_type_cost) AS Value\n    FROM tickets_grouped_by_ticket_id t\n           INNER JOIN ticket_costs tc ON t.assignee_id = tc.assignee_id\n      AND (tc.request_topic = t.request_topic OR (tc.request_topic IS NULL AND t.request_topic IS NULL))\n    WHERE t.user_id IS NOT NULL\n    GROUP BY t.user_id, Date\n  )\n\nSELECT getdate() AS execution,\n       User_id,\n       FALSE AS Non_customer,\n       'Direct'::text AS Category,\n       'Call Center Labor Cost Customers'::text AS Item,\n       Date,\n       Value,\n       'Cost'::text AS Value_type\nFROM customers_tickets;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[2964060]},"2964100":{"id":2964100,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-992,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2964068],"outputSuccessConnectorIDs":[2964066],"outputFailureConnectorIDs":[2964081],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"LC Act"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SET timezone TO 'America/Los_Angeles';\n\nCREATE TABLE IF NOT EXISTS edw.call_center_labor_cost_activities(ticket_id numeric(20),\n                                                                 act_date date,\n                                                                 seconds bigint,\n                                                                 username varchar(100),\n                                                                 assignee_id varchar(100),\n                                                                 updated_at date,\n                                                                 request_topic varchar(100),\n                                                                 user_id bigint,\n                                                                 crm_phone_number varchar(100),\n                                                                 crm_user_email varchar(100));\n\nDELETE FROM edw.call_center_labor_cost_activities;\n\nINSERT INTO edw.call_center_labor_cost_activities\n\nWITH\n\n  month_dates AS (\n    SELECT DATE_TRUNC('month', DATEADD(month, -1, current_date))::date AS month_first_day,\n           LAST_DAY(month_first_day) AS month_last_day,\n           EXTRACT(day from month_last_day) AS days_in_month\n  ),\n\n  tickets AS (\n    SELECT t.zend_nice_id::numeric(20) AS ticket_id, TO_DATE(t.ticket_date, 'YYYYMMDD') AS act_date,\n           t.seconds::bigint, t.username, al.user_id AS assignee_id,\n           (SELECT t.updated_at::date FROM bi.dt_ace_tickets t WHERE t.ticket_id = zend_nice_id\n             AND (t.updated_at <= act_date AND t.updated_at > act_date - 30)) AS updated_at,\n           (SELECT t.request_topic FROM bi.dt_ace_tickets t WHERE t.ticket_id = zend_nice_id\n             AND (t.updated_at <= act_date AND t.updated_at > act_date - 30)) AS request_topic,\n           (SELECT t.user_id::bigint FROM bi.dt_ace_tickets t WHERE t.ticket_id = zend_nice_id\n             AND (t.updated_at <= act_date AND t.updated_at > act_date - 30)) AS user_id,\n           (SELECT t.crm_phone_number FROM bi.dt_ace_tickets t WHERE t.ticket_id = zend_nice_id\n             AND (t.updated_at <= act_date AND t.updated_at > act_date - 30)) AS crm_phone_number,\n           (SELECT t.crm_user_email FROM bi.dt_ace_tickets t WHERE t.ticket_id = zend_nice_id\n             AND (t.updated_at <= act_date AND t.updated_at > act_date - 30)) AS crm_user_email\n    FROM edw.etl_call_center_tymeshift_ace_tickets t\n           INNER JOIN edw.etl_call_center_zendesk_agents_list al ON t.username = al.username\n    WHERE DATE_TRUNC('month', act_date) = (SELECT month_first_day FROM month_dates)\n  )\n\nSELECT * FROM tickets WHERE updated_at IS NOT NULL;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2964064":{"id":2964064,"sourceID":2964041,"targetID":2964042},"2964065":{"id":2964065,"sourceID":2964076,"targetID":2964079},"2964066":{"id":2964066,"sourceID":2964100,"targetID":2964077},"2964067":{"id":2964067,"sourceID":2964040,"targetID":2964047},"2964068":{"id":2964068,"sourceID":2964046,"targetID":2964100},"2964069":{"id":2964069,"sourceID":2964035,"targetID":2964049},"2964070":{"id":2964070,"sourceID":2964037,"targetID":2964079},"2964071":{"id":2964071,"sourceID":2964077,"targetID":2964039},"2964072":{"id":2964072,"sourceID":2964047,"targetID":2964048},"2964073":{"id":2964073,"sourceID":2964038,"targetID":2964079},"2964074":{"id":2964074,"sourceID":2964039,"targetID":2964035},"2964075":{"id":2964075,"sourceID":2964036,"targetID":2964032},"2964078":{"id":2964078,"sourceID":2964049,"targetID":2964040},"2964092":{"id":2964092,"sourceID":2964048,"targetID":2964098},"2964093":{"id":2964093,"sourceID":2964032,"targetID":2964046},"2964095":{"id":2964095,"sourceID":2964097,"targetID":2964079}},"failureConnectors":{"2964080":{"id":2964080,"sourceID":2964035,"targetID":2964043},"2964081":{"id":2964081,"sourceID":2964100,"targetID":2964043},"2964083":{"id":2964083,"sourceID":2964039,"targetID":2964043},"2964086":{"id":2964086,"sourceID":2964049,"targetID":2964043},"2964087":{"id":2964087,"sourceID":2964077,"targetID":2964043}},"unconditionalConnectors":{"2964084":{"id":2964084,"sourceID":2964096,"targetID":2964037},"2964085":{"id":2964085,"sourceID":2964050,"targetID":2964036},"2964088":{"id":2964088,"sourceID":2964096,"targetID":2964097},"2964089":{"id":2964089,"sourceID":2964043,"targetID":2964041},"2964090":{"id":2964090,"sourceID":2964096,"targetID":2964076},"2964091":{"id":2964091,"sourceID":2964079,"targetID":2964050},"2964094":{"id":2964094,"sourceID":2964096,"targetID":2964038}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{"2964060":{"id":2964060,"sourceID":2964039,"targetID":2964099},"2964061":{"id":2964061,"sourceID":2964032,"targetID":2964033},"2964082":{"id":2964082,"sourceID":2964049,"targetID":2964034}},"noteConnectors":{},"notes":{"2964018":{"id":2964018,"x":-84,"y":-282,"width":91,"height":90,"text":"for development","colour":"d60000"},"2964044":{"id":2964044,"x":-1712,"y":-496,"width":257,"height":99,"text":"Activate when agent API issue will be fixed(by Tymeshift support)","colour":"e6e63c"},"2964045":{"id":2964045,"x":-1330,"y":-328,"width":72,"height":139,"text":"now only -1 month","colour":"d60000"}},"variables":{"Consolidated_table":{"definition":{"name":"Consolidated_table","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"consolidated_pnl"},"Day":{"definition":{"name":"Day","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"Item_name":{"definition":{"name":"Item_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"'Call Center Labor Cost Customers'"},"Item_name_n":{"definition":{"name":"Item_name_n","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"'Call Center Labor Cost Noncustomers'"},"Month_iterator":{"definition":{"name":"Month_iterator","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"Pnl_schema":{"definition":{"name":"Pnl_schema","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"edw"},"Target_table":{"definition":{"name":"Target_table","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"call_center_labor_cost_customers"},"Target_table_n":{"definition":{"name":"Target_table_n","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"call_center_labor_cost_noncustomers"},"billed_month_day_iterator":{"definition":{"name":"billed_month_day_iterator","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"billed_month_iterator":{"definition":{"name":"billed_month_iterator","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""}},"grids":{"Billed_month":{"definition":{"name":"Billed_month","scope":"BRANCH","definitions":[{"name":"Billed_month","type":"TEXT"},{"name":"end_date","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[]},"Days_in_billed_month":{"definition":{"name":"Days_in_billed_month","scope":"BRANCH","definitions":[{"name":"Day","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[]},"Months":{"definition":{"name":"Months","scope":"BRANCH","definitions":[{"name":"Month","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[]}}},"info":{"name":"pnl_init_call_center_labor_cost","description":"Initialization of Item in PnL Report schema and load all data incl historical","type":"ORCHESTRATION","tag":"fabbba43-289c-427f-b660-7f9d50a629be"}}