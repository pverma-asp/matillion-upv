{"job":{"components":{"2963008":{"id":2963008,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"ITERATE","implementationID":-424773870,"x":-816,"y":-272,"width":32,"height":16,"inputConnectorIDs":[2963029],"outputSuccessConnectorIDs":[2963031],"outputFailureConnectorIDs":[2963084],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Grid Iterator 0"}}}},"visible":true},"3":{"slot":3,"name":"Grid Variable","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Quarters"}}}},"visible":true},"4":{"slot":4,"name":"Grid Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Quarter"},"2":{"slot":2,"type":"STRING","value":"Quarter_iterator"}}}},"visible":true},"5":{"slot":5,"name":"Break on Failure","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"6":{"slot":6,"name":"Concurrency","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Sequential"}}}},"visible":true},"999":{"slot":999,"name":"Record Values In Task History","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[2963087],"inputIterationConnectorIDs":[]},"2963009":{"id":2963009,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-1088,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2963030],"outputSuccessConnectorIDs":[2963034],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Quarters"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\nimport datetime\nimport math\n\nnow = datetime.datetime.today() \nstart = datetime.datetime(2015, 1, 1)\n\ndelta = now - start\n\nquarterslist = []\n\nquartq = math.trunc(float((start.year - now.year) * 12 + start.month - now.month)/3)\n\nprint(quartq)\n\ni = quartq + 1\nwhile i < 0:\n quarterslist.append([i])\n i = i + 1\ncontext.updateGridVariable('Quarters', quarterslist)\nprint Quarters\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2963010":{"id":2963010,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-1295,"y":-340,"width":32,"height":32,"inputConnectorIDs":[2963026],"outputSuccessConnectorIDs":[2963033],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_exec_gross_investment_pwif"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_exec_gross_investment_pwif"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2963011":{"id":2963011,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-416,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2963038],"outputSuccessConnectorIDs":[2963032],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_exec_billed_investment_pwif"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_exec_billed_investment_pwif"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2963012":{"id":2963012,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":-864,"y":-112,"width":32,"height":32,"inputConnectorIDs":[2963084,2963085],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2963024],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Or 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2963013":{"id":2963013,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSACTION","implementationID":977205684,"x":-708,"y":-237,"width":32,"height":32,"inputConnectorIDs":[2963031],"outputSuccessConnectorIDs":[2963035],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Commit 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2963014":{"id":2963014,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-1296,"y":-160,"width":32,"height":32,"inputConnectorIDs":[2963025],"outputSuccessConnectorIDs":[2963028],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_init_view_accounts_termination_dates"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_init_view_accounts_termination_dates"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2963015":{"id":2963015,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":515156205,"x":-657,"y":-112,"width":32,"height":32,"inputConnectorIDs":[2963037],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Failure 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2963016":{"id":2963016,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-576,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2963035],"outputSuccessConnectorIDs":[2963038],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_init_consolidated_pnl"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_init_consolidated_pnl"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Source_table"},"2":{"slot":2,"type":"STRING","value":"${Target_table}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"Item_name"},"2":{"slot":2,"type":"STRING","value":"${Item_name}"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2963017":{"id":2963017,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":235671163,"x":-1168,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2963028,2963033,2963036],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2963030],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2963018":{"id":2963018,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSACTION","implementationID":-1540940111,"x":-752,"y":-112,"width":32,"height":32,"inputConnectorIDs":[2963024],"outputSuccessConnectorIDs":[2963037],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Rollback 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2963019":{"id":2963019,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSACTION","implementationID":-1785670938,"x":-1008,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2963034],"outputSuccessConnectorIDs":[2963039],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Begin 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2963020":{"id":2963020,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-272,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2963032],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"TMP"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"GRANT SELECT ON ${Pnl_schema}.${Target_table} TO \"spashchenko.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Target_table} TO \"ashumakov.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Target_table} TO \"vfigurkin.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Target_table} TO \"opetrova.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Target_table} TO \"idudkin.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Consolidated_table} TO \"spashchenko.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Consolidated_table} TO \"ashumakov.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Consolidated_table} TO \"vfigurkin.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Consolidated_table} TO \"opetrova.ctr\";\nGRANT SELECT ON ${Pnl_schema}.${Consolidated_table} TO \"idudkin.ctr\";"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2963021":{"id":2963021,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-816,"y":-240,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Execution"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SET timezone = 'America/Los_Angeles';\n\nINSERT INTO edw.${Target_table}(execution,\n                                        User_id,\n                                        Account_id,\n                                        Depository_id,\n                                        Investment_id,\n                                        Account_type,\n                                        Product_type,\n--                                         Account_product_type_id,\n--                                         Account_product_type_name,\n--                                         Account_type_id,\n--                                         Account_type_name,\n--                                         Account_investment_type_id,\n--                                         Account_investment_type_name,\n                                        Non_customer,\n                                        Category,\n                                        Item,\n                                        Date,\n                                        Value,\n                                        Value_type,\n                                        Released_value)\n\nWITH\n  quarter_dates AS (\n    SELECT DATE_TRUNC(quarter, DATEADD(quarter, ${Quarter_iterator}, current_date)) AS cur_quart_first,\n           DATE_TRUNC(quarter, DATEADD(quarter, -1, cur_quart_first)) AS prev_quart_first,\n           cur_quart_first - 1 AS prev_quart_last,\n           DATE_TRUNC(year, DATEADD(quarter, 4, cur_quart_first)) AS prev_quart_next_year,\n           DATEDIFF(day, DATE_TRUNC(year, prev_quart_first), prev_quart_next_year) AS days_in_year\n  ),\n\n  real_fees AS (\n    SELECT investment_id, SUM(fee_amount) AS fee_amount\n    FROM web_db.investment_fee AS fees\n    WHERE DATE_TRUNC(quarter, fees.last_updated) =\n          DATE_TRUNC(quarter, (SELECT cur_quart_first FROM quarter_dates))\n    GROUP BY investment_id\n  ),\n\n  list_of_investments AS (\n    SELECT DISTINCT id AS Investment_id\n    FROM web_db.investment\n    ORDER BY id DESC\n  ),\n\n  date_gen AS (\n    SELECT DATEADD('day', i.i - 1, DATE_TRUNC(quarter, (SELECT prev_quart_first FROM quarter_dates) - 1)) AS Date\n    FROM (\n           SELECT ROW_NUMBER() OVER(ORDER BY SEQ4()) i\n           FROM TABLE (\n                GENERATOR(\n                        ROWCOUNT => 200\n                    )\n               )\n         ) i\n    WHERE DATE_TRUNC(quarter, Date) < (SELECT cur_quart_first FROM quarter_dates)\n  ),\n\n  investments_accounts_all_dates AS (\n    SELECT Investment_id, qd.Date::date iaad_date FROM list_of_investments\n                                                    CROSS JOIN date_gen qd\n  ),\n\n  current_balances AS (\n    SELECT investment_id, current_value, last_updated::date cb_last_updated\n    FROM web_db.investment_position\n    WHERE DATE_TRUNC(quarter, last_updated) >= DATE_TRUNC(quarter, (SELECT prev_quart_first FROM quarter_dates) - 1)\n      AND DATE_TRUNC(quarter, last_updated) < DATE_TRUNC(quarter, (SELECT cur_quart_first FROM quarter_dates))\n    ORDER BY investment_id, last_updated\n  ),\n\n  combined AS (\n    SELECT ad.Investment_id, current_value, cb_last_updated as last_updated, ad.iaad_date AS Date\n    FROM current_balances cb\n           RIGHT JOIN investments_accounts_all_dates ad\n                      ON ad.iaad_date = cb.cb_last_updated AND ad.Investment_id = cb.investment_id\n    ORDER BY ad.Investment_id, ad.iaad_date\n  ),\n\n  combined_with_filled_values AS (\n    SELECT Investment_id,\n           (CASE\n              WHEN combined.current_value IS NULL\n                THEN FIRST_VALUE(combined.current_value::float IGNORE NULLS) OVER\n                (PARTITION BY Investment_id ORDER BY Date DESC, Investment_id DESC\n                ROWS BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING)\n              WHEN combined.current_value IS NOT NULL\n                THEN combined.current_value::float END) AS cb_last,\n           Date\n    FROM combined\n    ORDER BY Investment_id, Date\n  ),\n\n  balances_last_quarter AS (\n    SELECT Investment_id, cb_last, Date\n    FROM combined_with_filled_values\n    WHERE DATE_TRUNC(quarter, Date) = (SELECT prev_quart_first FROM quarter_dates)\n  ),\n\n  sums_last_quarter AS (\n    SELECT Investment_id, SUM(cb_last) AS quarter_sum\n    FROM balances_last_quarter\n    GROUP BY Investment_id\n  ),\n\n  real_fees_by_pct AS (\n    SELECT b.Investment_id,\n           b.cb_last AS balance,\n           s.quarter_sum AS balance_quarter_sum,\n           (CASE WHEN s.quarter_sum = 0 THEN 0\n                 ELSE b.cb_last * 100 / quarter_sum END) AS day_pct,\n           r.fee_amount AS quarter_fee,\n           r.fee_amount * day_pct / 100 AS daily_fee,\n           b.Date::date rfbp_date\n    FROM balances_last_quarter b\n           INNER JOIN sums_last_quarter s ON s.Investment_id = b.Investment_id\n           INNER JOIN real_fees r ON r.investment_id = b.Investment_id\n  ),\n\n  projected_fee AS (\n    SELECT inv.Investment_id,\n           inv.Value AS projected_daily_fee,\n           inv.Date::date pf_date\n    FROM edw.gross_investment_pwif inv\n    WHERE DATE_TRUNC(quarter, inv.date) = (SELECT prev_quart_first FROM quarter_dates)\n  ),\n\n  delta_inv_pwif AS (\n    SELECT\n      acc.id AS Account_id,\n      p.Investment_id AS Investment_id,\n      r.daily_fee,\n      p.projected_daily_fee,\n      (CASE WHEN r.daily_fee IS NULL THEN projected_daily_fee\n            ELSE projected_daily_fee - daily_fee END) AS daily_delta_amount,\n      p.pf_date as date\n\n    FROM projected_fee p\n           LEFT JOIN real_fees_by_pct r ON p.Investment_id = r.Investment_id AND p.pf_date = r.rfbp_date\n           INNER JOIN web_db.investment inv ON inv.id = p.Investment_id\n           INNER JOIN web_db.account acc ON acc.id = inv.account_id\n  ),\n\n  investment_pwif_release AS (\n    SELECT current_date() AS execution,\n           ua.user_id AS User_id,\n           del.Account_id,\n           del.Investment_id AS Investment_id,\n           'Investment'::text AS Account_type,\n           (CASE\n              WHEN Account_type_id = 2 -- 'Individual'\n                AND inv.fund_id = 1 -- 'Flagship'\n                THEN 'Flagship Individual'::text\n              WHEN Account_type_id = 2 -- 'Individual'\n                AND inv.fund_id = 2 -- 'Redwood'\n                THEN 'Redwood Individual'::text\n              WHEN Account_type_id = 3 -- 'IRA'\n                AND inv.fund_id = 1 -- 'Flagship'\n                THEN 'Flagship IRA'::text\n              WHEN Account_type_id = 3 -- 'IRA'\n                AND inv.fund_id = 2 -- 'Redwood'\n                THEN 'Redwood IRA'::text\n              ELSE ''::text\n             END) AS Product_type,\n\n--            acc.product_type AS Account_product_type_id,\n--            'Investment'::text AS Account_product_type_name,\n--            acc.account_type_id AS Account_type_id,\n--            (CASE\n--               WHEN Account_type_id = 2 THEN 'Individual'::text\n--               WHEN Account_type_id = 3 THEN 'IRA'::text\n--               ELSE ''\n--              END) AS Account_type_name,\n--            inv.fund_id AS Account_investment_type_id,\n--            (CASE\n--               WHEN Account_investment_type_id = 1 THEN 'Flagship'::text\n--               WHEN Account_investment_type_id = 2 THEN 'Redwood'::text\n--               ELSE ''\n--              END) AS Account_investment_type_name,\n           FALSE AS Non_customer,\n           'Direct'::text AS Category,\n           'Billed Investment PWIF'::text AS Item,\n           del.Date AS Date,\n           -daily_delta_amount As Released_value,\n           'Revenue'::text AS Value_type,\n           (CASE WHEN daily_fee IS NULL THEN 0\n                 ELSE daily_fee END) AS Value\n\n    FROM delta_inv_pwif AS del\n           INNER JOIN web_db.account AS acc ON acc.id = del.Account_id\n           INNER JOIN web_db.investment AS inv ON inv.id = del.Investment_id\n           INNER JOIN web_db.user_account AS ua ON ua.account_id = acc.id\n  )\n\nSELECT execution, User_id, Account_id, NULL AS Depository_id, Investment_id,\n       Account_type, Product_type,\n--        Account_product_type_id, Account_product_type_name,\n--        Account_type_id, Account_type_name, Account_investment_type_id, Account_investment_type_name,\n       Non_customer, Category, Item, Date, Value, Value_type, Released_value\n\nFROM investment_pwif_release;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[2963087]},"2963022":{"id":2963022,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-1296,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2963027],"outputSuccessConnectorIDs":[2963036],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_init_view_unique_user_accounts"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnl_init_view_unique_user_accounts"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2963023":{"id":2963023,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-928,"y":-240,"width":32,"height":32,"inputConnectorIDs":[2963039],"outputSuccessConnectorIDs":[2963029],"outputFailureConnectorIDs":[2963085],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Create\\Truncate"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE IF NOT EXISTS edw.${Target_table}(\n                                                        id bigint identity(1, 1),\n                                                        execution timestamp with time zone,\n                                                        User_id bigint not null,\n                                                        Account_id bigint not null,\n                                                        Depository_id bigint,\n                                                        Investment_id bigint,\n  \t\t\t\t\t\t\t\t\t\t\t \t\t\tAccount_type varchar(50),\n    \t\t\t\t\t\t\t\t\t\t \t\t\tProduct_type  varchar(50),\n                                                        --Account_product_type_id int, -- account.product_type\n                                                        --Account_product_type_name varchar(50), -- 1 = Investment, 2 = Depository\n                                                        --Account_product_id int, --<depository.product_id>\n                                                        --Account_product_name varchar(50), --3 = Summit , 4 = Spend, 5 = Save\n                                                        --Account_type_id int, --<account.account_type_id>\n                                                        --Account_type_name varchar(50), -- 2 = Individual, 3 = IRA\n                                                        --Account_investment_type_id int, -- <investment.fund_id>\n                                                        --Account_investment_type_name varchar(50), -- 1 = Flagship, 2 = Redwood\n                                                        Non_customer boolean not null, -- True for ZenDesk/False for others\n                                                        Category varchar(50) not null,\n                                                        Item varchar(50) not null,\n                                                        Date timestamp with time zone,\n                                                        Value numeric(38,8) not null,\n                                                        Value_type varchar(50),\n                                                        Released_value numeric(38,8) not null,\n                                                        primary key(id));\n                                                \nTRUNCATE edw.${Target_table}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2963042":{"id":2963042,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-1456,"y":-240,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2963025,2963026,2963027],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2963028":{"id":2963028,"sourceID":2963014,"targetID":2963017},"2963029":{"id":2963029,"sourceID":2963023,"targetID":2963008},"2963031":{"id":2963031,"sourceID":2963008,"targetID":2963013},"2963032":{"id":2963032,"sourceID":2963011,"targetID":2963020},"2963033":{"id":2963033,"sourceID":2963010,"targetID":2963017},"2963034":{"id":2963034,"sourceID":2963009,"targetID":2963019},"2963035":{"id":2963035,"sourceID":2963013,"targetID":2963016},"2963036":{"id":2963036,"sourceID":2963022,"targetID":2963017},"2963037":{"id":2963037,"sourceID":2963018,"targetID":2963015},"2963038":{"id":2963038,"sourceID":2963016,"targetID":2963011},"2963039":{"id":2963039,"sourceID":2963019,"targetID":2963023}},"failureConnectors":{"2963084":{"id":2963084,"sourceID":2963008,"targetID":2963012},"2963085":{"id":2963085,"sourceID":2963023,"targetID":2963012}},"unconditionalConnectors":{"2963024":{"id":2963024,"sourceID":2963012,"targetID":2963018},"2963025":{"id":2963025,"sourceID":2963042,"targetID":2963014},"2963026":{"id":2963026,"sourceID":2963042,"targetID":2963010},"2963027":{"id":2963027,"sourceID":2963042,"targetID":2963022},"2963030":{"id":2963030,"sourceID":2963017,"targetID":2963009}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{"2963087":{"id":2963087,"sourceID":2963008,"targetID":2963021}},"noteConnectors":{},"notes":{"2963043":{"id":2963043,"x":-316,"y":-285,"width":98,"height":86,"text":"for development","colour":"d60000"}},"variables":{"Consolidated_table":{"definition":{"name":"Consolidated_table","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"consolidated_pnl"},"Item_name":{"definition":{"name":"Item_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"'Billed Investment PWIF'"},"Pnl_schema":{"definition":{"name":"Pnl_schema","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"edw"},"Quarter_iterator":{"definition":{"name":"Quarter_iterator","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"Target_table":{"definition":{"name":"Target_table","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"billed_investment_pwif"}},"grids":{"Quarters":{"definition":{"name":"Quarters","scope":"BRANCH","definitions":[{"name":"Quarter","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[]}}},"info":{"name":"pnl_init_billed_investment_pwif","description":"Initialization of Item in PnL Report schema and load all data incl historical","type":"ORCHESTRATION","tag":"e35fbeb0-9cd6-49ea-b59b-76363ba059fc"}}