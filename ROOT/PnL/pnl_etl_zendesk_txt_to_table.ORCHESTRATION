{"job":{"components":{"2962816":{"id":2962816,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":368,"y":0,"width":32,"height":32,"inputConnectorIDs":[2962847],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INSERT INTO TABLE"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INSERT INTO ${schema_name}.${table_name}(flag_processed,\n                                         start_date,\n                                         end_date,\n                                         amount)\nVALUES (\n  FALSE,\n  TO_DATE(TO_CHAR(${zen_start_date}, 'FM99999999'), 'YYYYMMDD'),\n  TO_DATE(TO_CHAR(${zen_end_date}, 'FM99999999'), 'YYYYMMDD'),\n  ${zen_subtotal});\n\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962817":{"id":2962817,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":224,"y":0,"width":32,"height":32,"inputConnectorIDs":[2962818],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2962847],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Parse Zendesk txt"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import boto3\nimport re\n\ns3 = boto3.resource('s3')\nobject = s3.Object(bucket_name, txt_file_name)\ntext = object.get()[\"Body\"].read()\n\nresult = re.findall(r'Support Enterprise Subscription(.*?);(\\d{2}/\\d{2}/\\d{4})(.*?)(\\d{2}/\\d{2}/\\d{4})', text)\nstart_date = result[-1][1]\nlst = start_date.split(\"/\")\nstart_date = lst[2] + lst[0] + lst[1]\n\nend_date = result[-1][3]\nlst = end_date.split(\"/\")\nend_date = lst[2] + lst[0] + lst[1]\n\ncontext.updateVariable('zen_start_date', start_date)\ncontext.updateVariable('zen_end_date', end_date)\n\nresult = re.search(r'Subtotal:;\\$(.*?);', text)\nsubtotal = result.group(1).replace(',','')\nprint(subtotal)\ncontext.updateVariable('zen_subtotal', subtotal)\n\nprint(zen_start_date)\nprint(zen_end_date)\nprint(zen_subtotal)\n\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962819":{"id":2962819,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":208,"y":-128,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DROP TABLE"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DROP TABLE ${schema_name}.${table_name}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962820":{"id":2962820,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-32,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2962844],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962822":{"id":2962822,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":224,"y":112,"width":32,"height":32,"inputConnectorIDs":[2962845],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Grant SELECT access to created table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"GRANT SELECT ON ${schema_name}.${table_name} TO \"spashchenko.ctr\";\nGRANT SELECT ON ${schema_name}.${table_name} TO \"ashumakov.ctr\";\nGRANT SELECT ON ${schema_name}.${table_name} TO \"vfigurkin.ctr\";\nGRANT SELECT ON ${schema_name}.${table_name} TO \"opetrova.ctr\";\nGRANT SELECT ON ${schema_name}.${table_name} TO \"idudkin.ctr\";\nGRANT SELECT ON ${schema_name}.${table_name} TO \"spashchenko.ctr\";\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962823":{"id":2962823,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":96,"y":0,"width":32,"height":32,"inputConnectorIDs":[2962844],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2962818,2962845],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE IF NOT EXISTS ${schema_name}.${table_name}(id bigint identity(1, 1),\n                                                       flag_processed bool not null,\n                                                       start_date date not null,\n                                                       end_date date not null,\n                                                       amount numeric(38,8) not null);\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{},"failureConnectors":{},"unconditionalConnectors":{"2962818":{"id":2962818,"sourceID":2962823,"targetID":2962817},"2962844":{"id":2962844,"sourceID":2962820,"targetID":2962823},"2962845":{"id":2962845,"sourceID":2962823,"targetID":2962822},"2962847":{"id":2962847,"sourceID":2962817,"targetID":2962816}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{"2962821":{"id":2962821,"x":149,"y":-153,"width":111,"height":66,"text":"dev","colour":"d60000"}},"variables":{"bucket_name":{"definition":{"name":"bucket_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"aspiration-pnl-project-staging"},"schema_name":{"definition":{"name":"schema_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"edw"},"table_name":{"definition":{"name":"table_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"etl_call_center_zendesk"},"txt_file_name":{"definition":{"name":"txt_file_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"txt/call_center_zen_zendesc_invoice_inv04337974_6.txt"},"zen_end_date":{"definition":{"name":"zen_end_date","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"zen_start_date":{"definition":{"name":"zen_start_date","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"zen_subtotal":{"definition":{"name":"zen_subtotal","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""}},"grids":{}},"info":{"name":"pnl_etl_zendesk_txt_to_table","description":"","type":"ORCHESTRATION","tag":"a9a4fdcd-8bbc-4b16-bab2-d9ec7ea7b96b"}}