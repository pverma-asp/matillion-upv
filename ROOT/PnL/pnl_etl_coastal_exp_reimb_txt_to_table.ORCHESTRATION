{"job":{"components":{"2962784":{"id":2962784,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-13,"y":-3,"width":32,"height":32,"inputConnectorIDs":[2962764],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2962766,2962767],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE IF NOT EXISTS ${schema_name}.${table_name}(id bigint identity(1, 1),\n                                   date date not null,\n                                   frb_services numeric(38,8) not null,\n                                   fis_al_transport_vpn numeric(38,8) not null,\n                                   fis_image_capture numeric(38,8) not null,\n                                   pacific_coast_bankers_invoice numeric(38,8) not null,\n                                   salary_reimbursement numeric(38,8) not null,\n                                   visa_invoice numeric(38,8) not null,\n                                   online_banking_monthly_expense numeric(38,8) not null,\n                                   postage numeric(38,8) not null,\n                                   ccb_service_fee numeric(38,8) not null);\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962785":{"id":2962785,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":144,"y":0,"width":32,"height":32,"inputConnectorIDs":[2962767],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2962765],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"parse txt"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import boto3\nimport re\n\ns3 = boto3.resource('s3')\nobject = s3.Object(bucket_name, txt_file_name)\ntext = object.get()[\"Body\"].read()\n\ndate = re.search(r'DATE:;(.*?);', text).group(1)\nlst = date.split(\"/\")\ndate = \"\"\nyear = \"\"\nfor x in lst:\n  if len(x) < 2: x = \"0\" + x\n  if len(x) < 4: date += x\n  else: year += x\ndate = year + date\ncontext.updateVariable(\"coastal_exp_reimb_date\", date)\nprint(coastal_exp_reimb_date)\n\nresult = re.search(r'FRB Services(.*?);\\$;(.*?);', text)\nfrb_services = result.group(2).replace(',','')\ncontext.updateVariable('coastal_frb_services', frb_services)\nprint(coastal_frb_services)\n\nresult = re.search(r'FIS Al Transport(.*?);\\$;(.*?);', text)\nfis_al_transport_vpn = result.group(2).replace(',','')\ncontext.updateVariable('coastal_fis_al_transport_vpn', fis_al_transport_vpn)\nprint(coastal_fis_al_transport_vpn)\n\nresult = re.search(r'FIS Image Capture(.*?);\\$;(.*?);', text)\nfis_image_capture = result.group(2).replace(',','')\ncontext.updateVariable('coastal_fis_image_capture', fis_image_capture)\nprint(coastal_fis_image_capture)\n\nresult = re.search(r'Pacific Coast Bankers(.*?);\\$;(.*?);', text)\npacific_coast_bankers_invoice = result.group(2).replace(',','')\ncontext.updateVariable('coastal_pacific_coast_bankers_invoice', pacific_coast_bankers_invoice)\nprint(coastal_pacific_coast_bankers_invoice)\n\nresult = re.search(r'Salary Reimbursement(.*?);\\$;(.*?);', text)\nsalary_reimbursement = result.group(2).replace(',','')\ncontext.updateVariable('coastal_salary_reimbursement', salary_reimbursement)\nprint(coastal_salary_reimbursement)\n\nresult = re.search(r'Visa(.*?);\\$;(.*?);', text)\nvisa_invoice = result.group(2).replace(',','')\ncontext.updateVariable('coastal_visa_invoice', visa_invoice)\nprint(coastal_visa_invoice)\n\nresult = re.search(r'Online Banking(.*?);\\$;(.*?);', text)\nonline_banking_monthly_expense = result.group(2).replace(',','')\ncontext.updateVariable('coastal_online_banking_monthly_expense', online_banking_monthly_expense)\nprint(coastal_online_banking_monthly_expense)\n\nresult = re.search(r'Postage(.*?);\\$;(.*?);', text)\npostage = result.group(2).replace(',','')\ncontext.updateVariable('coastal_postage', postage)\nprint(coastal_postage)\n\nresult = re.search(r'CCB Service Fee(.*?);\\$;(.*?);', text)\nccb_service_fee = result.group(2).replace(',','')\ncontext.updateVariable('coastal_ccb_service_fee', ccb_service_fee)\nprint(coastal_ccb_service_fee)\n\n\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962786":{"id":2962786,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":304,"y":0,"width":32,"height":32,"inputConnectorIDs":[2962765],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INSERT INTO TABLE"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INSERT INTO ${schema_name}.${table_name}(date,\n                                         frb_services,\n                                         fis_al_transport_vpn,\n                                         fis_image_capture,\n                                         pacific_coast_bankers_invoice,\n                                         salary_reimbursement,\n                                         visa_invoice,\n                                         online_banking_monthly_expense,\n                                         postage,\n                                         ccb_service_fee)\nVALUES (\n  TO_DATE(TO_CHAR(${coastal_exp_reimb_date}, 'FM99999999'), 'YYYYMMDD'),\n  ${coastal_frb_services},\n  ${coastal_fis_al_transport_vpn},\n  ${coastal_fis_image_capture},\n  ${coastal_pacific_coast_bankers_invoice},\n  ${coastal_salary_reimbursement},\n  ${coastal_visa_invoice},\n  ${coastal_online_banking_monthly_expense},\n  ${coastal_postage},\n  ${coastal_ccb_service_fee});\n\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962787":{"id":2962787,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":144,"y":112,"width":32,"height":32,"inputConnectorIDs":[2962766],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Grant SELECT access to created table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"GRANT SELECT ON ${schema_name}.${table_name} TO \"spashchenko.ctr\";\nGRANT SELECT ON ${schema_name}.${table_name} TO \"ashumakov.ctr\";\nGRANT SELECT ON ${schema_name}.${table_name} TO \"vfigurkin.ctr\";\nGRANT SELECT ON ${schema_name}.${table_name} TO \"opetrova.ctr\";\nGRANT SELECT ON ${schema_name}.${table_name} TO \"idudkin.ctr\";\nGRANT SELECT ON ${schema_name}.${table_name} TO \"spashchenko.ctr\";\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962790":{"id":2962790,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-144,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2962764],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962800":{"id":2962800,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":144,"y":-144,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DROP TABLE"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DROP TABLE ${schema_name}.${table_name}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{},"failureConnectors":{},"unconditionalConnectors":{"2962764":{"id":2962764,"sourceID":2962790,"targetID":2962784},"2962765":{"id":2962765,"sourceID":2962785,"targetID":2962786},"2962766":{"id":2962766,"sourceID":2962784,"targetID":2962787},"2962767":{"id":2962767,"sourceID":2962784,"targetID":2962785}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{"2962791":{"id":2962791,"x":77,"y":-170,"width":109,"height":70,"text":"dev","colour":"d60000"}},"variables":{"bucket_name":{"definition":{"name":"bucket_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"aspiration-pnl-project-staging"},"coastal_ccb_service_fee":{"definition":{"name":"coastal_ccb_service_fee","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"coastal_exp_reimb_date":{"definition":{"name":"coastal_exp_reimb_date","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"coastal_fis_al_transport_vpn":{"definition":{"name":"coastal_fis_al_transport_vpn","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"coastal_fis_image_capture":{"definition":{"name":"coastal_fis_image_capture","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"coastal_frb_services":{"definition":{"name":"coastal_frb_services","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"coastal_online_banking_monthly_expense":{"definition":{"name":"coastal_online_banking_monthly_expense","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"coastal_pacific_coast_bankers_invoice":{"definition":{"name":"coastal_pacific_coast_bankers_invoice","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"coastal_postage":{"definition":{"name":"coastal_postage","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"coastal_salary_reimbursement":{"definition":{"name":"coastal_salary_reimbursement","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"coastal_visa_invoice":{"definition":{"name":"coastal_visa_invoice","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"schema_name":{"definition":{"name":"schema_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"edw"},"table_name":{"definition":{"name":"table_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"etl_coastal_expense_reimbursement"},"txt_file_name":{"definition":{"name":"txt_file_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null}},"grids":{}},"info":{"name":"pnl_etl_coastal_exp_reimb_txt_to_table","description":"","type":"ORCHESTRATION","tag":"ee19a851-a1c0-4928-9375-a1f6e2fbe7b5"}}