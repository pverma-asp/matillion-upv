{"job":{"components":{"2964258":{"id":2964258,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-32,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2964276],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964280":{"id":2964280,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":544,"y":-32,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Copy of INSERT INTO TABLE"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INSERT INTO ${schema_name}.${table_name}(fund_name,\n                                         period_start,\n                                         period_end,\n                                         custody_fees_2,\n                                         totals)\nVALUES (\n  'Flagship',\n  TO_DATE(TO_CHAR(20190801, 'FM99999999'), 'YYYYMMDD'),\n  TO_DATE(TO_CHAR(20190830, 'FM99999999'), 'YYYYMMDD'),\n  7547.64,\n  76467.52);"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964281":{"id":2964281,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":208,"y":-128,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DROP TABLE"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DROP TABLE ${schema_name}.${table_name}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964283":{"id":2964283,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":592,"y":64,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Copy of INSERT INTO TABLE (1)"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INSERT INTO ${schema_name}.${table_name}(fund_name,\n                                         period_start,\n                                         period_end,\n                                         custody_fees_2,\n                                         totals)\nVALUES (\n  'Redwood',\n  TO_DATE(TO_CHAR(20190801, 'FM99999999'), 'YYYYMMDD'),\n  TO_DATE(TO_CHAR(20190830, 'FM99999999'), 'YYYYMMDD'),\n  8150.4,\n  133762.51);\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964284":{"id":2964284,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":224,"y":112,"width":32,"height":32,"inputConnectorIDs":[2964279],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Grant SELECT access to created table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"GRANT SELECT ON ${schema_name}.${table_name} TO \"spashchenko.ctr\";\nGRANT SELECT ON ${schema_name}.${table_name} TO \"ashumakov.ctr\";\nGRANT SELECT ON ${schema_name}.${table_name} TO \"vfigurkin.ctr\";\nGRANT SELECT ON ${schema_name}.${table_name} TO \"opetrova.ctr\";\nGRANT SELECT ON ${schema_name}.${table_name} TO \"idudkin.ctr\";\nGRANT SELECT ON ${schema_name}.${table_name} TO \"spashchenko.ctr\";\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964285":{"id":2964285,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":96,"y":0,"width":32,"height":32,"inputConnectorIDs":[2964276],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2964279,2964282],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE IF NOT EXISTS ${schema_name}.${table_name}(id bigint identity(1, 1),\n                                                       fund_name varchar(30) not null,\n                                                       period_start date not null,\n                                                       period_end date not null,\n                                                       custody_fees_2 numeric(38,8) not null,\n                                                       totals numeric(38,8) not null);\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964286":{"id":2964286,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":368,"y":0,"width":32,"height":32,"inputConnectorIDs":[2964277],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INSERT INTO TABLE"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INSERT INTO ${schema_name}.${table_name}(fund_name,\n                                         period_start,\n                                         period_end,\n                                         custody_fees_2,\n                                         totals)\nVALUES (\n  '${nott_fund_name}',\n  TO_DATE(TO_CHAR(${nott_period_start}, 'FM99999999'), 'YYYYMMDD'),\n  TO_DATE(TO_CHAR(${nott_period_end}, 'FM99999999'), 'YYYYMMDD'),\n  ${nott_custody_fees_2},\n  ${nott_totals});\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964287":{"id":2964287,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":224,"y":0,"width":32,"height":32,"inputConnectorIDs":[2964282],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2964277],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Parse Nottingham txt"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import boto3\nimport re\n\ns3 = boto3.resource('s3')\nobject = s3.Object(bucket_name, txt_file_name)\ntext = object.get()[\"Body\"].read()\n\nresult = re.search(r'Aspir(.*?)Fund', text)\nif 'flagship' in result.group(1).lower():\n  context.updateVariable('nott_fund_name', 'Flagship')\nelif 'redwood' in result.group(1).lower():\n  context.updateVariable('nott_fund_name', 'Redwood')\nelse:\n  context.updateVariable('nott_fund_name', '')\n  \nprint(nott_fund_name)\n\n  \nresult = re.search(r'period beginning(.*?)(\\d{1,2}/\\d{1,2}/\\d{4})(.*?)(\\d{1,2}/\\d{1,2}/\\d{4})', text)\nperiod_start = result.group(2)\nlst = period_start.split(\"/\")\nif len(lst[0]) == 1:\n  lst[0] = '0' + lst[0]\nif len(lst[1]) == 1:\n  lst[1] = '0' + lst[1]\nperiod_start = lst[2] + lst[0] + lst[1]\n\n\nperiod_end = result.group(4)\nlst = period_end.split(\"/\")\nif len(lst[0]) == 1:\n  lst[0] = '0' + lst[0]\nif len(lst[1]) == 1:\n  lst[1] = '0' + lst[1]\nperiod_end = lst[2] + lst[0] + lst[1]\n\nprint(period_start)\nprint(period_end)\ncontext.updateVariable('nott_period_start', period_start)\ncontext.updateVariable('nott_period_end', period_end)\n\n\nresult = re.search(r'totals;(.*?);(-;){0,1}(.*?);', text.lower())\ntotals = result.group(3).replace(',','')\nprint(totals)\ncontext.updateVariable('nott_totals', totals)\n  \nresult = re.search(r'custody(.*?)net(.*?)custody(.*?);(.*?);(.*?);(-;){0,1}(.*?);', text.lower())\ncustody_fees_2 = result.group(7).replace(',','')\nprint(custody_fees_2)\ncontext.updateVariable('nott_custody_fees_2', custody_fees_2)\n  \n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{},"failureConnectors":{},"unconditionalConnectors":{"2964276":{"id":2964276,"sourceID":2964258,"targetID":2964285},"2964277":{"id":2964277,"sourceID":2964287,"targetID":2964286},"2964279":{"id":2964279,"sourceID":2964285,"targetID":2964284},"2964282":{"id":2964282,"sourceID":2964285,"targetID":2964287}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{"2964259":{"id":2964259,"x":149,"y":-153,"width":111,"height":66,"text":"dev","colour":"d60000"}},"variables":{"bucket_name":{"definition":{"name":"bucket_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"aspiration-pnl-project-staging"},"nott_custody_fees_2":{"definition":{"name":"nott_custody_fees_2","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"nott_fund_name":{"definition":{"name":"nott_fund_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"nott_period_end":{"definition":{"name":"nott_period_end","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"nott_period_start":{"definition":{"name":"nott_period_start","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"nott_totals":{"definition":{"name":"nott_totals","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"schema_name":{"definition":{"name":"schema_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"edw"},"table_name":{"definition":{"name":"table_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"etl_nottingham_fee"},"txt_file_name":{"definition":{"name":"txt_file_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"txt/FLAGSHIP JULY DFA.txt"}},"grids":{}},"info":{"name":"pnl_etl_nottingham_txt_to_table","description":"","type":"ORCHESTRATION","tag":"b134c271-5ab9-403a-948f-f5c1abad2cc7"}}