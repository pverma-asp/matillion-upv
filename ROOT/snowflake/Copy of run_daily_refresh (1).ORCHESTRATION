{"job":{"components":{"2964641":{"id":2964641,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":1611478312,"x":-88,"y":-223,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Create Table 0"}}}},"visible":true},"3":{"slot":3,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"4":{"slot":4,"name":"New Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"6":{"slot":6,"name":"Create/Replace","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Create"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964644":{"id":2964644,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":16,"y":32,"width":32,"height":32,"inputConnectorIDs":[2964620],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Send Alert to Pager Duty 2"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"us-west-2"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"data-alerts-pagerduty-prod"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AWS Notification Message"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"DT tables generation\" job failed"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964645":{"id":2964645,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":129,"y":-79,"width":32,"height":32,"inputConnectorIDs":[2964621],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DW tables update"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DW tables update"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964646":{"id":2964646,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":716056355,"x":-271,"y":-274,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Copy of Get check_deposit tables with delta support"}}}},"visible":true},"2":{"slot":2,"name":"","elements":{},"visible":false},"3":{"slot":3,"name":"Database Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"postgresql"}}}},"visible":true},"4":{"slot":4,"name":"RDS Endpoint","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"prod-web-db-analytics.ctawxryivyva.us-west-2.rds.amazonaws.com:5432"}}}},"visible":true},"5":{"slot":5,"name":"Database Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"check_deposit"}}}},"visible":true},"6":{"slot":6,"name":"Username","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"data_readonly"}}}},"visible":true},"7":{"slot":7,"name":"Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dA3j3RWFpzzo38LL"}}}},"visible":true},"8":{"slot":8,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"WITH column_list \nAS\n(\n    SELECT C.TABLE_NAME, \n    \tstring_agg(c.COLUMN_NAME, ',') AS column_list\n    FROM INFORMATION_SCHEMA.COLUMNS c\n    WHERE 1=1\n\t\tAND c.TABLE_SCHEMA = 'public'\n     \t AND (c.data_type not in ('json','jsonb')\n     \t    or (c.data_type in ('json','jsonb')\n     \t          and c.table_name = 'bank_account_plaid_identity_info'\n     \t          and c.column_name = 'original_plaid_data'))\n     \tAND c.COLUMN_NAME NOT IN ('tax_identification_number')\n   \tGROUP BY C.TABLE_NAME\n)\nSELECT 'prod-web-db-analytics.ctawxryivyva.us-west-2.rds.amazonaws.com:5432' AS SERVER_NAME,\n\t'check_deposit' AS DB_NAME,\n\t'check_db' AS TABLE_SCHEMA, \n    t.TABLE_SCHEMA AS SOURCE_SCHEMA,\n\tt.TABLE_NAME,\n\n        (\n          SELECT '(' || string_agg(a.attname, ',') || ')' AS pk_cols\n          FROM pg_index i\n          INNER JOIN pg_attribute a ON (a.attrelid = i.indrelid AND a.attnum = ANY(i.indkey))\n          INNER JOIN pg_class c ON (c.oid = i.indrelid)\n          INNER JOIN pg_namespace ns ON (ns.oid = c.relnamespace)\n          WHERE 1=1\n            AND i.indisprimary\n            AND ns.nspname = t.TABLE_SCHEMA\n            AND i.indrelid::regclass::text = t.TABLE_NAME\n          GROUP BY ns.nspname, i.indrelid::regclass\n        ) AS pk_cols,\n  \n\tc.column_list, \n   \n  CASE\n  \tWHEN c.column_list ILIKE '%updated_at%' THEN 'updated_at'\n  \tWHEN c.column_list ILIKE '%created_at%' THEN 'created_at'\n  \tWHEN c.column_list ILIKE '%calculated_at%' THEN 'calculated_at' \n  END AS update_column_name  \n\nFROM INFORMATION_SCHEMA.TABLES t\nINNER JOIN column_list c ON (c.TABLE_NAME = t.TABLE_NAME)\nWHERE 1=1\n  AND t.TABLE_TYPE = 'BASE TABLE'\n  AND t.TABLE_SCHEMA = 'public'\n  AND t.TABLE_NAME NOT ILIKE '%journal%'\n  AND t.TABLE_NAME NOT ILIKE 'dt_%'\n  AND t.TABLE_NAME NOT IN ('jellyfish_event_log')\n  AND t.TABLE_NAME NOT IN ('restriction','account_statement','user_cohorts', 'user_profile', 'user_product_application', 'depository', 'cma_migration', 'joint_account_invitation', 'cashback_posted_transaction')\n  AND EXISTS (SELECT * FROM INFORMATION_SCHEMA.COLUMNS c WHERE c.TABLE_SCHEMA = t.TABLE_SCHEMA AND c.TABLE_NAME = t.TABLE_NAME AND c.COLUMN_NAME IN ('created_at', 'updated_at', 'calculated_at'))\n--  AND TABLE_NAME = 'cma_migration'\nORDER BY t.TABLE_NAME\n;\n"}}}},"visible":true},"11":{"slot":11,"name":"JDBC Options","elements":{},"visible":true},"13":{"slot":13,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${staging_schema}"}}}},"visible":true},"14":{"slot":14,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"tables_to_refresh"}}}},"visible":true},"16":{"slot":16,"name":"S3 Staging Area","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"aspiration-etl-staging"}}}},"visible":true},"18":{"slot":18,"name":"Primary Key","elements":{},"visible":true},"20":{"slot":20,"name":"Data Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"95":{"slot":95,"name":"File Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Delimited"}}}},"visible":false},"101":{"slot":101,"name":"Basic/Advanced Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Advanced"}}}},"visible":true},"102":{"slot":102,"name":"Data Source","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"103":{"slot":103,"name":"Data Selection","elements":{},"visible":false},"104":{"slot":104,"name":"Data Source Filter","elements":{},"visible":false},"105":{"slot":105,"name":"Combine Filters","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":false},"106":{"slot":106,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"100"}}}},"visible":false},"1001":{"slot":1001,"name":"","elements":{},"visible":false},"40000":{"slot":40000,"name":"Encryption","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SSE KMS"}}}},"visible":true},"40001":{"slot":40001,"name":"KMS Key ID","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${kms_s3_key}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964647":{"id":2964647,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"CONDITIONAL","executionHint":"FLOW","implementationID":-1357378929,"x":-96,"y":-80,"width":32,"height":32,"inputConnectorIDs":[2964643],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[2964640],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DT run condition"}}}},"visible":true},"2":{"slot":2,"name":"Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Advanced"}}}},"visible":true},"3":{"slot":3,"name":"Condition","elements":{},"visible":false},"4":{"slot":4,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":false},"5":{"slot":5,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"(${new Date().getHours()} >= 12 && ${new Date().getHours()} < 13) ||\n(${new Date().getHours()} >= 14 && ${new Date().getHours()} < 15) ||\n(${new Date().getHours()} >= 17 && ${new Date().getHours()} < 18) ||\n(${new Date().getHours()} >= 20 && ${new Date().getHours()} < 21) ||\n(${new Date().getHours()} >= 23) ||\n(${new Date().getHours()} >= 5 && ${new Date().getHours()} < 6)"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964648":{"id":2964648,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-213,"y":-80,"width":32,"height":32,"inputConnectorIDs":[2964642],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2964643],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"refresh_web_db"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"refresh_web_db"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964649":{"id":2964649,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-317,"y":-74,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2964642],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2964650":{"id":2964650,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":16,"y":-74,"width":32,"height":32,"inputConnectorIDs":[2964640],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[2964620],"outputUnconditionalConnectorIDs":[2964621],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DT tables generation"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DT tables generation"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{},"failureConnectors":{"2964620":{"id":2964620,"sourceID":2964650,"targetID":2964644}},"unconditionalConnectors":{"2964621":{"id":2964621,"sourceID":2964650,"targetID":2964645},"2964642":{"id":2964642,"sourceID":2964649,"targetID":2964648},"2964643":{"id":2964643,"sourceID":2964648,"targetID":2964647}},"trueConnectors":{"2964640":{"id":2964640,"sourceID":2964647,"targetID":2964650}},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{"2964562":{"id":2964562,"x":227,"y":-102,"width":326,"height":175,"text":"Looker Alerts for Derived Table Missed runs\n\nAlerts for derived table missed runs are set up through Looker via schedules of this Look:  \nhttps://aspiration.looker.com/looks/576\n\nIt works by checking for the existence of the bi_new schema while the job is expected to be running at 4:40am, 7:40 am, 10:40am, 1:40pm, 4:40pm.  If the Look does not return rows, an email is sent to data-generic-alerts@aspiration-partners.pagerduty.com.  The schedule was set up by Serena, so if edits are needed as the job schedule changes, please contact her.","colour":"e6e63c"},"2964563":{"id":2964563,"x":226,"y":-310,"width":325,"height":185,"text":"Looker Alerts for Derived Table Failures\n\nAlerts for derived table failures are set up through Looker via schedules of this Look:  \nhttps://aspiration.looker.com/looks/576\n\nIt works by checking for the existence of the bi_new schema after the derived table portion of the job should be complete at 5:20am, 8:20am, 11:20am, 2:20p, 5:20pm.  If the Look returns rows, an email is sent to data-generic-alerts@aspiration-partners.pagerduty.com.  The schedule was set up by Serena, so if edits are needed as the job schedule changes, please contact her.","colour":"e6e63c"}},"variables":{},"grids":{}},"info":{"name":"Copy of run_daily_refresh (1)","description":null,"type":"ORCHESTRATION","tag":"144e6680-49d6-4be3-ad25-eb6d748a6949"}}