{"job":{"components":{"2962451":{"id":2962451,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":304,"y":160,"width":32,"height":32,"inputConnectorIDs":[2962541],"outputSuccessConnectorIDs":[2962540],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Populate galileo table - internal customers"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"UPDATE etl.galileo_transaction_batch_header\nSET filename = 'btrans_584_20191101_007.txt.gpg',\nfiletransmitdate = '11012019'\nWHERE recordtype = 'H'\n;\n\ntruncate table etl.galileo_transaction_batch_detail;\ninsert into etl.galileo_transaction_batch_detail(recordtype,\nrecordnumber, accountidtype, accountidentifier, transactiontype,\ntransactionsubtype, transactionamount, transactiondescription, transactionidentifier)\nwith cmc\nas\n(\n  SELECT\n    ic.save_galileo_prn                          as galileo_prn,\n    sum(interest_payment):: numeric(18, 2)       as creditamount,\n    'Interest Posting'::varchar                  as trans_desc\n  FROM rdl.save_interest_calculation ic\n  JOIN bi.dt_accounts da ON da.save_galileo_prn=ic.save_galileo_prn\n  JOIN bi.dt_users du ON da.user_id=du.user_id\n  WHERE 1=1\n    AND du.user_email in (\n    SELECT email\n      FROM etl.internal_employees_20190903\n    )\n    AND interest_month='2019-10-01'\n  GROUP BY galileo_prn\n)\nselect 'D' as recordtype\n     , row_number() over(order by t2.galileo_prn) as recordnumber\n     , 'R' as accountidtype\n     , t2.galileo_prn as accountidentifier\n     , 'L' as transactiontype\n     , 'MZ' as transactionsubtype\n     , t2.creditamount as transactionamount\n     , t2.trans_desc as transactiondescription\n     , 'IP_191101-I' || lpad(row_number() over(order by t2.galileo_prn), 5, '0') as transactionidentifier\nfrom cmc t2\nwhere t2.creditamount > 0.00\n;\n\nUPDATE etl.galileo_transaction_batch_trailer\nSET \"count\" = (SELECT count(1) from etl.galileo_transaction_batch_detail)\nWHERE recordtype = 'T'\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962452":{"id":2962452,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":144,"y":0,"width":32,"height":32,"inputConnectorIDs":[2962542],"outputSuccessConnectorIDs":[2962499],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"populate qualification table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"drop table if exists etl.save_interest_qualifications;\n\ncreate table etl.save_interest_qualifications (\n  save_galileo_prn varchar(255),\n  qualification_period varchar(255),\n  interest_rate numeric(21,20),\n  from_date date,\n  to_date date\n)\nDISTKEY(save_galileo_prn)\nSORTKEY(save_galileo_prn)\n;\n\nINSERT INTO etl.save_interest_qualifications\n(save_galileo_prn, qualification_period, interest_rate, from_date, to_date)\nSELECT\n  acc.save_galileo_prn,\n  'full_month',\n--   daq.apy,\n  CASE\n    WHEN daq.apy=0.02 THEN 0.0198\n    WHEN daq.apy=0.015 THEN 0.0149\n    WHEN daq.apy=0.01 THEN 0.01\n    ELSE 0.0\n  END as interest_rate,\n  '2019-10-02',\n  '2019-11-01'\nFROM web_db.depository_apy_qualification daq\nJOIN bi.dt_accounts acc on acc.galileo_save_id = daq.depository_id\nWHERE 1=1\n  AND daq.qualified_month='2019-10-01 00:00:00.000000'\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962453":{"id":2962453,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":0,"y":96,"width":32,"height":32,"inputConnectorIDs":[2962543],"outputSuccessConnectorIDs":[2962496],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"table creation scripts"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"set timezone to 'America/Los_Angeles';\n\ndrop table if exists rdl.save_interest_calculation;\n\ncreate table rdl.save_interest_calculation\n(\n\tinterest_month date,\n\tcalculation_method varchar(255),\n\tsave_galileo_prn varchar(255),\n\tqualification_period varchar(255),\n\tinterest_rate numeric(21,20),\n\tbalance_start_date date,\n\tbalance_end_date date,\n\tinterest_period bigint,\n\taverage_balance numeric(38,20),\n\tn_balance_days bigint,\n\tinterest_payment numeric(38,20),\n    etl_load_date timestamp default getdate()\n--    etl_timestamp timestamp default ('now'::text)::timestamp with time zone\n--    etl_timestamp timestamp with time zone default current_timestamp\n)\n;\n\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962454":{"id":2962454,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":304,"y":64,"width":32,"height":32,"inputConnectorIDs":[2962499],"outputSuccessConnectorIDs":[2962541],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"calculate interest payments"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"set timezone to 'America/Los_Angeles';\n\ndelete from rdl.save_interest_calculation\nwhere interest_month='2019-10-01'\n;\n\nINSERT INTO rdl.save_interest_calculation\n(interest_month, calculation_method, save_galileo_prn, qualification_period, interest_rate, balance_start_date, balance_end_date, interest_period, average_balance, n_balance_days, interest_payment) \nwith average_balances as (\n    SELECT\n      da.save_galileo_prn,\n      iq.qualification_period,\n      sum(db.save_daily_balance) AS sum_balance,\n      count(db.save_daily_balance) AS n_balance_days\n    FROM bi.dt_account_daily_data db\n      JOIN bi.dt_accounts da ON db.unique_account_id=da.unique_account_id\n      JOIN etl.save_interest_qualifications iq ON iq.save_galileo_prn = da.save_galileo_prn\n    WHERE 1 = 1\n          AND date BETWEEN iq.from_date AND iq.to_date\n    GROUP BY da.save_galileo_prn, iq.qualification_period\n)\nSELECT\n  '2019-10-01',\n  'adb',\n  iq.save_galileo_prn,\n  iq.qualification_period,\n  iq.interest_rate,\n  iq.from_date,\n  iq.to_date,\n  datediff(DAY, iq.from_date, iq.to_date)+1 as interest_period,\n  ab.sum_balance / (iq.to_date-iq.from_date+1) as average_balance,\n  ab.n_balance_days,\n  ab.sum_balance * iq.interest_rate / 365 as interest_payment\nFROM etl.save_interest_qualifications iq\nJOIN average_balances ab\n    ON iq.save_galileo_prn=ab.save_galileo_prn\n    AND iq.qualification_period=ab.qualification_period\nWHERE 1=1\n;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962455":{"id":2962455,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":0,"y":176,"width":32,"height":32,"inputConnectorIDs":[2962496],"outputSuccessConnectorIDs":[2962498],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"populate 2019-08 interests calculation"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INSERT INTO rdl.save_interest_calculation\n(interest_month, calculation_method, save_galileo_prn, qualification_period, interest_rate, balance_start_date, balance_end_date, interest_period, average_balance, n_balance_days, interest_payment, etl_load_date) \nSELECT\n  '2019-08-01',\n  'adb',\n  save_galileo_prn,\n  CASE\n    WHEN qualification_period='first_only' THEN 'period_1'\n    WHEN qualification_period='second_only' THEN 'period_2'\n    WHEN qualification_period='both' THEN 'full_month'\n  END,\n  interest_rate,\n  from_date,\n  to_date,\n  interest_period,\n  average_balance,\n  n_balance_days,\n  interest_payment,\n  '2019-09-02 11:33:32.920038'\nFROM ujc.save_august_interest_aspiration\n;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962458":{"id":2962458,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":0,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2962542,2962543],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962497":{"id":2962497,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-5,"y":254,"width":32,"height":32,"inputConnectorIDs":[2962498],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"20191024_adb_adjustment"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"-- alter table rdl.save_interest_calculation rename to save_interest_calculation_backup_20191024;\n\ninsert into rdl.save_interest_calculation\nSELECT\n  interest_month,\n  calculation_method,\n  save_galileo_prn,\n  qualification_period,\n  interest_rate,\n  balance_start_date,\n  balance_end_date,\n  interest_period,\n  average_balance * n_balance_days / interest_period,\n  n_balance_days,\n  interest_payment,\n  etl_load_date\nFROM rdl.save_interest_calculation_backup_20191024\n;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962500":{"id":2962500,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":304,"y":256,"width":32,"height":32,"inputConnectorIDs":[2962540],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Populate galileo table - all other customers"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"UPDATE etl.galileo_transaction_batch_header\nSET filename = 'btrans_584_20191104_008.txt.gpg',\nfiletransmitdate = '11042019'\nWHERE recordtype = 'H'\n;\n\ntruncate table etl.galileo_transaction_batch_detail;\ninsert into etl.galileo_transaction_batch_detail(recordtype,\nrecordnumber, accountidtype, accountidentifier, transactiontype,\ntransactionsubtype, transactionamount, transactiondescription, transactionidentifier)\nwith cmc\nas\n(\n  SELECT\n    ic.save_galileo_prn                          as galileo_prn,\n    sum(interest_payment):: numeric(18, 2)       as creditamount,\n    'Interest Posting'::varchar                  as trans_desc\n  FROM rdl.save_interest_calculation ic\n  JOIN bi.dt_accounts da ON da.save_galileo_prn=ic.save_galileo_prn\n  JOIN bi.dt_users du ON da.user_id=du.user_id\n  WHERE 1=1\n    AND du.user_email not in (\n    SELECT email\n      FROM etl.internal_employees_20190903\n    )\n    AND interest_month='2019-10-01'\n  GROUP BY galileo_prn\n)\nselect 'D' as recordtype\n     , row_number() over(order by t2.galileo_prn) as recordnumber\n     , 'R' as accountidtype\n     , t2.galileo_prn as accountidentifier\n     , 'L' as transactiontype\n     , 'MZ' as transactionsubtype\n     , t2.creditamount as transactionamount\n     , t2.trans_desc as transactiondescription\n     , 'IP_191104-' || lpad(row_number() over(order by t2.galileo_prn), 5, '0') as transactionidentifier\nfrom cmc t2\nwhere t2.creditamount > 0\n;\n\nUPDATE etl.galileo_transaction_batch_trailer\nSET \"count\" = (SELECT count(1) from etl.galileo_transaction_batch_detail)\nWHERE recordtype = 'T'\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2962496":{"id":2962496,"sourceID":2962453,"targetID":2962455},"2962498":{"id":2962498,"sourceID":2962455,"targetID":2962497},"2962499":{"id":2962499,"sourceID":2962452,"targetID":2962454},"2962540":{"id":2962540,"sourceID":2962451,"targetID":2962500},"2962541":{"id":2962541,"sourceID":2962454,"targetID":2962451}},"failureConnectors":{},"unconditionalConnectors":{"2962542":{"id":2962542,"sourceID":2962458,"targetID":2962452},"2962543":{"id":2962543,"sourceID":2962458,"targetID":2962453}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{},"grids":{}},"info":{"name":"interest_calculation_adb_backup_20191226","description":"","type":"ORCHESTRATION","tag":"2c1a6666-c1c1-4a97-ad95-4d594f2e91b3"}}