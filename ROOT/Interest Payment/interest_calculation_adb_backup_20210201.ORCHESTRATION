{"job":{"components":{"2962508":{"id":2962508,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":448,"y":240,"width":32,"height":32,"inputConnectorIDs":[2962503],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Send_File_to_Galileo for all other customers"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Send_File_to_Galileo"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"galileo_filename"},"2":{"slot":2,"type":"STRING","value":"btrans_584_${galileo_filename_date}_ip008.txt"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962509":{"id":2962509,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":144,"y":240,"width":32,"height":32,"inputConnectorIDs":[2962510],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Send_File_to_Galileo for internal customers"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Send_File_to_Galileo"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"galileo_filename"},"2":{"slot":2,"type":"STRING","value":"btrans_584_${galileo_filename_date}_ip007.txt"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962528":{"id":2962528,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-112,"y":0,"width":32,"height":32,"inputConnectorIDs":[2962527],"outputSuccessConnectorIDs":[2962501],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"table creation scripts"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"set timezone to 'America/Los_Angeles';\n\ndrop table if exists rdl.save_interest_calculation;\n\ncreate table rdl.save_interest_calculation\n(\n\tinterest_month date,\n\tcalculation_method varchar(255),\n\tsave_galileo_prn varchar(255),\n\tqualification_period varchar(255),\n\tinterest_rate numeric(21,20),\n\tbalance_start_date date,\n\tbalance_end_date date,\n\tinterest_period bigint,\n\taverage_balance numeric(38,20),\n\tn_balance_days bigint,\n\tinterest_payment numeric(38,20),\n    etl_load_date timestamp default getdate()\n--    etl_timestamp timestamp default ('now'::text)::timestamp with time zone\n--    etl_timestamp timestamp with time zone default current_timestamp\n)\n;\n\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962529":{"id":2962529,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":0,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2962524,2962527],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962530":{"id":2962530,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-112,"y":96,"width":32,"height":32,"inputConnectorIDs":[2962501],"outputSuccessConnectorIDs":[2962507],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"populate 2019-08 interests calculation"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INSERT INTO rdl.save_interest_calculation\n(interest_month, calculation_method, save_galileo_prn, qualification_period, interest_rate, balance_start_date, balance_end_date, interest_period, average_balance, n_balance_days, interest_payment, etl_load_date) \nSELECT\n  '2019-08-01',\n  'adb',\n  save_galileo_prn,\n  CASE\n    WHEN qualification_period='first_only' THEN 'period_1'\n    WHEN qualification_period='second_only' THEN 'period_2'\n    WHEN qualification_period='both' THEN 'full_month'\n  END,\n  interest_rate,\n  from_date,\n  to_date,\n  interest_period,\n  average_balance,\n  n_balance_days,\n  interest_payment,\n  '2019-09-02 11:33:32.920038'\nFROM ujc.save_august_interest_aspiration\n;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962531":{"id":2962531,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":304,"y":-16,"width":32,"height":32,"inputConnectorIDs":[2962505],"outputSuccessConnectorIDs":[2962504],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"populate qualification table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"drop table if exists etl.save_interest_qualifications;\n\ncreate table etl.save_interest_qualifications (\n  save_galileo_prn varchar(255),\n  qualification_period varchar(255),\n  interest_rate numeric(21,20),\n  from_date date,\n  to_date date\n)\nDISTKEY(save_galileo_prn)\nSORTKEY(save_galileo_prn)\n;\n\nINSERT INTO etl.save_interest_qualifications\n(save_galileo_prn, qualification_period, interest_rate, from_date, to_date)\nSELECT\n  acc.save_galileo_prn,\n  'full_month',\n--   daq.apy,\n  CASE\n    WHEN daq.apy=0.02 THEN 0.0198\n    WHEN daq.apy=0.015 THEN 0.0149\n    WHEN daq.apy=0.01 THEN 0.01\n    ELSE 0.0\n  END as interest_rate,\n  '${balance_from_date}',\n  '${balance_to_date}'\nFROM web_db.depository_apy_qualification daq\nJOIN bi.dt_accounts acc on acc.galileo_save_id = daq.depository_id\nWHERE 1=1\n  AND daq.qualified_month='${interest_month} 00:00:00.000000'\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962544":{"id":2962544,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":144,"y":-16,"width":32,"height":32,"inputConnectorIDs":[2962524],"outputSuccessConnectorIDs":[2962505,2962506,2962511],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"set date variables"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\nfrom datetime import datetime\nfrom datetime import timedelta\nfrom dateutil.relativedelta import relativedelta\nfrom pytz import timezone\n\ninterest_month_date = datetime.strptime(interest_month, '%Y-%m-%d')\nprint 'interest_month_date: ', interest_month_date\n\nfrom_date = (interest_month_date).strftime('%Y-%m-%d')\nto_date = (interest_month_date + relativedelta(months=1)).strftime('%Y-%m-%d')\nprint 'from, to: ', from_date, to_date\n\n\ncontext.updateVariable('from_date', from_date)\ncontext.updateVariable('to_date', to_date)\n\n\ngalileo_filename_date = datetime.now(timezone('US/Pacific')).strftime('%Y%m%d')\n#galileo_filename = 'btrans_584_' + galileo_filename_date + '_007.txt'\ngalileo_transaction_identifier_date = datetime.now(timezone('US/Pacific')).strftime('%y%m%d')\ngalileo_file_transmit_date = datetime.now(timezone('US/Pacific')).strftime('%m%d%Y')\n\nprint 'galileo_filename_date: ', galileo_filename_date\n#print 'galileo_filename: ', galileo_filename\nprint 'galileo_transaction_identifier_date: ', galileo_transaction_identifier_date\nprint 'galileo_file_transmit_date: ', galileo_file_transmit_date\n\ncontext.updateVariable('galileo_filename_date', galileo_filename_date)\n#context.updateVariable('galileo_filename', galileo_filename)\ncontext.updateVariable('galileo_transaction_identifier_date', galileo_transaction_identifier_date)\ncontext.updateVariable('galileo_file_transmit_date', galileo_file_transmit_date)\n\n\n\n#process_date = datetime.today().strftime('%Y-%m-%d')\n\n#context.updateVariable('process_date', process_date)\n\n#print 'interest_month_date: ', interest_month_date\n\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962545":{"id":2962545,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-112,"y":208,"width":32,"height":32,"inputConnectorIDs":[2962507],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"20191024_adb_adjustment"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"-- alter table rdl.save_interest_calculation rename to save_interest_calculation_backup_20191024;\n\ninsert into rdl.save_interest_calculation\nSELECT\n  interest_month,\n  calculation_method,\n  save_galileo_prn,\n  qualification_period,\n  interest_rate,\n  balance_start_date,\n  balance_end_date,\n  interest_period,\n  average_balance * n_balance_days / interest_period,\n  n_balance_days,\n  interest_payment,\n  etl_load_date\nFROM rdl.save_interest_calculation_backup_20191024\n;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962546":{"id":2962546,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"CONDITIONAL","executionHint":"FLOW","implementationID":-1357378929,"x":224,"y":80,"width":32,"height":32,"inputConnectorIDs":[2962511],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[2962502],"outputFalseConnectorIDs":[2962525],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"internal or all other customers"}}}},"visible":true},"2":{"slot":2,"name":"Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Simple"}}}},"visible":true},"3":{"slot":3,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"internal_customers_only"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"true"}}}},"visible":true},"4":{"slot":4,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":true},"5":{"slot":5,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962547":{"id":2962547,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":304,"y":-112,"width":32,"height":32,"inputConnectorIDs":[2962506],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"calculate interest payments - depository_qualification_interest"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"set timezone to 'America/Los_Angeles';\n\ndelete from rdl.save_interest_calculation\nwhere interest_month='${interest_month}'\n;\n\nINSERT INTO rdl.save_interest_calculation\n(interest_month, calculation_method, save_galileo_prn, qualification_period, interest_rate, balance_start_date, balance_end_date, interest_period, average_balance, n_balance_days, interest_payment)\n    SELECT\n      '${interest_month}',\n      'adb',\n      da.save_galileo_prn,\n      'full_month',\n      dqi.rate_period_rate,\n      dqi.rate_period_start_date,\n      dqi.rate_period_end_date,\n      datediff(DAY, dqi.rate_period_start_date, dqi.rate_period_end_date) + 1 AS interest_period,\n      dqi.rate_period_precise_adb,\n      datediff(DAY, dqi.rate_period_start_date, dqi.rate_period_end_date) + 1 AS n_balance_days,\n      dqi.rate_period_precise_interest as interest_payment\n    FROM web_db.depository_qualification_interest dqi\n    LEFT JOIN bi.dt_accounts da ON dqi.depository_id = da.galileo_save_id\n    WHERE 1 = 1\n      AND dqi.rate_period_start_date = '${interest_month}'\n      AND dqi.rate_period_apy != 0\n;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962548":{"id":2962548,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":144,"y":160,"width":32,"height":32,"inputConnectorIDs":[2962502],"outputSuccessConnectorIDs":[2962510],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Populate galileo table - internal customers"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"UPDATE etl.galileo_transaction_batch_header\nSET filename = 'btrans_584_${galileo_filename_date}_ip007.txt.gpg',\nfiletransmitdate = '${galileo_file_transmit_date}'\nWHERE recordtype = 'H'\n;\n\ntruncate table etl.galileo_transaction_batch_detail;\ninsert into etl.galileo_transaction_batch_detail(recordtype,\nrecordnumber, accountidtype, accountidentifier, transactiontype,\ntransactionsubtype, transactionamount, transactiondescription, transactionidentifier)\nwith cmc\nas\n(\n  SELECT\n    da.save_galileo_prn                       as galileo_prn,\n    sum(dqi.rp_precise_interest)              as precise_interest,\n    round(sum(dqi.rp_precise_interest), 2)    as creditamount\n  FROM web_db.depository_qualification_interest dqi\n  JOIN bi.dt_accounts da ON da.galileo_save_id=dqi.depository_id\n  JOIN bi.dt_users du ON da.user_id=du.user_id\n  WHERE 1=1\n    AND dqi.qp_start_date='${interest_month}'\n    AND dqi.rp_apy != 0\n    AND dqi.rp_interest > 0\n      AND du.user_email in (\n      SELECT email\n        FROM etl.internal_employees_20190903\n      )\n  GROUP BY da.save_galileo_prn\n)\nselect 'D' as recordtype\n     , row_number() over(order by t2.galileo_prn) as recordnumber\n     , 'R' as accountidtype\n     , t2.galileo_prn as accountidentifier\n     , 'L' as transactiontype\n     , 'MZ' as transactionsubtype\n     , t2.creditamount as transactionamount\n     , 'Interest Posting'::varchar as transactiondescription\n     , 'IP_${galileo_transaction_identifier_date}-I' || lpad(row_number() over(order by t2.galileo_prn), 5, '0') as transactionidentifier\nfrom cmc t2\nwhere t2.creditamount > 0.00\n;\n\nUPDATE etl.galileo_transaction_batch_trailer\nSET \"count\" = (SELECT count(1) from etl.galileo_transaction_batch_detail)\nWHERE recordtype = 'T'\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962549":{"id":2962549,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":464,"y":-16,"width":32,"height":32,"inputConnectorIDs":[2962504],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"calculate interest payments"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"set timezone to 'America/Los_Angeles';\n\ndelete from rdl.save_interest_calculation\nwhere interest_month='${interest_month}'\n;\n\nINSERT INTO rdl.save_interest_calculation\n(interest_month, calculation_method, save_galileo_prn, qualification_period, interest_rate, balance_start_date, balance_end_date, interest_period, average_balance, n_balance_days, interest_payment) \nwith average_balances as (\n    SELECT\n      da.save_galileo_prn,\n      iq.qualification_period,\n      sum(db.save_daily_balance) AS sum_balance,\n      count(db.save_daily_balance) AS n_balance_days\n    FROM bi.dt_account_daily_data db\n      JOIN bi.dt_accounts da ON db.unique_account_id=da.unique_account_id\n      JOIN etl.save_interest_qualifications iq ON iq.save_galileo_prn = da.save_galileo_prn\n    WHERE 1 = 1\n          AND date BETWEEN iq.from_date AND iq.to_date\n    GROUP BY da.save_galileo_prn, iq.qualification_period\n)\nSELECT\n  '${interest_month}',\n  'adb',\n  iq.save_galileo_prn,\n  iq.qualification_period,\n  iq.interest_rate,\n  iq.from_date,\n  iq.to_date,\n  datediff(DAY, iq.from_date, iq.to_date)+1 as interest_period,\n  ab.sum_balance / (iq.to_date-iq.from_date+1) as average_balance,\n  ab.n_balance_days,\n  ab.sum_balance * iq.interest_rate / 365 as interest_payment\nFROM etl.save_interest_qualifications iq\nJOIN average_balances ab\n    ON iq.save_galileo_prn=ab.save_galileo_prn\n    AND iq.qualification_period=ab.qualification_period\nWHERE 1=1\n;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2962550":{"id":2962550,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":448,"y":160,"width":32,"height":32,"inputConnectorIDs":[2962525],"outputSuccessConnectorIDs":[2962503],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Populate galileo table - all other customers"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"UPDATE etl.galileo_transaction_batch_header\nSET filename = 'btrans_584_${galileo_filename_date}_ip008.txt.gpg',\nfiletransmitdate = '${galileo_file_transmit_date}'\nWHERE recordtype = 'H'\n;\n\ntruncate table etl.galileo_transaction_batch_detail;\ninsert into etl.galileo_transaction_batch_detail(recordtype,\nrecordnumber, accountidtype, accountidentifier, transactiontype,\ntransactionsubtype, transactionamount, transactiondescription, transactionidentifier)\nwith cmc\nas\n(\n  SELECT\n    da.save_galileo_prn                       as galileo_prn,\n    sum(dqi.rp_precise_interest)              as precise_interest,\n    round(sum(dqi.rp_precise_interest), 2)    as creditamount\n  FROM web_db.depository_qualification_interest dqi\n  JOIN bi.dt_accounts da ON da.galileo_save_id=dqi.depository_id\n  JOIN bi.dt_users du ON da.user_id=du.user_id\n  WHERE 1=1\n    AND dqi.qp_start_date='${interest_month}'\n    AND dqi.rp_apy != 0\n    AND dqi.rp_interest > 0\n      AND du.user_email not in (\n      SELECT email\n        FROM etl.internal_employees_20190903\n      )\n  GROUP BY da.save_galileo_prn\n)\nselect 'D' as recordtype\n     , row_number() over(order by t2.galileo_prn) as recordnumber\n     , 'R' as accountidtype\n     , t2.galileo_prn as accountidentifier\n     , 'L' as transactiontype\n     , 'MZ' as transactionsubtype\n     , t2.creditamount as transactionamount\n     , 'Interest Posting'::varchar as transactiondescription\n     , 'IP_${galileo_transaction_identifier_date}-' || lpad(row_number() over(order by t2.galileo_prn), 5, '0') as transactionidentifier\nfrom cmc t2\nwhere t2.creditamount > 0\n;\n\nUPDATE etl.galileo_transaction_batch_trailer\nSET \"count\" = (SELECT count(1) from etl.galileo_transaction_batch_detail)\nWHERE recordtype = 'T'\n;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2962501":{"id":2962501,"sourceID":2962528,"targetID":2962530},"2962503":{"id":2962503,"sourceID":2962550,"targetID":2962508},"2962504":{"id":2962504,"sourceID":2962531,"targetID":2962549},"2962505":{"id":2962505,"sourceID":2962544,"targetID":2962531},"2962506":{"id":2962506,"sourceID":2962544,"targetID":2962547},"2962507":{"id":2962507,"sourceID":2962530,"targetID":2962545},"2962510":{"id":2962510,"sourceID":2962548,"targetID":2962509},"2962511":{"id":2962511,"sourceID":2962544,"targetID":2962546}},"failureConnectors":{},"unconditionalConnectors":{"2962524":{"id":2962524,"sourceID":2962529,"targetID":2962544},"2962527":{"id":2962527,"sourceID":2962529,"targetID":2962528}},"trueConnectors":{"2962502":{"id":2962502,"sourceID":2962546,"targetID":2962548}},"falseConnectors":{"2962525":{"id":2962525,"sourceID":2962546,"targetID":2962550}},"iterationConnectors":{},"noteConnectors":{},"notes":{"2962534":{"id":2962534,"x":-289,"y":-110,"width":250,"height":58,"text":"Change month to first day of the interest period.\ne.g. for Oct. 1st, 2020, change interest_month='2020-09-01'\n\nFor internal customers:\nset internal_customers_only=true\n\nFor all other customers:\nset internal_customers_only=false","colour":"e6e63c"}},"variables":{"from_date":{"definition":{"name":"from_date","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"galileo_file_transmit_date":{"definition":{"name":"galileo_file_transmit_date","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"01022020"},"galileo_filename_date":{"definition":{"name":"galileo_filename_date","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"20200102"},"galileo_transaction_identifier_date":{"definition":{"name":"galileo_transaction_identifier_date","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"200102"},"interest_month":{"definition":{"name":"interest_month","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"2021-01-01"},"internal_customers_only":{"definition":{"name":"internal_customers_only","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"false"},"to_date":{"definition":{"name":"to_date","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null}},"grids":{}},"info":{"name":"interest_calculation_adb_backup_20210201","description":"","type":"ORCHESTRATION","tag":"b841c254-2bd7-4baf-972f-afbb91172584"}}