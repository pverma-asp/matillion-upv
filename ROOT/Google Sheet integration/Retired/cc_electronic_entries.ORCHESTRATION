{"job":{"components":{"2967408":{"id":2967408,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-64,"y":80,"width":32,"height":32,"inputConnectorIDs":[2967468],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Update"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DROP TABLE rdl.cc_electronic_entries_tmp;\n\n\n\n--UPDATE rdl.cc_electronic_entries SET promo_id = '191201'"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967409":{"id":2967409,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":96,"y":0,"width":32,"height":32,"inputConnectorIDs":[2967411],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Load"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"--DROP TABLE IF EXISTS rdl.${table_name};\n--CREATE TABLE rdl.${table_name} AS\nINSERT INTO rdl.${table_name}\n   WITH\n      entries AS (\n         SELECT trim(date)::date AS date\n              , trim(name) AS raw_name\n              , trim(email) AS raw_email\n              , trim(day_phone) AS raw_day_phone\n              , trim(evening_phone) AS raw_evening_phone\n              , trim(dob) AS raw_dob\n              , trim(address) AS raw_address\n              , trim(employer) AS raw_employer\n              , trim(employer_address) AS raw_employer_address\n              , std_employer_address\n              , std_address\n              , row_number() OVER () AS entry_id\n         FROM rdl.${table_name}_tmp\n         ),\n      entries_matched AS (\n         SELECT entries.*\n              , ueml.user_id IS NOT NULL AS e_match\n              , nvl(entries.raw_name ILIKE '%' || uprop.first_name || '%' OR\n                    entries.raw_name ILIKE '%' || uprop.last_name || '%',FALSE) AS p_match\n              , nvl(entries.raw_name ILIKE '%' || uprom.first_name || '%' OR\n                    entries.raw_name ILIKE '%' || uprom.last_name || '%',FALSE) AS m_match\n              , row_number()\n                OVER (PARTITION BY entries.entry_id ORDER BY e_match DESC, p_match DESC, m_match DESC) AS match_rank\n              , ueml.user_id AS e_user_id\n              , uproe.first_name AS e_first_name\n              , uproe.last_name AS e_last_name\n              , NULL::VARCHAR(18) AS e_phone\n              , uprop.user_id AS p_user_id\n              , uprop.first_name AS p_first_name\n              , uprop.last_name AS p_last_name\n              , NULL::VARCHAR(18) AS p_phone\n              , padd.street1 AS p_street1\n              , padd.street2 AS p_street2\n              , padd.city AS p_city\n              , padd.zip_or_postal_code AS p_zip\n              , uprom.user_id AS m_user_id\n              , uprom.first_name AS m_first_name\n              , uprom.last_name AS m_last_name\n              , NULL::VARCHAR(18) AS m_phone\n              , madd.street1 AS m_street1\n              , madd.street2 AS m_street2\n              , madd.city AS m_city\n              , madd.zip_or_postal_code AS m_zip\n              , decode(e_match,TRUE,'email'\n                        ,FALSE,decode(p_match,TRUE,'physical'\n                           ,FALSE,decode(m_match,TRUE,'mailing'))) AS match_type\n              , decode(match_type,'email',e_user_id::VARCHAR\n                        ,'physical',p_user_id::VARCHAR\n                           ,'mailing',m_user_id::VARCHAR\n                              ,entries.raw_email::VARCHAR) AS user_id\n              , decode(match_type,'email',e_first_name || ' ' || e_last_name\n                        ,'physical',p_first_name || ' ' || p_last_name\n                           ,'mailing',m_first_name || ' ' || m_last_name\n                              ,entries.raw_name) AS name\n              , entries.std_address AS address\n              , NULL::VARCHAR(18) AS phone\n         FROM entries\n         LEFT JOIN web_db.user_email ueml ON ueml.email = entries.raw_email\n         LEFT JOIN web_db.address padd ON padd.zip_or_postal_code <> '00000' AND\n                                          (entries.std_address ILIKE '%' || padd.zip_or_postal_code || '%' OR\n                                           entries.std_address ILIKE '%' || padd.city || '%') AND\n                                          entries.std_address ILIKE '%' || padd.street1 || '%'\n         LEFT JOIN web_db.address madd ON madd.zip_or_postal_code <> '00000' AND\n                                          (entries.std_address ILIKE '%' || madd.zip_or_postal_code || '%' OR\n                                           entries.std_address ILIKE '%' || madd.city || '%') AND\n                                          entries.std_address ILIKE '%' || madd.street1 || '%'\n         LEFT JOIN web_db.user_profile uproe ON ueml.user_id = uproe.user_id\n         LEFT JOIN web_db.user_profile uprop ON padd.id = uprop.address_id\n         LEFT JOIN web_db.user_profile uprom ON madd.id = uprom.mailing_address_id\n         )\n   SELECT '${promo_id}'::VARCHAR(18) AS promo_id\n        , *\n   FROM entries_matched\n   WHERE match_rank = 1;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967412":{"id":2967412,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-64,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2967410,2967468,2967469],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967414":{"id":2967414,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-160,"y":0,"width":32,"height":32,"inputConnectorIDs":[2967410],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DDL"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ALTER TABLE rdl.utm_lookup OWNER TO svc_etl;\n\n--GRANT ALL ON TABLE ucj.utm_lookup TO cjohnson;\n\n\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967415":{"id":2967415,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1926640548,"x":16,"y":0,"width":32,"height":32,"inputConnectorIDs":[2967469],"outputSuccessConnectorIDs":[2967411],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Sheet"}}}},"visible":true},"2":{"slot":2,"name":"Basic/Advanced Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Basic"}}}},"visible":true},"3":{"slot":3,"name":"Authentication","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"cjohnson"}}}},"visible":true},"6":{"slot":6,"name":"Data Source","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${sheet_name}_${tab_name}"}}}},"visible":true},"7":{"slot":7,"name":"Data Selection","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"Date"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"Name"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"Email"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"Address"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"Employer"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"Employer_address"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"Day_phone"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"Evening_phone"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"Dob"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"Std_address"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"Std_employer_address"}}}},"visible":true},"8":{"slot":8,"name":"Data Source Filter","elements":{},"visible":true},"9":{"slot":9,"name":"Combine Filters","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":true},"10":{"slot":10,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT [Id]\nFROM [SheetName]"}}}},"visible":false},"11":{"slot":11,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"2000"}}}},"visible":true},"12":{"slot":12,"name":"Connection Options","elements":{},"visible":true},"13":{"slot":13,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${table_name}_tmp"}}}},"visible":true},"14":{"slot":14,"name":"Distribution Style","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Auto"}}}},"visible":true},"15":{"slot":15,"name":"Distribution Key","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"16":{"slot":16,"name":"Sort Key","elements":{},"visible":true},"17":{"slot":17,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rdl"}}}},"visible":true},"18":{"slot":18,"name":"Sort Key Options","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"19":{"slot":19,"name":"S3 Staging Area","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"aspiration-etl-staging"}}}},"visible":true},"20":{"slot":20,"name":"Data Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"GoogleSheets"}}}},"visible":false},"21":{"slot":21,"name":"Primary Key","elements":{},"visible":true},"96":{"slot":96,"name":"Location","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"s3://<bucket>/<path>"}}}},"visible":false},"97":{"slot":97,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"98":{"slot":98,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"99":{"slot":99,"name":"Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Standard"}}}},"visible":true},"200":{"slot":200,"name":"Spreadsheet Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${sheet_id}"}}}},"visible":true},"201":{"slot":201,"name":"Contains Header Row","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"202":{"slot":202,"name":"Cell Range","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"1001":{"slot":1001,"name":"","elements":{},"visible":false},"1013":{"slot":1013,"name":"Auto Debug","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Off"}}}},"visible":true},"1014":{"slot":1014,"name":"Debug Level","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"3"}}}},"visible":false},"1034":{"slot":1034,"name":"Load Options","elements":{},"visible":true},"40000":{"slot":40000,"name":"Encryption","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"None"}}}},"visible":true},"40001":{"slot":40001,"name":"KMS Key ID","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2967411":{"id":2967411,"sourceID":2967415,"targetID":2967409}},"failureConnectors":{},"unconditionalConnectors":{"2967410":{"id":2967410,"sourceID":2967412,"targetID":2967414},"2967468":{"id":2967468,"sourceID":2967412,"targetID":2967408},"2967469":{"id":2967469,"sourceID":2967412,"targetID":2967415}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{"2967413":{"id":2967413,"x":-228,"y":-182,"width":240,"height":119,"text":"Vars:\npromo_id.........1910\nsheet_name....Tesla Mail Entries\ntab_name........19.10\ntable_name....tesla_mail_entries\n\n\n*adjust sheet limit as needed","colour":"e6e63c"}},"variables":{"promo_id":{"definition":{"name":"promo_id","type":"TEXT","scope":"BRANCH","description":"","visibility":"PRIVATE"},"value":"191229"},"sheet_id":{"definition":{"name":"sheet_id","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"17yjS3vyhxhO0Zmrq9tfpLxT-wLC3W__e6rT3cy7C5Gs"},"sheet_name":{"definition":{"name":"sheet_name","type":"TEXT","scope":"BRANCH","description":"","visibility":"PRIVATE"},"value":"CC Entries"},"tab_name":{"definition":{"name":"tab_name","type":"TEXT","scope":"BRANCH","description":"","visibility":"PRIVATE"},"value":"19.12.08"},"table_name":{"definition":{"name":"table_name","type":"TEXT","scope":"BRANCH","description":"","visibility":"PRIVATE"},"value":"cc_electronic_entries"}},"grids":{}},"info":{"name":"cc_electronic_entries","description":"","type":"ORCHESTRATION","tag":"e3c7eca3-5579-40f5-9bd0-ef8d085c16e0"}}