{"job":{"components":{"2967488":{"id":2967488,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":0,"y":64,"width":32,"height":32,"inputConnectorIDs":[2967522],"outputSuccessConnectorIDs":[2967524],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"set date variables"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\nfrom datetime import datetime\nfrom datetime import timedelta\nfrom dateutil.relativedelta import relativedelta\nfrom pytz import timezone\n\nprint 'current time in PST: ', datetime.now(timezone('US/Pacific'))\n\ntoday=datetime.now(timezone('US/Pacific')).strftime(\"%Y-%m-%d\")\nprint 'today: ', today\n\n#pwif_month_date = datetime.strptime(pwif_month, '%Y-%m-%d')\n#print 'pwif_month_date: ', pwif_month_date\n\ngalileo_filename_date = datetime.now(timezone('US/Pacific')).strftime('%Y%m%d')\ngalileo_filename = 'benroll_584_' + galileo_filename_date + '_001.txt'\n#galileo_transaction_identifier_date = datetime.now(timezone('US/Pacific')).strftime('%y%m%d')\ngalileo_file_transmit_date = datetime.now(timezone('US/Pacific')).strftime('%m%d%Y')\n\nprint 'galileo_filename_date: ', galileo_filename_date\nprint 'galileo_filename: ', galileo_filename\n#print 'galileo_transaction_identifier_date: ', galileo_transaction_identifier_date\nprint 'galileo_file_transmit_date: ', galileo_file_transmit_date\n\n\n#context.updateVariable('today', today)\ncontext.updateVariable('galileo_filename_date', galileo_filename_date)\ncontext.updateVariable('galileo_filename', galileo_filename)\n#context.updateVariable('galileo_transaction_identifier_date', galileo_transaction_identifier_date)\ncontext.updateVariable('galileo_file_transmit_date', galileo_file_transmit_date)\n\n\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967489":{"id":2967489,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":400,"y":528,"width":32,"height":32,"inputConnectorIDs":[2967521],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Get_response_File_from_Galileo_jchen"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Get_BEnrollment_response_File_from_Galileo_jchen"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"galileo_filename"},"2":{"slot":2,"type":"STRING","value":"${galileo_filename}"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967490":{"id":2967490,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-64,"y":-32,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2967522,2967549],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967491":{"id":2967491,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":224,"y":432,"width":32,"height":32,"inputConnectorIDs":[2967530],"outputSuccessConnectorIDs":[2967528],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Copy of insert to history"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"delete from etl.GALILEO_ENROLLMENT_BATCH_DETAIL_HISTORY\nwhere FILENAME='${galileo_filename}'\n;\n\ninsert into etl.GALILEO_ENROLLMENT_BATCH_DETAIL_HISTORY\n    (FILENAME, RECORD_TYPE, RECORD_NUMBER, PRODUCT_ID, PRIMARY_CARDHOLDER_FIRST_NAME, PRIMARY_CARDHOLDER_MIDDLE_NAME, PRIMARY_CARDHOLDER_LAST_NAME, ADDRESS_LINE_1, ADDRESS_LINE_2, CITY, STATE, ZIP_CODE, COUNTRY, PRIMARY_PHONE_NUMBER, SECONDARY_PHONE_NUMBER, EMAIL, ID_1_TYPE, ID_1_VALUE, ID_2_TYPE, ID_2_VALUE, DATE_OF_BIRTH, EXTERNAL_ID, EXPRESS_MAIL, LOAD_AMOUNT, LOAD_TYPE, LOAD_DESCRIPTION, HIT_ID, SOURCE, WEB_UID, WEB_PWD, SECRET_QUESTION, SECRET_ANSWER, MOBILE_PHONE_NUMBER, CARRIER_ID, EMBOSS_LINE_2)\nselect\n    '${galileo_filename}', record_type, record_number, product_id, primary_cardholder_first_name, primary_cardholder_middle_name, primary_cardholder_last_name, address_line_1, address_line_2, city, state, zip_code, country, primary_phone_number, secondary_phone_number, email, id_1_type, '*********', id_2_type, id_2_value, date_of_birth, external_id, express_mail, load_amount, load_type, load_description, hit_id, source, web_uid, web_pwd, secret_question, secret_answer, mobile_phone_number, carrier_id, emboss_line_2\nfrom etl.GALILEO_ENROLLMENT_BATCH_DETAIL\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967492":{"id":2967492,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":-192,"y":448,"width":32,"height":32,"inputConnectorIDs":[2967520],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Success - already processed"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967493":{"id":2967493,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"CONDITIONAL","executionHint":"FLOW","implementationID":-1357378929,"x":-192,"y":352,"width":32,"height":32,"inputConnectorIDs":[2967525],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[2967520],"outputFalseConnectorIDs":[2967523],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Copy of If record count > 0"}}}},"visible":true},"2":{"slot":2,"name":"Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Simple"}}}},"visible":true},"3":{"slot":3,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"record_count"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Greater than"},"4":{"slot":4,"type":"STRING","value":"0"}}}},"visible":true},"4":{"slot":4,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":true},"5":{"slot":5,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967494":{"id":2967494,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":224,"y":528,"width":32,"height":32,"inputConnectorIDs":[2967528],"outputSuccessConnectorIDs":[2967521],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"wait"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import time\n\nprint ('wait 1 hour before processing response file')\ntime.sleep(3600)\n\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"3720"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967495":{"id":2967495,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-304,"y":64,"width":32,"height":32,"inputConnectorIDs":[2967531],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"adhoc query"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"delete from rdl.account_rotation_history\nwhere rotation_date='2022-04-05'\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967498":{"id":2967498,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1032749985,"x":-192,"y":176,"width":32,"height":32,"inputConnectorIDs":[2967526],"outputSuccessConnectorIDs":[2967525],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Query record count"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select count(1) as cnt\nfrom etl.WEEKLY_ROTATION_REQUESTS_GOOGLE_SHEET_STAGING wrr\nleft join rdl.ACCOUNT_ROTATION_HISTORY arh on arh.DATE=wrr.A and arh.USER_ID=wrr.B\nwhere 1=1\n  and id > 1\n  and arh.USER_ID is not null -- already loaded\n"}}}},"visible":true},"3":{"slot":3,"name":"Scalar Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"record_count"},"2":{"slot":2,"type":"STRING","value":"CNT"}}}},"visible":true},"4":{"slot":4,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"5":{"slot":5,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"6":{"slot":6,"name":"Table Columns","elements":{},"visible":false},"7":{"slot":7,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"10":{"slot":10,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"100"}}}},"visible":false},"11":{"slot":11,"name":"Order By","elements":{},"visible":false},"12":{"slot":12,"name":"Sort","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Ascending"}}}},"visible":false},"13":{"slot":13,"name":"Filter Conditions","elements":{},"visible":false},"14":{"slot":14,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":false},"20":{"slot":20,"name":"Basic / Advanced","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Advanced"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967499":{"id":2967499,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":0,"y":304,"width":32,"height":32,"inputConnectorIDs":[2967523],"outputSuccessConnectorIDs":[2967529],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"load to main table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"insert into rdl.account_rotation_history\n(ROTATION_DATE, DATE, USER_ID, UUID, FIRST_NAME, LAST_NAME, IS_JOINT_ACCOUNT, SPEND_GALILEO_PRN, SAVE_GALILEO_PRN) \nselect\n    convert_timezone('UTC', 'America/Los_Angeles', current_timestamp)::date,\n    A as \"date\",\n    B as user_id,\n    C as external_user_id,\n    D as first_name,\n    E as last_name,\n    F as is_joint_account,\n    G as spend_galileo_prn,\n    H as save_galileo_prn\nfrom etl.WEEKLY_ROTATION_REQUESTS_GOOGLE_SHEET_STAGING wrr\nleft join rdl.ACCOUNT_ROTATION_HISTORY arh on arh.DATE=wrr.A and arh.USER_ID=wrr.B\nwhere 1=1\n  and id > 1\n  and arh.USER_ID is null -- not already loaded\n;\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967532":{"id":2967532,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":224,"y":320,"width":32,"height":32,"inputConnectorIDs":[2967527],"outputSuccessConnectorIDs":[2967530],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Send_BEnrollment_File_to_Galileo 0"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Send_BEnrollment_File_to_Galileo"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"galileo_filename"},"2":{"slot":2,"type":"STRING","value":"${galileo_filename}"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967533":{"id":2967533,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":224,"y":208,"width":32,"height":32,"inputConnectorIDs":[2967529],"outputSuccessConnectorIDs":[2967527],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"create galileo enrollment table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"UPDATE etl.galileo_enrollment_batch_header\nSET file_name = '${galileo_filename}.gpg',\n       file_transmit_date = '${galileo_file_transmit_date}'\nWHERE record_type = 'H'\n;\n\ndelete from etl.galileo_enrollment_batch_detail;\ninsert into ETL.GALILEO_ENROLLMENT_BATCH_DETAIL\n    (RECORD_TYPE, RECORD_NUMBER, PRODUCT_ID, PRIMARY_CARDHOLDER_FIRST_NAME, PRIMARY_CARDHOLDER_MIDDLE_NAME, PRIMARY_CARDHOLDER_LAST_NAME, ADDRESS_LINE_1, ADDRESS_LINE_2, CITY, STATE, ZIP_CODE, COUNTRY, PRIMARY_PHONE_NUMBER, SECONDARY_PHONE_NUMBER, EMAIL, ID_1_TYPE, ID_1_VALUE, ID_2_TYPE, ID_2_VALUE, DATE_OF_BIRTH, EXTERNAL_ID, EXPRESS_MAIL, LOAD_AMOUNT, LOAD_TYPE, LOAD_DESCRIPTION, HIT_ID, SOURCE, WEB_UID, WEB_PWD, SECRET_QUESTION, SECRET_ANSWER, MOBILE_PHONE_NUMBER, CARRIER_ID, EMBOSS_LINE_2)\n\nwith aplus_users as (\n    select ua.USER_ID\n--     distinct PLAN_ID\n    from WEB_DB.SUBSCRIPTION s\n             join WEB_DB.USER_ACCOUNT ua on s.ACCOUNT_ID = ua.ACCOUNT_ID\n    where 1 = 1\n      and plan_id ILIKE 'planet%protection%'\n      and status = 'active'\n)\n, pids as (\nselect\n    da.USER_ID,\n    da.INCEPTION_DATE::date as inception_date,\n    datediff('day', da.INCEPTION_DATE, current_date()) as days_since_inception,\n    ap.USER_ID is not null as is_aplus_user,\n    case\n        when ap.USER_ID is null and days_since_inception < 30 then 6540     -- non aplus\n        when ap.USER_ID is null and days_since_inception >=30 then 6635     -- non aplus\n        when ap.USER_ID is not null and days_since_inception < 30 then 6541 -- aplus\n        when ap.USER_ID is not null and days_since_inception >=30 then 6542 -- aplus\n    end as pid\nfrom bi.DT_ACCOUNTS da\n-- join etl.ATO_USERS_LIST_20210602 atou on da.USER_ID=atou.USER_ID\nleft join aplus_users ap on da.USER_ID=ap.USER_ID\nwhere 1=1\n  and da.ACCOUNT_TYPE='Checking'\n  and da.TERMINATION_DATE is null\n  and da.IS_JOINT_ACCOUNT = false\n)\nselect\n--     pids.USER_ID,\n--     ue.EMAIL,\n    'D' as record_type\n    ,row_number() over (order by ue.USER_ID) as recordnumber\n    ,pids.pid::varchar as product_id\n    ,left(up.FIRST_NAME, 20)\n    ,left(COALESCE(up.MIDDLE_NAME, ''), 20)  -- can be null\n    ,left(up.LAST_NAME, 20)\n    ,left(a.STREET1, 30)\n    ,COALESCE(a.street2, '')  -- can be null\n    ,left(a.CITY, 20)\n    ,s.CODE\n    ,replace(a.ZIP_OR_POSTAL_CODE, '-', '')\n    ,'USA' as country\n    ,replace(up.PHONE_NUMBER, '-', '')\n    ,'' -- secondary phone number\n    ,ue.EMAIL\n    ,'2' -- ID 1 type\n    ,upsin.TAX_IDENTIFICATION_NUMBER -- sin number\n    ,'' -- ID 2 type\n    ,''\n    ,to_char(up.DATE_OF_BIRTH, 'MM/DD/YYYY')  -- date of birth\n    ,to_char(current_date(), 'YYYYMMDD') || '_' || to_char(current_time(), 'HH24MISS') || '_' || lpad(recordnumber, 6, '0') -- external id\n    ,case when pids.pid in (6541, 6542) then 'Y' else 'N' end  -- express mail\n    ,''  -- load amount\n    ,''  -- load type\n    ,''  -- load desc\n    ,''  -- hit id\n    ,''  -- source\n    ,''  -- web uid\n    ,''  -- web pwd\n    ,''  -- secret q\n    ,''  -- secret a\n    ,''  -- mobile phone\n    ,''  -- carrier id\n    ,''  -- emboss line 2\nfrom pids\njoin WEB_DB.user_profile up on pids.USER_ID=up.USER_ID\njoin WEB_DB.USER_EMAIL ue on up.USER_ID=ue.USER_ID and ue.IS_PRIMARY = true\njoin WEB_DB.ADDRESS a on up.ADDRESS_ID=a.id\njoin WEB_DB.STATE s on a.STATE_ID=s.ID\njoin PCI.USER_PROFILE upsin on upsin.USER_ID=up.USER_ID\nwhere 1=1\n  and ue.user_id in (\n    select user_id from rdl.account_rotation_history\n    where rotation_date = convert_timezone('UTC', 'America/Los_Angeles', current_timestamp)::date\n    )\n  -- exclude previous rotated customers\n  and ue.user_id not in (\n      select USER_ID from WEB_DB.ACCOUNT_ROTATION_PRN_HISTORY\n    )\n;\n\n\n--trailer data\nUPDATE etl.galileo_enrollment_batch_trailer\n   SET \"count\" = (select count(*) from etl.galileo_enrollment_batch_detail)\nWHERE record_type = 'T';\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967534":{"id":2967534,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-192,"y":64,"width":32,"height":32,"inputConnectorIDs":[2967549],"outputSuccessConnectorIDs":[2967531],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"table creation"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE if not exists rdl.account_rotation_history (\n  rotation_date date,\n  date varchar(255),\n  user_id varchar(255),\n  uuid varchar(255),\n  first_name varchar(255),\n  last_name varchar(255),\n  is_joint_account boolean,\n  spend_galileo_prn varchar(255),\n  save_galileo_prn varchar(255),\n  etl_load_date timestamp_tz default current_timestamp not null\n)\n;\n\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2967535":{"id":2967535,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1926640548,"x":0,"y":176,"width":32,"height":32,"inputConnectorIDs":[2967524],"outputSuccessConnectorIDs":[2967526],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Load Google Sheets"}}}},"visible":true},"2":{"slot":2,"name":"Basic/Advanced Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Basic"}}}},"visible":true},"3":{"slot":3,"name":"Authentication","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"svcdata"}}}},"visible":true},"6":{"slot":6,"name":"Data Source","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Weekly Rotation Requests_Sheet1"}}}},"visible":true},"7":{"slot":7,"name":"Data Selection","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"A"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"B"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"C"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"D"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"E"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"F"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"G"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"H"}}}},"visible":true},"8":{"slot":8,"name":"Data Source Filter","elements":{},"visible":true},"9":{"slot":9,"name":"Combine Filters","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":true},"10":{"slot":10,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT ..."}}}},"visible":false},"11":{"slot":11,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"1000"}}}},"visible":true},"12":{"slot":12,"name":"Connection Options","elements":{},"visible":true},"13":{"slot":13,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ADW"}}}},"visible":true},"14":{"slot":14,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ETL"}}}},"visible":true},"15":{"slot":15,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"weekly_rotation_requests_google_sheet_staging"}}}},"visible":true},"16":{"slot":16,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ETL"}}}},"visible":true},"17":{"slot":17,"name":"S3 Staging Area","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"aspiration-etl-staging"}}}},"visible":true},"18":{"slot":18,"name":"Primary Keys","elements":{},"visible":true},"20":{"slot":20,"name":"Data Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"200":{"slot":200,"name":"Spreadsheet Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"1iKnqobOvijd-pt0NUgf03LMFWZ4UuLOVLV6YmMtS7nc"}}}},"visible":true},"201":{"slot":201,"name":"Contains Header Row","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"202":{"slot":202,"name":"Cell Range","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"1001":{"slot":1001,"name":"","elements":{},"visible":false},"1013":{"slot":1013,"name":"Auto Debug","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Off"}}}},"visible":true},"1014":{"slot":1014,"name":"Debug Level","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"3"}}}},"visible":false},"1992":{"slot":1992,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"1993":{"slot":1993,"name":"Use Accelerated Endpoint","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"1994":{"slot":1994,"name":"Stage","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"1995":{"slot":1995,"name":"Stage Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"1996":{"slot":1996,"name":"Stage Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"1997":{"slot":1997,"name":"New Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"1998":{"slot":1998,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"1999":{"slot":1999,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"2000":{"slot":2000,"name":"Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Standard"}}}},"visible":true},"40000":{"slot":40000,"name":"Encryption","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"None"}}}},"visible":true},"40001":{"slot":40001,"name":"KMS Key ID","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"40501":{"slot":40501,"name":"","elements":{},"visible":false},"40502":{"slot":40502,"name":"Load Options","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"On"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"Off"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"On"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"On"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"Gzip"}}}},"visible":true},"63319":{"slot":63319,"name":"Stage Authentication","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Credentials"}}}},"visible":false},"63320":{"slot":63320,"name":"Storage Account","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"63321":{"slot":63321,"name":"Blob Container","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"63322":{"slot":63322,"name":"Storage Integration","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"84533":{"slot":84533,"name":"Integration","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"88340":{"slot":88340,"name":"","elements":{},"visible":false},"88341":{"slot":88341,"name":"Staging","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Existing Amazon S3 Location"}}}},"visible":true},"88342":{"slot":88342,"name":"Stage Authentication","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Credentials"}}}},"visible":true},"88343":{"slot":88343,"name":"Storage Integration","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"88344":{"slot":88344,"name":"Use Accelerated Endpoint","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"88345":{"slot":88345,"name":"Stage","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Custom]"}}}},"visible":true},"98776":{"slot":98776,"name":"GCS Staging Area","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2967521":{"id":2967521,"sourceID":2967494,"targetID":2967489},"2967524":{"id":2967524,"sourceID":2967488,"targetID":2967535},"2967525":{"id":2967525,"sourceID":2967498,"targetID":2967493},"2967526":{"id":2967526,"sourceID":2967535,"targetID":2967498},"2967527":{"id":2967527,"sourceID":2967533,"targetID":2967532},"2967528":{"id":2967528,"sourceID":2967491,"targetID":2967494},"2967529":{"id":2967529,"sourceID":2967499,"targetID":2967533},"2967530":{"id":2967530,"sourceID":2967532,"targetID":2967491},"2967531":{"id":2967531,"sourceID":2967534,"targetID":2967495}},"failureConnectors":{},"unconditionalConnectors":{"2967522":{"id":2967522,"sourceID":2967490,"targetID":2967488},"2967549":{"id":2967549,"sourceID":2967490,"targetID":2967534}},"trueConnectors":{"2967520":{"id":2967520,"sourceID":2967493,"targetID":2967492}},"falseConnectors":{"2967523":{"id":2967523,"sourceID":2967493,"targetID":2967499}},"iterationConnectors":{},"noteConnectors":{},"notes":{"2967496":{"id":2967496,"x":305,"y":-36,"width":428,"height":490,"text":"To run batch rotation, e.g. on the day Nov. 23, 2021.\n\n#1\nnew rotation list will be entered here every week on Tuesday:\nhttps://docs.google.com/spreadsheets/d/1iKnqobOvijd-pt0NUgf03LMFWZ4UuLOVLV6YmMtS7nc/edit#gid=0\n\n#2\nrun the job, the file will show up in this s3 folder:\ns3://aspiration-datateam/dump/jchen/galileo_snowflake/benroll_584_20211123_001.txt\n\n#3\nDownload the file, make sure the count is correct. And you can also pick one customer to see if it appears in the google sheet.\n\n#4\nThe job will send this file to Galileo\n\n#5\nand then populate the history table (GALILEO_ENROLLMENT_BATCH_DETAIL_HISTORY).\n\n#6\nThen 1 hour later run this job to parse the response file to populate the response table.\nGet_BEnrollment_response_File_from_Galileo_jchen_adhoc\n\n#7\nand run query to populate the google sheet the next day when the new galileo card data file (which have the galileo_account_ids) arrives. Create a new tab in this google sheet:\nhttps://docs.google.com/spreadsheets/d/1kvak-Pkwpq0_mDEuCgfbl_9dlVFzAvLhAjUoXltTu8Q/edit#gid=704113292","colour":"e6e63c"}},"variables":{"galileo_file_transmit_date":{"definition":{"name":"galileo_file_transmit_date","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"11212021"},"galileo_filename":{"definition":{"name":"galileo_filename","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"benroll_584_20211121_001.txt"},"galileo_filename_date":{"definition":{"name":"galileo_filename_date","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"20211121"},"record_count":{"definition":{"name":"record_count","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"0"}},"grids":{}},"info":{"name":"Batch_create_accounts_google_sheet_auto_backup_20220526","description":"","type":"ORCHESTRATION","tag":"18d67255-0702-4690-ba3f-198a25fbb23e"}}